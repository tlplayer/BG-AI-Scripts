
// ======================================================
// SECTION:GLOBALS
// ======================================================

// Reset daily use items and timers to 0 because when first AI first turned on the timer's 
// value is unintialized and can be large.
IF
    PartyRested()
THEN
    RESPONSE #100
        SetGlobal("USED_RING33","LOCALS",0)
        SetGlobal("USED_STAF21","LOCALS",0)
        SetGlobal("USED_SW1H26","LOCALS",0)
        SetGlobal("USED_clck08","LOCALS",0)
        SetGlobal("USED_BOOT12","LOCALS",0)
        SetGlobal("USED_ohbrew06","LOCALS",0)
        SetGlobal("USED_TOME01","LOCALS",0)
        SetGlobalTimer("FIRE_ENEMIES","LOCALS",0)
        SetGlobalTimer("CASTER_ENEMY","LOCALS",0)
        SetGlobalTimer("TROLL_ENEMIES","LOCALS",0)
        SetGlobalTimer("USE_RANGE","LOCALS",0)
        SetGlobalTimer("PSYCHIC_ENEMIES","LOCALS",0)
        Continue()
END

// Set a timer for short-duration buffs
// This section sets a global timer to track the duration of short-duration buffs.
// The timer is set to two rounds initially and updated to one round when a hotkey is pressed.
IF
    ActuallyInCombat()
    ActionListEmpty()
    Delay(12)
THEN
    RESPONSE #100
        SetGlobalTimer("SHORT_BUFF","LOCALS",FIVE_ROUNDS)
        Continue()
END


IF
    HotKey(K)  // Detect pressing of the 'B' key
THEN
    RESPONSE #100
        SetGlobalTimer("SUMMON","LOCALS",FIVE_ROUNDS)  // Set the timer to one round
        Continue()
END

IF
    HotKey(B)  // Detect pressing of the 'B' key
THEN
    RESPONSE #100
        SetGlobalTimer("SHORT_BUFF","LOCALS",ONE_TURN)  // Set the timer to one round
        Continue()
END


// ======================================================
// SECTION: Area Check
// ======================================================

//If I'm in the blackpits area, I cannot cast buffs/spells so just continue.
IF
    ActionListEmpty()
    AreaCheck("OH8100")
THEN
    RESPONSE #100
        Continue()
        Wait(10)
END

// ======================================================
// SECTION: ENEMY DETECTION
// ======================================================

/*
This section of the code is for determining which enemy is currently being faced. 
For each enemy type:
    set timer for enemy type

    Subsequent logic blocks will check these timers in conjuction or individually
    taking the resulting intelligent actions. 

    Example: facing fire elementals, do not use fire spells, 
    do cast fire protection spells if my resistance is low, 
    buff allies for fire protection if they are low. 
    Use specific items like charm fire elemental if the elemental is evil. 
*/


// See Fire Type Elemental with high resistance, don't use fire spells.
// General form [EA.GENERAL.RACE.CLASS.SPECIFIC.GENDER.ALIGN].
IF
    ActionListEmpty()
    Delay(30)
    OR(9)
        Detect([ENEMY.0.0.ELEMENTAL_FIRE.0])
        Detect([ENEMY.0.0.GREY_OOZE])
        Class(NearestEnemyOfType,MAGE_ALL)
        Class(NearestEnemyOfType,SORCERER)
        Class(NearestEnemyOfType,DRUID_ALL)
        Class(NearestEnemyOfType,CLERIC_ALL)
        Class(NearestEnemyOfType,ELEMENTAL_FIRE)
        Class(NearestEnemyOfType,RED_DRAGON)
        Class(NearestEnemyOfType,SILVER_DRAGON)
    !GlobalTimerNotExpired("FIRE_ENEMIES","LOCALS")
THEN
    RESPONSE #100
        SetGlobalTimer("FIRE_ENEMIES","LOCALS",ONE_MINUTE)
        Continue()
END

IF
    ActionListEmpty()
    ActuallyInCombat()
    Delay(30)
    OR(8)
        See(NearestEnemyOfType([ENEMY.0.0.MAGE_ALL]))
        See(NearestEnemyOfType([ENEMY.0.0.CLERIC_ALL]))
        See(NearestEnemyOfType([ENEMY.0.0.BARD_ALL]))
        See(NearestEnemyOfType([ENEMY.0.0.DRUID_ALL]))
        See(NearestEnemyOfType([ENEMY.0.0.SORCERER]))
        See(NearestEnemyOfType([ENEMY.0.0.RAKSHASA]))
        See(NearestEnemyOfType([ENEMY.0.LICH]))
        See(NearestEnemyOfType([ENEMY.0.DEMILICH]))
    GlobalTimerExpired("CASTER_ENEMY","LOCALS")
THEN
    RESPONSE #100
        SetGlobalTimer("CASTER_ENEMY","LOCALS",ONE_TURN)
        Continue()
END

// Detect Troll-type enemies, prepare to use anti-Troll strategies.
IF
    ActionListEmpty()
    Delay(30)
    Detect([ENEMY.0.0.TROLL.0])
    !GlobalTimerNotExpired("TROLL_ENEMIES","LOCALS")
THEN
    RESPONSE #100
        SetGlobalTimer("TROLL_ENEMIES","LOCALS",ONE_TURN)
        Continue()
END

IF
    ActionListEmpty()
    Delay(30)
    Detect([ENEMY.0.0.GREEN_SLIME])
    !GlobalTimerNotExpired("SLIME_ENEMIES","LOCALS")
THEN
    RESPONSE #100
        SetGlobalTimer("SLIME_ENEMIES","LOCALS",ONE_TURN)
        Continue()
END

IF
    ActionListEmpty()
    OR(2)
        Detect([ENEMY.0.0.UMBERHULK.0])
        Detect([ENEMY.0.0.MIND_FLAYER.0])
        Detect([ENEMY.0.0.MIND_FLAYER.0])
        Detect([ENEMY.0.0.MIND_FLAYER.0])
    !GlobalTimerNotExpired("PSYCHIC_ENEMIES","LOCALS")
    Delay(30)
THEN
    RESPONSE #100
        SetGlobalTimer("PSYCHIC_ENEMIES","LOCALS",ONE_TURN)
        Continue()
END


// ======================================================
// SECTION: CHECK FOR CROWD CONTROLLED PARTY MEMBERS To USE RANGE
// ======================================================
IF
    ActionListEmpty()
    ActuallyInCombat()
    HaveSpell(WIZARD_TIME_STOP) 
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
    Delay(30)
THEN
    RESPONSE #100
        Spell(Myself,WIZARD_TIME_STOP) 
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END


IF
    ActionListEmpty()
    ActuallyInCombat()
    HaveSpell(WIZARD_IMPROVED_ALUCRITY) 
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    Delay(30)
THEN
    RESPONSE #100
        Spell(Myself,WIZARD_IMPROVED_ALUCRITY) 
END

//If we have alacrity set time to 0 to spam spells
IF
    HaveSpell(WIZARD_IMPROVED_ALUCRITY) 
    CheckStatGT(Myself,0,WIZARD_IMPROVED_ALACRITY)
THEN
    RESPONSE #100
        SetGlobalTimer("WIZARD_CAST","LOCALS",0)        
END

// ======================================================
// SECTION: CHECK FOR CROWD CONTROLLED PARTY MEMBERS To USE RANGE
// ======================================================

// Check for crowd-controlled party members
// This section randomly walks if any party member is affected by crowd control spells or if the wizard is helpless.
IF
    ActionListEmpty()
    ActuallyInCombat()
    CheckStatLT(Myself,1,CLERIC_FREE_ACTION) // Check if party is being crowd-controlled
    CheckStatLT(Myself,1,MINORGLOBE)
    CheckStatLT(Myself,1,SHIELDGLOBE)
    OR(8)
        CheckStat([ANYONE],1,WEB)
        CheckStat([ANYONE],1,GREASE)
        CheckSpellState([ANYONE],PRONE)
        SpellCast([ANYONE],WIZARD_WEB)  // SPWI215.SPL (Web)
        SpellCast([ANYONE],WIZARD_DEATH_FOG)
        SpellCast([ANYONE.0.0.0],WIZARD_INCENDIARY_CLOUD)  // SPWI810.SPL (Incendiary Cloud)
        SpellCast([ANYONE.0.0.0],WIZARD_STINKING_CLOUD)  // SPWI213.SPL (Stinking Cloud)
        SpellCast([ANYONE.0.0.0],WIZARD_CLOUDKILL)  // SPWI502.SPL (Cloudkill)
        SpellCast([ANYONE.0.0.0],WIZARD_DEATH_FOG)  // SPWI614.SPL (Death Fog)
        SpellCast([ANYONE.0.0.0],WIZARD_ABI_DALZIMS_HORRID_WILTING)
    Range([ANYONE],13)
    Delay(18)
THEN
    RESPONSE #100
        SetGlobalTimer("USE_RANGE","LOCALS",FIVE_ROUNDS)
        SetInterrupt(FALSE)
        RunAwayFromNoInterruptNoLeaveArea([ANYONE],90)
        SetInterrupt(TRUE)
END

//If I'm in combat, and not near an ally go to them. Note, we can't evaluate this to attack nearest because we need to see what is nearest the player...
IF
    ActionListEmpty()
    CheckStatLT(Myself,1,CLERIC_FREE_ACTION) // Check if party is being crowd-controlled
    CheckStatLT(Myself,1,MINORGLOBE)
    CheckStatLT(Myself,1,SHIELDGLOBE)
    OR(1)
        SpellCastOnMe([ANYONE],WIZARD_WEB)
  THEN
    RESPONSE #100
        //Global Shout Alert, then run away from anyone else
        GlobalShout(125)
        SetGlobalTimer("USE_RANGE","LOCALS",FIVE_ROUNDS)
        RunAwayFromNoInterrupt([PC],60) 
        Continue()
END


IF
    ActionListEmpty()
    Heard([PC],ALERT)
    Range(LastHeardBy(Myself),30)
  THEN
    RESPONSE #100
        SetGlobalTimer("USE_RANGE","LOCALS",FIVE_ROUNDS)
        RunAwayFromNoInterrupt(LastHeardBy(Myself),60)
END

// Cast Zone of Sweet Air if affected by Stinking Cloud
// This section casts Zone of Sweet Air if the wizard or party members are affected by Stinking Cloud.
IF
    ActionListEmpty()
    OR(5)
        SpellCast([ENEMY.0.0.0],WIZARD_INCENDIARY_CLOUD)  
        SpellCast([ENEMY.0.0.0],WIZARD_STINKING_CLOUD)  
        SpellCast([ENEMY.0.0.0],WIZARD_CLOUDKILL) 
        SpellCast([ENEMY.0.0.0],WIZARD_DEATH_FOG) 
        SpellCast([ENEMY.0.0.0],WIZARD_ABI_DALZIMS_HORRID_WILTING) 

    HaveSpell(CLERIC_ZONE_OF_SWEET_AIR)  // SPPR318.SPL (Zone of Sweet Air)
THEN
    RESPONSE #100
        Spell(Myself,CLERIC_ZONE_OF_SWEET_AIR)  // Cast Zone of Sweet Air to counteract Stinking Cloud
END

// ======================================================
// SECTION: IMMUNITIES (WIZARD)
// ======================================================

/*
Protection From Magical Weapons
(Abjuration)

Level: 6
Range: 0
Duration: 4 rounds
Casting Time: 1
Area of Effect: The caster
Saving Throw: None 

When the spell is cast, it confers complete invulnerability to all magical weapons. 
This includes weapons that are blessed or enchanted. 
The attacks of powerful monsters are also considered magical weapons. 
This spell cannot be cast on anyone who is protected from normal weapons as well as anyone protected by 
Mantle, Improved Mantle, or Absolute Immunity. Due to the nature of this spell, with the short casting time and duration, 
it is mainly used to buy the wizard a few rounds in the thick of combat. 
This effect lasts for the duration of the spell or until dispelled.
*/
IF
    ActionListEmpty()
    HaveSpell(WIZARD_PROTECTION_FROM_MAGIC_WEAPONS)
    TookDamage()
    !CheckSpellState(Myself,PROTECTION_FROM_MAGICAL_WEAPONS)
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,WIZARD_PROTECTION_FROM_MAGIC_WEAPONS) 
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    HaveSpell(WIZARD_MANTLE)
    TookDamage()
    !CheckSpellState(Myself,MANTLE)
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,WIZARD_MANTLE) 
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    HaveSpell(WIZARD_IMPROVED_MANTLE)
    TookDamage()
    !CheckSpellState(Myself,IMPROVED_MANTLE)
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,WIZARD_IMPROVED_MANTLE) 
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    HaveSpell(WIZARD_ABSOLUTE_IMMUNITY)
    TookDamage()
    !CheckSpellState(Myself,ABSOLUTE_IMMUNITY)
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,WIZARD_ABSOLUTE_IMMUNITY) 
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

/*
Protection From Magic Energy
(Abjuration)

Level: 6
Range: Touch
Duration: 1 turn/level
Casting Time: 6
Area of Effect: 1 creature
Saving Throw: None

When the spell is cast, it confers 100% invulnerability to all 
magic-based attacks such as Magic Missile or Abi-Dalzim's Horrid Wilting.
This effect lasts for the duration of the spell or until dispelled.
*/
IF
    ActionListEmpty()
    HaveSpell(WIZARD_PROTECTION_FROM_MAGIC_ENERGY)
    OR(5)
        HitBy([ANYONE],ACID)
        HitBy([ANYONE],COLD)
        HitBy([ANYONE],ELECTRICITY)
        HitBy([ANYONE],FIRE)
        HitBy([ANYONE],MAGIC)
    !CheckStat(Myself,1,WIZARD_PROTECTION_FROM_MAGIC_ENERGY)
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,WIZARD_PROTECTION_FROM_MAGIC_ENERGY) 
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

/*
Protection From Energy
(Abjuration)

Level: 8
Range: Touch
Duration: 1 round/level
Casting Time: 8
Area of Effect: 1 creature
Saving Throw: None

When the spell is cast, it confers 75% immunity against all energy attacks—such as fire, cold, acid, magic, and electricity, whether from magical or non-magical sources—such as spells, weapons, wands, breath weapons, etc. This excludes any physical attacks and spell-created weapons, such as Enchanted Weapon and Spiritual Hammer. In other words, any physical damage, such as piercing, crushing, or slashing will get through. This effect lasts for the duration of the spell or until dispelled.
*/
IF
    ActionListEmpty()
    HaveSpell(WIZARD_PROTECTION_FROM_ENERGY)
    OR(5)
        HitBy([ANYONE],ACID)
        HitBy([ANYONE],COLD)
        HitBy([ANYONE],ELECTRICITY)
        HitBy([ANYONE],FIRE)
        HitBy([ANYONE],MAGIC)
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,WIZARD_PROTECTION_FROM_ENERGY) 
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    HaveSpell(WIZARD_PROTECTION_FROM_THE_ELEMENTS)
    OR(5)
        HitBy([ANYONE],ACID)
        HitBy([ANYONE],COLD)
        HitBy([ANYONE],ELECTRICITY)
        HitBy([ANYONE],FIRE)
        HitBy([ANYONE],MAGIC)
    !CheckStat(Myself,1,WIZARD_PROTECTION_FROM_MAGIC_ENERGY)
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,WIZARD_PROTECTION_FROM_THE_ELEMENTS) 
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END
// ======================================================
// SECTION: RETREAT CONDITION
// ======================================================


IF
    ActionListEmpty()
    See([ENEMY])
    Range(LastSeenBy(Myself),25)
    TookDamage()
    AttackedBy([ENEMY],DEFAULT)
    HPPercentLT(Myself,70)
    HaveSpell(WIZARD_SHADOW_DOOR)
THEN
    RESPONSE #100
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
        FaceObject(LastSeenBy(Myself))
        Spell(Myself,WIZARD_SHADOW_DOOR)  // SPWI505.SPL (Shadow Door)
        SetInterrupt(FALSE)
        RunAwayFromNoInterruptNoLeaveArea([ANYONE],60)
        Wait(4)
        SetInterrupt(TRUE)
END

IF
    ActionListEmpty()
    TookDamage()
    Range([ENEMY],8)
    AttackedBy([ENEMY],DEFAULT)
    HPPercentLT(Myself,70)
    HaveSpell(WIZARD_SHADOW_DOOR)
THEN
    RESPONSE #100
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
        FaceObject(LastSeenBy(Myself))
        Spell(Myself,WIZARD_TELEPORT_FIELD)  // SPWI505.SPL (Shadow Door)
        SetInterrupt(FALSE)
        RunAwayFromNoInterruptNoLeaveArea([ANYONE],45)
        Wait(4)
        Continue()
        SetInterrupt(TRUE)
END


IF
    ActionListEmpty()
    See([ENEMY])
    Range(LastSeenBy(Myself),25)
    AttackedBy([ENEMY],DEFAULT)
    HPPercentLT(Myself,80)
    HaveSpell(WIZARD_MISLEAD)
THEN
    RESPONSE #100
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
        FaceObject(LastSeenBy(Myself))
        Spell(Myself,WIZARD_MISLEAD)  // SPWI505.SPL (Shadow Door)
        SetInterrupt(FALSE)
        RunAwayFromNoInterruptNoLeaveArea([ANYONE],60)
        Wait(4)
        SetInterrupt(TRUE)
END

IF
    ActionListEmpty()
    ActuallyInCombat()
    HPPercentLT(Myself,75)
    AttackedBy([ENEMY],DEFAULT)
    !StateCheck(Myself,STATE_INVISIBLE)
    HaveSpell(WIZARD_INVISIBILITY)  // SPWI206.SPL (Invisibility)
THEN
    RESPONSE #100
        Spell(Myself,WIZARD_INVISIBILITY)  // Turn invisible to retreat
        RunAwayFrom(NearestEnemyOf(Myself),45)
        Wait(3)
END

IF
    ActionListEmpty()
    ActuallyInCombat()
    Delay(18)
    OR(3)
        Class(Myself,THIEF_ALL)
        Class(Myself,MONK)
        Class(Myself,BARD_ALL)
    !StateCheck(Myself,STATE_INVISIBLE)
    !GlobalTimerNotExpired("USE_RANGE","LOCALS")
THEN
    RESPONSE #100
        RunAwayFrom(NearestEnemyOf(Myself),45)
        Wait(3)
        Hide()
        EquipMostDamagingMelee()
        AttackOneRound(NearestEnemyOf(Myself))
        Wait(4)
END


IF
    ActionListEmpty()
    ActuallyInCombat()
    AttackedBy([ENEMY],MELEE)
    Exists(LastAttackerOf(Myself))
    OR(3)
        Class(Myself,MAGE)
        Class(Myself,THIEF)
        Class(Myself,BARD)
    Delay(8)
    HPPercentLT(Myself,80)
THEN
    RESPONSE #100
        RunAwayFromNoLeaveArea(LastAttackerOf(Myself),30)
        Continue()
END

IF
    ActionListEmpty()
    ActuallyInCombat()
    AttackedBy([ENEMY],DEFAULT)
    Exists(LastAttackerOf(Myself))
    Class(Myself,MAGE)
    Delay(10)
THEN
    RESPONSE #100
        RunAwayFromNoLeaveArea(LastAttackerOf(Myself),30)
        Continue()
END

// ======================================================
// SECTION: PRE-COMBAT BUFFING (WIZARD)
// ======================================================
// Cast Spirit Armor
// Casts Spirit Armor to provide a magical shield that improves the wizard's armor class.
// Lasts for 1 hour per caster level.
IF
    ActionListEmpty()
    HaveSpell(WIZARD_CONTINGENCY)  // SPWI414.SPL (Spirit Armor)
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,WIZARD_CONTINGENCY)  // Cast Spirit Armor for increased defense
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    HaveSpell(WIZARD_SPELL_TRIGGER) 
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,WIZARD_SPELL_TRIGGER) 
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END


IF
    ActionListEmpty()
    HaveSpell(WIZARD_MINOR_SEQUENCER) 
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,WIZARD_MINOR_SEQUENCER) 
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    HaveSpell(WIZARD_CHAIN_CONTINGENCY) 
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,WIZARD_CHAIN_CONTINGENCY) 
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    HaveSpell(WIZARD_SPELL_SEQUENCER) 
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,WIZARD_SPELL_SEQUENCER) 
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

// Cast Spirit Armor
// Casts Spirit Armor to provide a magical shield that improves the wizard's armor class.
// Lasts for 1 hour per caster level.
IF
    ActionListEmpty()
    HaveSpell(WIZARD_SPIRIT_ARMOR)  // SPWI414.SPL (Spirit Armor)
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,WIZARD_SPIRIT_ARMOR)  // Cast Spirit Armor for increased defense
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

// Cast Stoneskin
// Casts Stoneskin to grant the wizard protection from physical damage by turning their skin to stone.
// Lasts for 1 turn per caster level.
IF
    ActionListEmpty()
    HaveSpell(WIZARD_STONE_SKIN)  // SPWI408.SPL (Stoneskin)
    CheckStatLT(Myself,1,STONESKINS)
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,WIZARD_STONE_SKIN)  // Cast Stoneskin for increased damage resistance
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

// Cast Ghost Armor
// Casts Ghost Armor to provide an ethereal shield that grants a bonus to armor class.
// Lasts for 1 round per caster level.
IF
    ActionListEmpty()
    HaveSpell(WIZARD_GHOST_ARMOR)  // SPWI317.SPL (Ghost Armor)
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)  
    CheckStatLT(Myself,1,DEAD_MAGIC)   
    CheckStatGT(Myself,2,ARMORCLASS)   
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,WIZARD_GHOST_ARMOR)  // Cast Ghost Armor for improved defense
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

// Cast Armor
// Casts Armor to provide a magical armor that improves the wizard's armor class.
// Lasts for 1 hour per caster level.
IF
    ActionListEmpty()
    HaveSpell(WIZARD_ARMOR)  // SPWI102.SPL (Armor)
    CheckStatGT(Myself,6,ARMORCLASS)
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,WIZARD_ARMOR)  // Cast Armor for increased protection before combat
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

// Cast Shield
// Casts Shield to provide a magical shield that improves the wizard's armor class and grants a +4 bonus to AC.
// Lasts for 1 turn per caster level.
IF
    ActionListEmpty()
    HaveSpell(WIZARD_SHIELD)  // SPWI114.SPL (Shield)
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,WIZARD_SHIELD)  // Cast Shield for added protection
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

// Cast Protection from Normal Missiles
// Casts Protection from Normal Missiles to grant immunity to normal missile attacks.
// Lasts for 1 hour
IF
    ActionListEmpty()
    HaveSpell(WIZARD_PROTECTION_FROM_NORMAL_MISSILES)  // SPWI107.SPL (Protection from Normal Missiles)
    OR(3)
        LevelLT([ENEMY],12)
        !ActuallyInCombat()
        HitBy([ENEMY],MISSILE)
    //Check if missiles are normal 
    OR(4)
        !ActuallyInCombat() 
        HasItemEquiped("BULL01",[ENEMY])
        HasItemEquiped("AROW01",[ENEMY])
        HasItemEquiped("BOLT01",[ENEMY])
    CheckStatLT(Myself,1,WIZARD_PROTECTION_FROM_NORMAL_MISSILES)  // Check if Protection from Normal Missiles is already active
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,WIZARD_PROTECTION_FROM_NORMAL_MISSILES)  // Cast Protection from Normal Missiles
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

// Cast Resist Fear
// Casts Resist Fear to grant the wizard immunity to fear effects.
// Lasts for 1 turn per caster level.
IF
    !ActuallyInCombat()
    ActionListEmpty()
    HaveSpell(WIZARD_RESIST_FEAR)  // SPWI103.SPL (Resist Fear)
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")  // Ensure the spell is not recently cast
THEN
    RESPONSE #100
        Spell(Myself,WIZARD_RESIST_FEAR)  // Cast Resist Fear for protection against fear
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END
// Cast Protection from Petrification
// Casts Protection from Petrification to grant immunity to petrification attacks.
// Lasts for 1 hour
IF
    ActionListEmpty()
    !ActuallyInCombat()
    HaveSpell(WIZARD_PROTECTION_FROM_PETRIFICATION)  // SPWI212.SPL (Protection from Petrification)
    CheckStatLT(Myself,1,WIZARD_PROTECTION_FROM_PETRIFICATION)  // Check if Protection from Petrification is already active
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)
    GlobalTimerExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,WIZARD_PROTECTION_FROM_PETRIFICATION)  // Cast Protection from Petrification
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END


// ======================================================
// SECTION: Heal SPELLS (CLERIC)
// ======================================================


// Description: EXALTATION: This spell enables a priest to aid and protect any one being other than themselves. 
// By touch, the caster removes the effects of fear, sleep, feeblemind, unconsciousness, and intoxication, 
//as well as berserk and confused states of mind. In addition, the recipient is protected 
//against spells and other attacks that cause these effects for 1 turn.
IF
    ActionListEmpty()
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
    HaveSpellRES("OHTYR1") //Exaltation filename. 
    See([PC])
    OR(8)
        GlobalTimerNotExpired("CASTER_ENEMY","LOCALS")
        CheckStat(LastSeenBy(Myself),1,WEB)
        CheckStat(LastSeenBy(Myself),1,GREASE)
        StateCheck(LastSeenBy(Myself),STATE_HELPLESS)
        StateCheck(LastSeenBy(Myself),STATE_SLEEPING)
        StateCheck(LastSeenBy(Myself),STATE_FEEBLEMINDED)
        StateCheck(LastSeenBy(Myself),STATE_PANIC)
        StateCheck(LastSeenBy(Myself),STATE_CONFUSED)
THEN
    RESPONSE #100
        SpellRES("OHTYR1",LastSeenBy(Myself))
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
    HaveSpell(CLERIC_FREE_ACTION) //Exaltation filename. 
    See([PC])
    !CheckSpellState(LastSeenBy(Myself),FREE_ACTION)
    OR(3)
        CheckStat(LastSeenBy(Myself),1,WEB)
        CheckStat(LastSeenBy(Myself),1,GREASE)
        CheckSpellState(LastSeenBy(Myself),ENTANGLE)
THEN
    RESPONSE #100
        Spell(LastSeenBy(Myself),CLERIC_FREE_ACTION)
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
    HaveSpell(CLERIC_FREE_ACTION) //Exaltation filename. 
    !CheckSpellState(Myself,FREE_ACTION)
    OR(3)
        CheckStat(LastSeenBy(Myself),1,WEB)
        CheckStat(LastSeenBy(Myself),1,GREASE)
        CheckSpellState(LastSeenBy(Myself),ENTANGLE)
THEN
    RESPONSE #100
        Spell(Myself,CLERIC_FREE_ACTION)
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    OR(3)
        HPPercentLT(Myself,60) // Heal when HP is below 20
        StateCheck(Myself,STATE_DISEASED)
        CheckSpellState(Myself,NAUSEA)
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
    HaveSpell(CLERIC_HEAL)
THEN
    RESPONSE #100
        Spell(LastSeenBy(Myself),CLERIC_HEAL)
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND) // Set a 2-minute timer
END

/*
Regeneration
(Necromancy)

Level: 7
Sphere: Healing
Range: Touch
Duration: 1 round/2 levels
Casting Time: 7
Area of Effect: 1 creature
Saving Throw: None 

This powerful spell enables the priest to imbue one creature with the ability to regenerate. This regeneration will heal any wounds and even regenerate lost limbs. The creature affected will regain 3 Hit Points per second. The effect lasts for 1 round per 2 levels of the caster or until dispelled. For example, a 14th-level priest would regenerate 18 Hit Points per round for 7 rounds.
*/
IF
    ActionListEmpty()
    HPPercentLT([PC],60) // Heal when HP is below 20
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
    HaveSpell(CLERIC_REGENERATE)
THEN
    RESPONSE #100
        Spell([PC],CLERIC_REGENERATE)
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND) // Set a 2-minute timer
END

IF
    ActionListEmpty()
    StateCheck([PC],STATE_REALLY_DEAD)
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
    HaveSpell(CLERIC_RESURRECTION)
THEN
    RESPONSE #100
        Spell([PC],CLERIC_RESURRECTION)
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND) // Set a 2-minute timer
END

IF
    ActionListEmpty()
    StateCheck([PC],STATE_REALLY_DEAD)
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
    HaveSpell(CLERIC_MASS_RAISE_DEAD)
THEN
    RESPONSE #100
        Spell([PC],CLERIC_MASS_RAISE_DEAD)
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND) // Set a 2-minute timer
END

IF
    ActionListEmpty()
    StateCheck([PC],STATE_POISONED)
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
    HaveSpell(CLERIC_SLOW_POISON)
THEN
    RESPONSE #100
        Spell([PC],CLERIC_SLOW_POISON)
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND) // Set a 2-minute timer
END

/*
Neutralize Poison
(Necromancy)

Level: 4
Sphere: Healing 
Range: Touch 
Duration: Instant 
Casting Time: 1 
Area of Effect: 1 creature 
Saving Throw: None 

This spell removes all toxins from the body, both natural and magical in nature. 
When this spell is cast upon a poisoned individual, it immediately neutralizes any poison 
and restores 10 lost Hit Points. This spell will also cure any diseases that the target might
be suffering from, as well as blindness and deafness.
*/
IF
    ActionListEmpty()
    OR(5)
        StateCheck([PC],STATE_DISEASED)
        StateCheck([PC],STATE_BLIND)
        StateCheck([PC],STATE_FEEBLEMINDED)
        CheckSpellState([PC],DEAFENED)
        StateCheck([PC],STATE_POISONED)
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
    HaveSpell(CLERIC_NEUTRALIZE_POISON)
THEN
    RESPONSE #100
        Spell([PC],CLERIC_NEUTRALIZE_POISON)
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND) // Set a 2-minute timer
END

IF
    ActionListEmpty()
    See([PC])
    OR(3)
        HPPercentLT(LastSeenBy(Myself),60) // Heal when HP is below 20
        StateCheck(LastSeenBy(Myself),STATE_DISEASED)
        CheckSpellState(LastSeenBy(Myself),NAUSEA)
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
    HaveSpell(CLERIC_HEAL)
THEN
    RESPONSE #100
        Spell(LastSeenBy(Myself),CLERIC_HEAL)
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND) // Set a 2-minute timer
END

// Heal Light Wounds
IF
    ActionListEmpty()
    See([PC])
    HPPercentLT([PC],70) // Heal when HP is below 70
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
    HaveSpell(CLERIC_MASS_CURE)
THEN
    RESPONSE #100
        Spell(LastSeenBy(Myself),CLERIC_MASS_CURE)
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND) // Set a 2-minute timer (adjust as needed)
END

IF
    ActionListEmpty()
    See([PC])
    HPPercentLT([PC],70) // Heal when HP is below 70
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
    HaveSpell(CLERIC_CURE_MEDIUM_WOUNDS)
THEN
    RESPONSE #100
        Spell([PC],CLERIC_CURE_MEDIUM_WOUNDS)
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND) // Set a 2-minute timer (adjust as needed)
END

// Heal Serious Wounds
IF
    ActionListEmpty()
    See([PC])
    HPPercentLT([PC],60) // Heal when HP is below 50%
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
    HaveSpell(CLERIC_CURE_SERIOUS_WOUNDS)
THEN
    RESPONSE #100
        Spell([PC],CLERIC_CURE_SERIOUS_WOUNDS)
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND) // Set a 2-minute timer
END

IF
    ActionListEmpty()
    See([PC])
    HPPercentLT([PC],70) // Heal when HP is below 70%
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
    HaveSpell(CLERIC_AID)
THEN
    RESPONSE #100
        Spell(LastSeenBy(Myself),CLERIC_AID)
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND) // Set a 2-minute timer (adjust as needed)
END

// Heal Light Wounds
IF
    ActionListEmpty()
    See([PC])
    HPPercentLT([PC],70) // Heal when HP is below 70
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
    HaveSpell(CLERIC_CURE_LIGHT_WOUNDS)
THEN
    RESPONSE #100
        Spell(LastSeenBy(Myself),CLERIC_CURE_LIGHT_WOUNDS)
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

//Innate cure light wounds
IF
    ActionListEmpty()
    ActuallyInCombat()
    HaveSpellRES("SPIN101")  
    HPPercentLT([PC],70) // Heal when HP is below 70%
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
THEN
    RESPONSE #100
        SpellRES("SPIN101",[PC]) 
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END


IF
    ActionListEmpty()
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
    OR(3)
        StateCheck([PC],STATE_STUNNED)
        CheckStatGT([PC],0,HELD)
        StateCheck([PC],STATE_HELPLESS)
    HaveSpell(CLERIC_REMOVE_PARALYSIS)  // SPPR308.SPL (Remove Paralysis)
THEN
    RESPONSE #100
        SetInterrupt(FALSE)
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
        Spell([PC],CLERIC_REMOVE_PARALYSIS)  // SPPR308.SPL (Remove Paralysis)
        SetInterrupt(TRUE)
END

IF
    ActionListEmpty()
    HaveSpell(CLERIC_CHAOTIC_COMMANDS)  // SPPR303.SPL (Dispel Magic)
    OR(2)
        StateCheck([PC],STATE_CHARMED)
        StateCheck([PC],STATE_CONFUSED)
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell([PC],CLERIC_CHAOTIC_COMMANDS)  // SPPR303.SPL (Dispel Magic)
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND) // Set a 2-minute timer
END

IF
    ActionListEmpty()
    HaveSpell(CLERIC_DISPEL_MAGIC)  
    See([PC])
    OR(5)
        StateCheck([PC],STATE_CHARMED)
        StateCheck([PC],STATE_CONFUSED)
        StateCheck([PC],STATE_STUNNED)
        CheckStatGT([PC],0,CLERIC_INSECT_PLAGUE)
        CheckStatGT([PC],0,HELD)
THEN
    RESPONSE #100
        Spell([PC],CLERIC_DISPEL_MAGIC)  
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND) 
END

IF
    HaveSpell(CLERIC_FREE_ACTION) 
    OR(3)
        CheckStatGT([PC],0,HELD)
        CheckStatGT([PC],0,GREASE)
        CheckStatGT([PC],0,WEB)
THEN
    RESPONSE #70
        Spell([PC],CLERIC_FREE_ACTION)  
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
    RESPONSE #30
        Continue()
END

IF
    ActionListEmpty()
    See(NearestEnemyOf(Myself))
    OR(3)
        StateCheck([PC],STATE_STUNNED)
        CheckStatGT([PC],0,HELD)
        CheckStatGT([PC],0,LEVELDRAIN)
    HaveSpell(CLERIC_RESTORATION) 
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
    THEN
        RESPONSE #100
        Spell(LastSeenBy(Myself),CLERIC_RESTORATION)  
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

/*
Cure Disease
(Abjuration)

Level: 3
Sphere: Necromantic
Range: Touch
Duration: Permanent
Casting Time: 1
Area of Effect: 1 creature
Saving Throw: None

By laying <PRO_HISHER> hands upon a sickly person, the caster can cure almost any disease with this spell. 
The cure is permanent, but does not grant the recipient of the spell immunity from further afflictions. 
Blindness, deafness, and feeblemind are also cured with this spell. Some magically created diseases may not be curable by this spell.
*/
IF
    ActionListEmpty()
    HaveSpell(CLERIC_CURE_DISEASE)
    OR(4)
        StateCheck([PC],STATE_DISEASED)
        StateCheck([PC],STATE_BLIND)
        StateCheck([PC],STATE_FEEBLEMINDED)
        CheckSpellState([PC],DEAFENED)
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
    THEN
        RESPONSE #100
        Spell([PC],CLERIC_CURE_DISEASE)  
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    See([PC])
    HaveSpell(CLERIC_LESSER_RESTORATION)
    OR(3)
        StateCheck([PC],STATE_STUNNED)
        CheckStatGT([PC],0,HELD)
        CheckStatGT([PC],0,LEVELDRAIN)
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")

    THEN
        RESPONSE #100
        Spell([PC],CLERIC_LESSER_RESTORATION)  
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

// Heal Critical Wounds
IF
    ActionListEmpty()
    See([PC])
    HPPercentLT([PC],60) // Heal when HP is below 20
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
    HaveSpell(CLERIC_CURE_CRITICAL_WOUNDS)
THEN
    RESPONSE #100
        Spell([PC],CLERIC_CURE_CRITICAL_WOUNDS)
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND) // Set a 2-minute timer
END

IF
    ActionListEmpty()
    See([PC])
    HPPercentLT([PC],75)
    HaveSpell(PALADIN_LAY_ON_HANDS)  // 4211 (PALADIN_LAY_ON_HANDS)
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
    THEN
        RESPONSE #100
        Spell([PC],PALADIN_LAY_ON_HANDS)  // Cast PALADIN_LAY_ON_HANDS
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

// ======================================================
//  SECTIONL: Heal (WIZARD)
// ======================================================

IF
    ActionListEmpty()
    HaveSpell(WIZARD_DISPEL_MAGIC)  // SPPR303.SPL (Dispel Magic)
    See([PC])
    OR(4)
        StateCheck(LastSeenBy(Myself),STATE_CHARMED)
        StateCheck(LastSeenBy(Myself),STATE_CONFUSED)
        StateCheck(LastSeenBy(Myself),STATE_STUNNED)
        CheckStatGT(LastSeenBy(Myself),0,HELD)
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(LastSeenBy(Myself),WIZARD_DISPEL_MAGIC)  // SPPR303.SPL (Dispel Magic)
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND) // Set a 2-minute timer
END



// ======================================================
// SECTION: Heal ITEMS 
// ======================================================

/*
When consumed, this potion restores 40 Hit Points to the imbiber. The effect is instantaneous, and the potion is destroyed in the process.

STATISTICS:

Special: Restores 40 Hit Points

Weight: 1
*/
IF
    ActionListEmpty()
    ActuallyInCombat()
    OR(2)
        HPPercentLT(Myself,60)
        DamageTakenGT(40)
    PartyHasItem("POTN55")  
    Delay(16)
THEN
    RESPONSE #100
        TakePartyItemNum("POTN55",1)
        UseItem("POTN55",Myself)  
END

/*
When wholly consumed, this potion restores 9 Hit Points to the person. The effect is instantaneous and the potion is destroyed in the process.

STATISTICS:

Special: Restores 9 Hit Points.

Weight: 1
*/
IF
    ActionListEmpty()
    ActuallyInCombat()
    OR(2)
        DamageTakenGT(9)
        HPPercentLT(Myself,60)
    PartyHasItem("IPOTN08")  
    Delay(16)
THEN
    RESPONSE #100
        TakePartyItemNum("IPOTN08",1)
        UseItem("IPOTN08",Myself)  
END

/*
When wholly consumed, this potion restores 27 Hit Points to the person. The effect is instantaneous, and the potion is destroyed in the process.

STATISTICS:

Special: Restores 27 Hit Points

Weight: 1
*/
IF
    ActionListEmpty()
    ActuallyInCombat()
    OR(2)
        DamageTakenGT(27)
        HPPercentLT(Myself,60)
    PartyHasItem("POTN52")  
    Delay(16)

THEN
    RESPONSE #100
        TakePartyItemNum("POTN52",1)
        UseItem("POTN52",Myself) 
END

IF
    ActionListEmpty()
    ActuallyInCombat()
    HPPercentLT(Myself,50)
    PartyHasItem("POTN08") 
    Delay(16)
THEN
    RESPONSE #100
        TakePartyItemNum("POTN08",1)
        UseItem("POTN08",Myself)
END

IF
    ActionListEmpty()
    ActuallyInCombat()
    HPPercentLT(Myself,35)
    !StateCheck(Myself,STATE_INVISIBLE)
    PartyHasItem("POTN10")  // Potion of Invisibility
THEN
    RESPONSE #100
        TakePartyItemNum("POTN10",1)
        UseItem("POTN10",Myself)  
        RunAwayFrom(NearestEnemyOf(Myself),75)
END

IF
    ActionListEmpty()
    !CheckSpellState(Myself,POTION_OF_CLARITY)
    !ExtendedStateCheck(Myself,STATE_CHAOTIC_COMMANDS)
    CheckStatLT(Myself,1,CLERIC_CHAOTIC_COMMANDS)    
    GlobalTimerNotExpired("PSYCHIC_ENEMIES","LOCALS")
    PartyHasItem("POTN21")  // Potion of Clarity
    OR(2)
        Class(Myself,FIGHTER)
        Class(Myself,PALADIN)
    Delay(60)
THEN
    RESPONSE #100
        TakePartyItemNum("POTN21",1)
        UseItem("POTN21",Myself)  
END

//Potion of Speed
IF
    ActionListEmpty()
    ActuallyInCombat()
    !StateCheck(Myself,STATE_HASTED)
    PartyHasItem("POTN23")
    HPGT([ENEMY],60)
    OR(2)
        NumCreatureGT([ENEMY],4)
        LevelGT([ENEMY],5)
    OR(4)
        Class(Myself,FIGHTER)
        Class(Myself,RANGER)
        Class(Myself,THIEF)
        Class(Myself,PALADIN)
    Delay(60)
THEN
    RESPONSE #50
        Continue()
    RESPONSE #50
        TakePartyItemNum("POTN23",1)
        UseItem("POTN23",Myself)  
END

//Potion of Speed
IF
    ActionListEmpty()
    ActuallyInCombat()
    !StateCheck(Myself,STATE_HASTED)
    PartyHasItem("POTN14")
    HPGT([ENEMY],60)
    OR(2)
        NumCreatureGT([ENEMY],4)
        LevelGT([ENEMY],5)
    OR(4)
        Class(Myself,FIGHTER)
        Class(Myself,RANGER)
        Class(Myself,THIEF)
        Class(Myself,PALADIN)
    Delay(60)
THEN
    RESPONSE #50
        Continue()
    RESPONSE #50
        TakePartyItemNum("POTN14",1)
        UseItem("POTN14",Myself)  
END

//Potion of Heroism 
IF
    ActionListEmpty()
    ActuallyInCombat()
    PartyHasItem("POTN09")
    LevelGT([ENEMY],7)
    HPGT([ENEMY],70)
    OR(4)
        Class(Myself,FIGHTER)
        Class(Myself,RANGER)
        Class(Myself,THIEF)
        Class(Myself,PALADIN)
    Delay(60)
THEN
    RESPONSE #50
        Continue()
    RESPONSE #50
        TakePartyItemNum("POTN09",1)
        UseItem("POTN09",Myself)  
END

// Potion of Defence (24)

//Potion of Heroism 
IF
    ActionListEmpty()
    ActuallyInCombat()
    PartyHasItem("POTN24")
    LevelGT([ENEMY],7)
    HPGT([ENEMY],70)
    CheckStatGT(Myself,0,ARMORCLASS)
    Delay(60)
THEN
    RESPONSE #50
        Continue()
    RESPONSE #50
        TakePartyItemNum("POTN24",1)
        UseItem("POTN24",Myself)  
END

IF
    ActionListEmpty()
    !CheckSpellState(Myself,FREE_ACTION)
    CheckStatLT(Myself,1,CLERIC_FREE_ACTION)    
    Delay(100)
    GlobalTimerNotExpired("PSYCHIC_ENEMIES","LOCALS")
    PartyHasItem("POTN45")  // Potion of Freedom
THEN
    RESPONSE #100
        TakePartyItemNum("POTN45",1)
        UseItem("POTN45",Myself)  
END

//Poison Management
IF
    ActionListEmpty()
    StateCheck(Myself,STATE_POISONED)
    PartyHasItem("POTN20") // Antidote
THEN
    RESPONSE #100
        TakePartyItemNum("POTN20",1)
        UseItem("POTN20",Myself) // Antidote
END

IF
    ActionListEmpty()
    ActuallyInCombat()
    StateCheck(Myself,STATE_POISONED)
    GlobalLT("USED_AMUL22","LOCALS",1)
    HasItemEquiped("AMUL22",Myself) 
THEN
    RESPONSE #100
      SetInterrupt(FALSE)
      UseItem("AMUL22",Myself)  
      SetInterrupt(TRUE)
      IncrementGlobal("USED_AMUL22","LOCALS",1)
END

IF
    ActionListEmpty()
    ActuallyInCombat()
    See([PC])
    StateCheck(LastSeenBy(Myself),STATE_POISONED)
    GlobalLT("USED_AMUL22","LOCALS",1)
    HasItemEquiped("AMUL22",Myself) 
THEN
    RESPONSE #100
      SetInterrupt(FALSE)
      UseItem("AMUL22",LastSeenBy(Myself))  
      SetInterrupt(TRUE)
      IncrementGlobal("USED_AMUL22","LOCALS",1)
END

//Innate cure poison
IF
    ActionListEmpty()
    ActuallyInCombat()
    HaveSpellRES("SPIN102")  
    StateCheck([PC],STATE_POISONED)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
THEN
    RESPONSE #100
        SpellRES("SPIN102",[PC])  // Cast Holy Power for increased strength
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

/*
The elixir of health is a powerful healing mixture designed to cleanse the body of all impurities. First, it cures all poisons and diseases; then, once the system has been purged, the imbibed is cured by 10 Hit Points to speed the recovery process.

STATISTICS:

Special: Cures poison and disease and heals 10 Hit Points

Weight: 1
*/
IF
    ActionListEmpty()
    ActuallyInCombat()
    OR(3)
        HPPercentLT(Myself,60)
        StateCheck(Myself,STATE_POISONED)
        StateCheck(Myself,STATE_DISEASED)
    PartyHasItem("POTN17") // Elixir of Health 
    Delay(16)
THEN
    RESPONSE #100
        TakePartyItemNum("POTN17",1)
        UseItem("POTN17",Myself) // Elixir of Health
END


// ======================================================
// SECTION: PENETRATION SPELLS (WIZARD)
// ======================================================

IF
    ActuallyInCombat()
    ActionListEmpty()
    OR(6)
    See([ENEMY.0.0.MAGE_ALL])
    See([ENEMY.0.0.CLERIC_ALL])
    See([ENEMY.0.0.BARD_ALL])
    See([ENEMY.0.0.DRUID_ALL])
    See([ENEMY.0.0.SORCERER])
    See([ENEMY.0.0.RAKSHASA])    
    HaveSpell(WIZARD_SPELL_STRIKE)  
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
    THEN
        RESPONSE #100
        Spell(LastSeenBy(Myself),WIZARD_SPELL_STRIKE)  
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

IF
    ActuallyInCombat()
    ActionListEmpty()
    See([ENEMY])
    !StateCheck(LastSeenBy(Myself),STATE_NOT_TARGETABLE)
    !ImmuneToSpellLevel(LastSeenBy(Myself),5)
    OR(5)
        CheckStatGT(LastSeenBy(Myself),0,STONESKINS)
        CheckSpellState(LastSeenBy(Myself),PROTECTION_FROM_MAGICAL_WEAPONS)
        CheckSpellState(LastSeenBy(Myself),MANTLE)
        CheckSpellState(LastSeenBy(Myself),IMPROVED_MANTLE)
        CheckSpellState(LastSeenBy(Myself),ABSOLUTE_IMMUNITY)
    !CheckStatGT(Myself,0,CLERIC_INSECT_PLAGUE)
    !StateCheck(Myself,STATE_SILENCED)
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
    HaveSpell(WIZARD_PIERCE_SHIELD)
    THEN
        RESPONSE #100
        SetInterrupt(FALSE)
        Spell(LastSeenBy(Myself),WIZARD_PIERCE_SHIELD)  
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
        SetInterrupt(TRUE)
END

IF
    ActuallyInCombat()
    ActionListEmpty()
    See([ENEMY])
    !StateCheck(LastSeenBy(Myself),STATE_NOT_TARGETABLE)
    !ImmuneToSpellLevel(LastSeenBy(Myself),5)
    OR(5)
        CheckStatGT(LastSeenBy(Myself),0,STONESKINS)
        CheckSpellState(LastSeenBy(Myself),PROTECTION_FROM_MAGICAL_WEAPONS)
        CheckSpellState(LastSeenBy(Myself),MANTLE)
        CheckSpellState(LastSeenBy(Myself),IMPROVED_MANTLE)
        CheckSpellState(LastSeenBy(Myself),ABSOLUTE_IMMUNITY)
    !CheckStatGT(Myself,0,CLERIC_INSECT_PLAGUE)
    !StateCheck(Myself,STATE_SILENCED)
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
    HaveSpell(WIZARD_BREACH)
    THEN
        RESPONSE #100
        SetInterrupt(FALSE)
        Spell(LastSeenBy(Myself),WIZARD_BREACH)  
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
        SetInterrupt(TRUE)
END

IF
    ActuallyInCombat()
    ActionListEmpty()
    See([ENEMY])
    !StateCheck(LastSeenBy(Myself),STATE_NOT_TARGETABLE)
    !ImmuneToSpellLevel(LastSeenBy(Myself),5)
    OR(5)
        CheckStatGT(LastSeenBy(Myself),0,STONESKINS)
        CheckSpellState(LastSeenBy(Myself),PROTECTION_FROM_MAGICAL_WEAPONS)
        CheckSpellState(LastSeenBy(Myself),MANTLE)
        CheckSpellState(LastSeenBy(Myself),IMPROVED_MANTLE)
        CheckSpellState(LastSeenBy(Myself),ABSOLUTE_IMMUNITY)
    !CheckStatGT(Myself,0,CLERIC_INSECT_PLAGUE)
    !StateCheck(Myself,STATE_SILENCED)
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
    HaveSpellRES("SPWI302") //Use spell res here, otherwise the game can't find the id in bgee 1. In 2 it exists. 
    THEN
        RESPONSE #100
        SetInterrupt(FALSE)
        SpellRES("SPWI302",LastSeenBy(Myself))  
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
        SetInterrupt(TRUE)
END

IF
    ActuallyInCombat()
    ActionListEmpty()
    See([ENEMY])
    !StateCheck(LastSeenBy(Myself),STATE_NOT_TARGETABLE)
    !ImmuneToSpellLevel(LastSeenBy(Myself),5)
    OR(5)
        CheckStatGT(LastSeenBy(Myself),0,STONESKINS)
        CheckSpellState(LastSeenBy(Myself),PROTECTION_FROM_MAGICAL_WEAPONS)
        CheckSpellState(LastSeenBy(Myself),MANTLE)
        CheckSpellState(LastSeenBy(Myself),IMPROVED_MANTLE)
        CheckSpellState(LastSeenBy(Myself),ABSOLUTE_IMMUNITY)
    !CheckStatGT(Myself,0,CLERIC_INSECT_PLAGUE)
    !StateCheck(Myself,STATE_SILENCED)
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
    HaveSpell(WIZARD_DISPEL_MAGIC)
    THEN
        RESPONSE #100
        SetInterrupt(FALSE)
        Spell(LastSeenBy(Myself),WIZARD_DISPEL_MAGIC)
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
        SetInterrupt(TRUE)
END

IF
    ActuallyInCombat()
    ActionListEmpty()
    See([ENEMY])
    !StateCheck(LastSeenBy(Myself),STATE_NOT_TARGETABLE)
    !ImmuneToSpellLevel(LastSeenBy(Myself),3)
    OR(5)
        CheckStatGT(LastSeenBy(Myself),0,STONESKINS)
        CheckSpellState(LastSeenBy(Myself),PROTECTION_FROM_MAGICAL_WEAPONS)
        CheckSpellState(LastSeenBy(Myself),MANTLE)
        CheckSpellState(LastSeenBy(Myself),IMPROVED_MANTLE)
        CheckSpellState(LastSeenBy(Myself),ABSOLUTE_IMMUNITY)
    !CheckStatGT(Myself,0,CLERIC_INSECT_PLAGUE)
    !StateCheck(Myself,STATE_SILENCED)
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
    HaveSpell(WIZARD_SPELL_THRUST)
    THEN
        RESPONSE #100
        SetInterrupt(FALSE)
        Spell(LastSeenBy(Myself),WIZARD_SPELL_THRUST)  
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
        SetInterrupt(TRUE)
END

IF
    ActuallyInCombat()
    ActionListEmpty()
    See([ENEMY])
    !StateCheck(LastSeenBy(Myself),STATE_NOT_TARGETABLE)
    !ImmuneToSpellLevel(LastSeenBy(Myself),4)
    OR(5)
        CheckStatGT(LastSeenBy(Myself),0,STONESKINS)
        CheckSpellState(LastSeenBy(Myself),PROTECTION_FROM_MAGICAL_WEAPONS)
        CheckSpellState(LastSeenBy(Myself),MANTLE)
        CheckSpellState(LastSeenBy(Myself),IMPROVED_MANTLE)
        CheckSpellState(LastSeenBy(Myself),ABSOLUTE_IMMUNITY)
    !CheckStatGT(Myself,0,CLERIC_INSECT_PLAGUE)
    !StateCheck(Myself,STATE_SILENCED)
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
    HaveSpell(WIZARD_SECRET_WORD)
    THEN
        RESPONSE #100
        SetInterrupt(FALSE)
        Spell(LastSeenBy(Myself),WIZARD_SECRET_WORD)  
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
        SetInterrupt(TRUE)
END


IF
    ActionListEmpty()
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
    HaveSpell(WIZARD_POWER_WORD_SILENCE)  // SPWI612.SPL (Power Word, Silence)
    OR(3)
        See([ENEMY.0.0.CLERIC_ALL])
        See([ENEMY.0.0.BARD_ALL])
        See([ENEMY.0.0.MAGE_ALL])
    !StateCheck(LastSeenBy(Myself),STATE_SILENCED)
    !StateCheck(LastSeenBy(Myself),STATE_HARMLESS)
    !CheckStatGT(LastSeenBy(Myself),0,WIZARD_SPELL_TURNING)
    !CheckStat(LastSeenBy(Myself),1,CLERIC_SHIELD_OF_THE_ARCHONS)
    !HasItemEquiped("AMUL21",LastSeenBy(Myself))  // Amulet of Power
    CheckStatLT(LastSeenBy(Myself),50,RESISTMAGIC)
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    !CheckStatGT(Myself,0,CLERIC_INSECT_PLAGUE)
    !StateCheck(Myself,STATE_SILENCED)
THEN
    RESPONSE #100
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
        Spell(LastSeenBy(Myself),WIZARD_POWER_WORD_SILENCE)  // SPWI612.SPL (Power Word, Silence)
END


IF
    ActionListEmpty()
    ActuallyInCombat()
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
    HaveSpell(WIZARD_DEAFNESS)  // SPWI612.SPL (Power Word, Silence)
    OR(3)
        See([ENEMY.0.0.CLERIC_ALL])
        See([ENEMY.0.0.BARD_ALL])
        See([ENEMY.0.0.MAGE_ALL])
    !StateCheck(LastSeenBy(Myself),STATE_SILENCED)
    !StateCheck(LastSeenBy(Myself),STATE_HARMLESS)
    !CheckStatGT(LastSeenBy(Myself),0,WIZARD_SPELL_TURNING)
    !CheckStat(LastSeenBy(Myself),1,CLERIC_SHIELD_OF_THE_ARCHONS)
    !HasItemEquiped("AMUL21",LastSeenBy(Myself))  // Amulet of Power
    CheckStatLT(LastSeenBy(Myself),50,RESISTMAGIC)
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    !CheckStatGT(Myself,0,CLERIC_INSECT_PLAGUE)
    !StateCheck(Myself,STATE_SILENCED)
THEN
    RESPONSE #100
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
        Spell(LastSeenBy(Myself),WIZARD_DEAFNESS)  // SPWI612.SPL (Power Word, Silence)
END

IF
    ActuallyInCombat()
    ActionListEmpty()  
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
    HaveSpell(WIZARD_GLITTERDUST) 
    See([ENEMY])
    !ImmuneToSpellLevel(LastSeenBy(Myself),2)
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    !CheckStatGT(Myself,0,CLERIC_INSECT_PLAGUE)
    !StateCheck(Myself,STATE_SILENCED)
    CheckStatGT(LastSeenBy(Myself),7,SAVEVSSPELL)
    CheckStatLT(LastSeenBy(Myself),50,RESISTMAGIC)
    CheckStat(LastSeenBy(Myself),0,MINORGLOBE)
    !HasItemEquiped("NPMISC1",LastSeenBy(Myself))  // Jansen Spectroscopes
THEN
    RESPONSE #100
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
        Spell(Myself,WIZARD_GLITTERDUST) 
END

IF
    ActuallyInCombat()
    ActionListEmpty()
    OR(6)
        See([ENEMY.0.0.MAGE_ALL])
        See([ENEMY.0.0.CLERIC_ALL])
        See([ENEMY.0.0.BARD_ALL])
        See([ENEMY.0.0.DRUID_ALL])
        See([ENEMY.0.0.SORCERER])
        See([ENEMY.0.0.RAKSHASA])    
    HaveSpell(WIZARD_PIERCE_MAGIC)  
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
    THEN
        RESPONSE #100
        Spell(LastSeenBy(Myself),WIZARD_PIERCE_MAGIC)  
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END
/*
Ruby Ray Of Reversal
(Alteration)

Level: 7
Range: 40 ft.
Duration: Instant
Casting Time: 5
Area of Effect: 1 creature
Saving Throw: None

When this spell is cast, it dispels one spell protection of any level affecting the target creature. The spells affected by Ruby Ray Of Reversal are Minor Spell Turning, Minor Globe of Invulnerability, Spell Immunity, Globe Of Invulnerability, Minor Spell Deflection, Spell Turning, Spell Shield, Spell Deflection, and Spell Trap. This will always remove the highest-level spell protection affecting the target; if more than one same-level protection is active on the target simultaneously, one of them will be randomly chosen and dispelled. The target's Magic Resistance, if any, does not affect this spell.
*/
IF
    ActuallyInCombat()
    ActionListEmpty()
    OR(6)
        See([ENEMY.0.0.MAGE_ALL])
        See([ENEMY.0.0.CLERIC_ALL])
        See([ENEMY.0.0.BARD_ALL])
        See([ENEMY.0.0.DRUID_ALL])
        See([ENEMY.0.0.SORCERER])
        See([ENEMY.0.0.RAKSHASA])    
    HaveSpell(WIZARD_RUBY_RAY_OF_REVERSAL)  
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
    THEN
        RESPONSE #100
        Spell(LastSeenBy(Myself),WIZARD_RUBY_RAY_OF_REVERSAL)  
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    OR(7)
        Gender(LastSeenBy(Myself),ILLUSIONARY)
        SpellCast([ENEMY],WIZARD_PROJECT_IMAGE) 
        SpellCast([ENEMY],WIZARD_SIMULACRUM)  
        SpellCast([ENEMY],WIZARD_MISLEAD)  
        StateCheck(LastSeenBy(Myself),STATE_BLUR)
        StateCheck(LastSeenBy(Myself),STATE_MIRRORIMAGE)
        Class([ENEMY],THIEF_ALL)
    GlobalTimerNotExpired("SHORT_BUFF","LOCALS")
    Delay(30)
    HaveSpell(WIZARD_ORACLE) 
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
    THEN
        RESPONSE #100
        Spell(Myself,WIZARD_ORACLE)
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    OR(7)
        Gender(LastSeenBy(Myself),ILLUSIONARY)
        SpellCast([ENEMY],WIZARD_PROJECT_IMAGE) 
        SpellCast([ENEMY],WIZARD_SIMULACRUM)  
        SpellCast([ENEMY],WIZARD_MISLEAD)  
        StateCheck(LastSeenBy(Myself),STATE_BLUR)
        StateCheck(LastSeenBy(Myself),STATE_MIRRORIMAGE)
        Class([ENEMY],THIEF_ALL)
    GlobalTimerNotExpired("SHORT_BUFF","LOCALS")
    Delay(30)
    HaveSpell(WIZARD_TRUE_SIGHT) 
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
    THEN
        RESPONSE #100
        Spell(Myself,WIZARD_TRUE_SIGHT)
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    OR(7)
        Gender(LastSeenBy(Myself),ILLUSIONARY)
        SpellCast([ENEMY],WIZARD_PROJECT_IMAGE) 
        SpellCast([ENEMY],WIZARD_SIMULACRUM)  
        SpellCast([ENEMY],WIZARD_MISLEAD)  
        StateCheck(LastSeenBy(Myself),STATE_BLUR)
        StateCheck(LastSeenBy(Myself),STATE_MIRRORIMAGE)
        Class([ENEMY],THIEF_ALL)
    GlobalTimerNotExpired("SHORT_BUFF","LOCALS")
    Delay(30)
    HaveSpell(WIZARD_DETECT_INVISIBILITY) 
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
    THEN
        RESPONSE #100
        Spell(Myself,WIZARD_DETECT_INVISIBILITY)
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

IF
    ActuallyInCombat()
    ActionListEmpty()
    OR(6)
        See([ENEMY.0.0.MAGE_ALL])
        See([ENEMY.0.0.CLERIC_ALL])
        See([ENEMY.0.0.BARD_ALL])
        See([ENEMY.0.0.DRUID_ALL])
        See([ENEMY.0.0.SORCERER])
        See([ENEMY.0.0.RAKSHASA])    
    HaveSpell(WIZARD_WARDING_WHIP)  
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
    THEN
        RESPONSE #100
        Spell(NearestEnemyOf(Myself),WIZARD_WARDING_WHIP)  // Cast WIZARD_WARDING_WHIP
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

IF
    ActuallyInCombat()
    ActionListEmpty()
    OR(6)
        See([ENEMY.0.0.MAGE_ALL])
        See([ENEMY.0.0.CLERIC_ALL])
        See([ENEMY.0.0.BARD_ALL])
        See([ENEMY.0.0.DRUID_ALL])
        See([ENEMY.0.0.SORCERER])
        See([ENEMY.0.0.RAKSHASA])    
    HaveSpell(WIZARD_PIERCE_MAGIC)  // 2608 (WIZARD_PIERCE_MAGIC)
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
    THEN
        RESPONSE #100
        Spell(LastSeenBy(Myself),WIZARD_PIERCE_MAGIC)  // Cast WIZARD_PIERCE_MAGIC
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END


// ======================================================
// SECTION PENETRATION SPELLS (CLERIC)
// ======================================================

IF
    ActionListEmpty()
    OR(6)
        See([ENEMY.0.0.MAGE_ALL])
        See([ENEMY.0.0.CLERIC_ALL])
        See([ENEMY.0.0.BARD_ALL])
        See([ENEMY.0.0.DRUID_ALL])
        See([ENEMY.0.0.SORCERER])
        See([ENEMY.0.0.RAKSHASA])
    ActuallyInCombat()
    ActionListEmpty()
    HaveSpell(CLERIC_DISPEL_MAGIC)  // 1303 (CLERIC_DISPEL_MAGIC)
    !Range([ENEMY],10)
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
    THEN
        RESPONSE #100
        Spell(LastSeenBy(Myself),CLERIC_DISPEL_MAGIC)  // Cast CLERIC_DISPEL_MAGIC
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    ActuallyInCombat()
    OR(7)
        See([ENEMY])
        See([ENEMY.0.0.MAGE_ALL])
        See([ENEMY.0.0.CLERIC_ALL])
        See([ENEMY.0.0.BARD_ALL])
        See([ENEMY.0.0.DRUID_ALL])
        See([ENEMY.0.0.SORCERER])
        See([ENEMY.0.0.RAKSHASA])
    OR(7)
        CheckStatGT(LastSeenBy(Myself),0,STONESKINS)
        CheckSpellState(LastSeenBy(Myself),PROTECTION_FROM_MAGICAL_WEAPONS)
        CheckSpellState(LastSeenBy(Myself),MANTLE)
        CheckSpellState(LastSeenBy(Myself),IMPROVED_MANTLE)
        CheckSpellState(LastSeenBy(Myself),ABSOLUTE_IMMUNITY)
        CheckSpellState(LastSeenBy(Myself),RED_FIRESHIELD)
        CheckSpellState(LastSeenBy(Myself),BLUE_FIRESHIELD)

    HaveSpell(INQUIS_DISPEL_MAGIC)  // 4231 (INQUIS_DISPEL_MAGIC)
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
    THEN
        RESPONSE #100
        Spell(LastSeenBy(Myself),INQUIS_DISPEL_MAGIC)  // Cast INQUIS_DISPEL_MAGIC
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    ActuallyInCombat()
    OR(7)
        See([ENEMY])
        See([ENEMY.0.0.MAGE_ALL])
        See([ENEMY.0.0.CLERIC_ALL])
        See([ENEMY.0.0.BARD_ALL])
        See([ENEMY.0.0.DRUID_ALL])
        See([ENEMY.0.0.SORCERER])
        See([ENEMY.0.0.RAKSHASA])
    OR(7)
        CheckStatGT(LastSeenBy(Myself),0,STONESKINS)
        CheckSpellState(LastSeenBy(Myself),PROTECTION_FROM_MAGICAL_WEAPONS)
        CheckSpellState(LastSeenBy(Myself),MANTLE)
        CheckSpellState(LastSeenBy(Myself),IMPROVED_MANTLE)
        CheckSpellState(LastSeenBy(Myself),ABSOLUTE_IMMUNITY)
        CheckSpellState(LastSeenBy(Myself),RED_FIRESHIELD)
        CheckSpellState(LastSeenBy(Myself),BLUE_FIRESHIELD)

        HaveSpellRES("SPIN112")  // 4231 (INQUIS_DISPEL_MAGIC)
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
    THEN
        RESPONSE #100
        SpellRES("SPIN112",LastSeenBy(Myself))  // Cast INQUIS_DISPEL_MAGIC
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    OR(7)
        Gender(LastSeenBy(Myself),ILLUSIONARY)
        SpellCast([ENEMY],WIZARD_PROJECT_IMAGE) 
        SpellCast([ENEMY],WIZARD_SIMULACRUM)  
        SpellCast([ENEMY],WIZARD_MISLEAD)  
        StateCheck(LastSeenBy(Myself),STATE_BLUR)
        StateCheck(LastSeenBy(Myself),STATE_MIRRORIMAGE)
        Class([ENEMY],THIEF_ALL)
    GlobalTimerNotExpired("SHORT_BUFF","LOCALS")
    Delay(30)
    HaveSpell(INQUIS_TRUE_SIGHT) 
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
    THEN
        RESPONSE #100
        Spell(Myself,INQUIS_TRUE_SIGHT)
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    OR(7)
        Gender(LastSeenBy(Myself),ILLUSIONARY)
        SpellCast([ENEMY],WIZARD_PROJECT_IMAGE) 
        SpellCast([ENEMY],WIZARD_SIMULACRUM)  
        SpellCast([ENEMY],WIZARD_MISLEAD)  
        StateCheck(LastSeenBy(Myself),STATE_BLUR)
        StateCheck(LastSeenBy(Myself),STATE_MIRRORIMAGE)
        Class([ENEMY],THIEF_ALL)
    GlobalTimerNotExpired("SHORT_BUFF","LOCALS")
    Delay(30)
    HaveSpell(CLERIC_TRUE_SIGHT) 
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
    THEN
        RESPONSE #100
        Spell(Myself,CLERIC_TRUE_SIGHT)
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    ActuallyInCombat()
    OR(6)
        SpellCast([ENEMY],WIZARD_PROJECT_IMAGE)  // SPWI703.SPL (Project Image)
        SpellCast([ENEMY],WIZARD_SIMULACRUM)  // SPWI804.SPL (Simulacrum)
        SpellCast([ENEMY],WIZARD_MISLEAD)  // SPWI607.SPL (Mislead)
        SpellCast([ENEMY],WIZARD_SHADOW_DOOR)  // SPWI505.SPL (Shadow Door)
        SpellCast([ENEMY],WIZARD_IMPROVED_INVISIBILITY)  // SPWI405.SPL (Improved Invisibility)
        SpellCast([ENEMY],WIZARD_INVISIBILITY)  // SPWI206.SPL (Invisibility)
    HaveSpell(CLERIC_INVISIBILITY_PURGE)
    THEN
        RESPONSE #100
        Spell([ENEMY],CLERIC_INVISIBILITY_PURGE)  
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    ActuallyInCombat()
    OR(6)
        See([ENEMY.0.0.MAGE_ALL])
        See([ENEMY.0.0.CLERIC_ALL])
        See([ENEMY.0.0.BARD_ALL])
        See([ENEMY.0.0.DRUID_ALL])
        See([ENEMY.0.0.SORCERER])
        See([ENEMY.0.0.RAKSHASA])
    HaveSpell(CLERIC_CREEPING_DOOM) 
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
    THEN
        RESPONSE #100
        Spell(LastSeenBy(Myself),CLERIC_CREEPING_DOOM) 
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END


IF
    ActionListEmpty()
    ActuallyInCombat()
    OR(6)
        See([ENEMY.0.0.MAGE_ALL])
        See([ENEMY.0.0.CLERIC_ALL])
        See([ENEMY.0.0.BARD_ALL])
        See([ENEMY.0.0.DRUID_ALL])
        See([ENEMY.0.0.SORCERER])
        See([ENEMY.0.0.RAKSHASA])
    HaveSpell(CLERIC_EARTHQUAKE) 
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
    THEN
        RESPONSE #100
        Spell(LastSeenBy(Myself),CLERIC_EARTHQUAKE) 
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    ActuallyInCombat()
    OR(6)
        See([ENEMY.0.0.MAGE_ALL])
        See([ENEMY.0.0.CLERIC_ALL])
        See([ENEMY.0.0.BARD_ALL])
        See([ENEMY.0.0.DRUID_ALL])
        See([ENEMY.0.0.SORCERER])
        See([ENEMY.0.0.RAKSHASA])
    HaveSpell(CLERIC_SYMBOL_DEATH) 
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
    THEN
        RESPONSE #100
        Spell(LastSeenBy(Myself),CLERIC_SYMBOL_DEATH) 
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    ActuallyInCombat()
    OR(6)
        See([ENEMY.0.0.MAGE_ALL])
        See([ENEMY.0.0.CLERIC_ALL])
        See([ENEMY.0.0.BARD_ALL])
        See([ENEMY.0.0.DRUID_ALL])
        See([ENEMY.0.0.SORCERER])
        See([ENEMY.0.0.RAKSHASA])
    HaveSpell(CLERIC_SYMBOL_STUN) 
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
    THEN
        RESPONSE #100
        Spell(LastSeenBy(Myself),CLERIC_SYMBOL_STUN) 
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END


IF
    ActionListEmpty()
    ActuallyInCombat()
    OR(6)
        See([ENEMY.0.0.MAGE_ALL])
        See([ENEMY.0.0.CLERIC_ALL])
        See([ENEMY.0.0.BARD_ALL])
        See([ENEMY.0.0.DRUID_ALL])
        See([ENEMY.0.0.SORCERER])
        See([ENEMY.0.0.RAKSHASA])
    HaveSpell(CLERIC_INSECT_PLAGUE) 
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
    THEN
        RESPONSE #100
        Spell(LastSeenBy(Myself),CLERIC_INSECT_PLAGUE)  
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    ActuallyInCombat()
    HaveSpell(CLERIC_DOOM)  
    CheckSpellState([ENEMY],DOOM)
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
    THEN
        RESPONSE #100
        Spell([ENEMY],CLERIC_DOOM)
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    ActuallyInCombat()
    OR(6)
        See([ENEMY.0.0.MAGE_ALL])
        See([ENEMY.0.0.CLERIC_ALL])
        See([ENEMY.0.0.BARD_ALL])
        See([ENEMY.0.0.DRUID_ALL])
        See([ENEMY.0.0.SORCERER])
        See([ENEMY.0.0.RAKSHASA])
    !Range([ENEMY],10)
    HaveSpell(CLERIC_SILENCE_15_FOOT)
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
    THEN
        RESPONSE #100
        Spell(LastSeenBy(Myself),CLERIC_SILENCE_15_FOOT)  
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    ActuallyInCombat()
    //See an enemy then check if the enemy is any spellcaster type or that they cast a spell 
    See([ENEMY])
    OR(7)
        See([ENEMY.0.0.MAGE_ALL])
        See([ENEMY.0.0.CLERIC_ALL])
        See([ENEMY.0.0.BARD_ALL])
        See([ENEMY.0.0.DRUID_ALL])
        See([ENEMY.0.0.SORCERER])
        See([ENEMY.0.0.RAKSHASA])
        SpellCast([ENEMY],0)
    HaveSpell(CLERIC_MISCAST_MAGIC)
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
    THEN
        RESPONSE #100
        Spell(LastSeenBy(Myself),CLERIC_MISCAST_MAGIC)  
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

// ======================================================
// SECTION: SUMMONING SPELLS (CLERIC)
// ======================================================

// CLERIC_ETHER_GATE
IF
    ActionListEmpty()
    GlobalTimerNotExpired("SHORT_BUFF","LOCALS")  
    HaveSpell(CLERIC_ETHER_GATE)
    NumCreatureLT([GOODCUTOFF.0.0.0.0.SUMMONED],3)
    CheckSpellState(Myself,PROTECTION_FROM_EVIL)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,CLERIC_ETHER_GATE)
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

// CLERIC_SUMMON_DEVA
IF
    ActionListEmpty()
    GlobalTimerNotExpired("SHORT_BUFF","LOCALS")  
    HaveSpell(CLERIC_SUMMON_DEVA)
    NumCreatureLT([GOODCUTOFF.0.0.0.0.SUMMONED],3)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,CLERIC_SUMMON_DEVA)
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

IF
    ActuallyInCombat()
    ActionListEmpty()
    HaveSpell(PALADIN_SUMMON_DEVA) 
    NumCreatureLT([GOODCUTOFF.0.0.0.0.SUMMONED],3)
    GlobalTimerNotExpired("SHORT_BUFF","LOCALS")  
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")

    THEN
        RESPONSE #100
        Spell(Myself,PALADIN_SUMMON_DEVA)  // Cast PALADIN_SUMMON_DEVA
        SetGlobalTimer("UNKNOWN_CAST","LOCALS",ONE_ROUND)
END

// CLERIC_SUMMON_FALLEN_DEVA
IF
    ActionListEmpty()
    GlobalTimerNotExpired("SHORT_BUFF","LOCALS")  
    HaveSpell(CLERIC_SUMMON_FALLEN_DEVA)
    NumCreatureLT([GOODCUTOFF.0.0.0.0.SUMMONED],3)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,CLERIC_SUMMON_FALLEN_DEVA)
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

// CLERIC_CONJURE_FIRE_ELEMENTAL
IF
    ActionListEmpty()
    GlobalTimerNotExpired("SHORT_BUFF","LOCALS")  
    HaveSpell(CLERIC_CONJURE_FIRE_ELEMENTAL)
    NumCreatureLT([GOODCUTOFF.0.0.0.0.SUMMONED],3)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,CLERIC_CONJURE_FIRE_ELEMENTAL)
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

// CLERIC_CONJURE_EARTH_ELEMENTAL
IF
    ActionListEmpty()
    GlobalTimerNotExpired("SHORT_BUFF","LOCALS")  
    HaveSpell(CLERIC_CONJURE_EARTH_ELEMENTAL)
    NumCreatureLT([GOODCUTOFF.0.0.0.0.SUMMONED],3)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,CLERIC_CONJURE_EARTH_ELEMENTAL)
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

// CLERIC_GATE
IF
    ActionListEmpty()
    GlobalTimerNotExpired("SHORT_BUFF","LOCALS")  
    CheckSpellState(Myself,PROTECTION_FROM_EVIL)
    NumCreatureLT([GOODCUTOFF.0.0.0.0.SUMMONED],3)
    HaveSpell(CLERIC_GATE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,CLERIC_GATE)
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    GlobalTimerNotExpired("SHORT_BUFF","LOCALS")  
    HaveSpell(TOTEMIC_DRUID_SUMMON_SPIRIT_ANIMAL)
    NumCreatureLT([GOODCUTOFF.0.0.0.0.SUMMONED],3)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,TOTEMIC_DRUID_SUMMON_SPIRIT_ANIMAL)
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END


IF
    ActionListEmpty()
    GlobalTimerNotExpired("SHORT_BUFF","LOCALS")  
    HaveSpell(CLERIC_ANIMATE_DEAD)
    NumCreatureLT([GOODCUTOFF.0.0.0.0.SUMMONED],3)
    CheckStatLT(Myself,1,DEAD_MAGIC)
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,CLERIC_ANIMATE_DEAD)
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

// CLERIC_ANIMAL_SUMMONING_1
IF
    ActionListEmpty()
    GlobalTimerNotExpired("SHORT_BUFF","LOCALS")  
    HaveSpell(CLERIC_ANIMAL_SUMMONING_1)
    NumCreatureLT([GOODCUTOFF.0.0.0.0.SUMMONED],3)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,CLERIC_ANIMAL_SUMMONING_1)
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

// CLERIC_CALL_WOODLAND_BEINGS
IF
    ActionListEmpty()
    GlobalTimerNotExpired("SHORT_BUFF","LOCALS")  
    HaveSpell(CLERIC_CALL_WOODLAND_BEINGS)
    NumCreatureLT([GOODCUTOFF.0.0.0.0.SUMMONED],3)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,CLERIC_CALL_WOODLAND_BEINGS)
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

// CLERIC_ANIMAL_SUMMONING_2
IF
    ActionListEmpty()
    GlobalTimerNotExpired("SHORT_BUFF","LOCALS")  
    HaveSpell(CLERIC_ANIMAL_SUMMONING_2)
    NumCreatureLT([GOODCUTOFF.0.0.0.0.SUMMONED],3)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,CLERIC_ANIMAL_SUMMONING_2)
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

// CLERIC_AERIAL_SERVANT
IF
    ActionListEmpty()
    GlobalTimerNotExpired("SHORT_BUFF","LOCALS")  
    HaveSpell(CLERIC_AERIAL_SERVANT)
    NumCreatureLT([GOODCUTOFF.0.0.0.0.SUMMONED],3)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,CLERIC_AERIAL_SERVANT)
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

// CLERIC_ANIMAL_SUMMONING_3
IF
    ActionListEmpty()
    GlobalTimerNotExpired("SHORT_BUFF","LOCALS")  
    HaveSpell(CLERIC_ANIMAL_SUMMONING_3)
    NumCreatureLT([GOODCUTOFF.0.0.0.0.SUMMONED],3)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,CLERIC_ANIMAL_SUMMONING_3)
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

// CLERIC_CONJURE_ANIMALS
IF
    ActionListEmpty()
    GlobalTimerNotExpired("SHORT_BUFF","LOCALS")  
    HaveSpell(CLERIC_CONJURE_ANIMALS)
    NumCreatureLT([GOODCUTOFF.0.0.0.0.SUMMONED],3)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,CLERIC_CONJURE_ANIMALS)
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

// CLERIC_ELEMENTAL_SWARM
IF
    ActionListEmpty()
    GlobalTimerNotExpired("SHORT_BUFF","LOCALS")  
    HaveSpell(CLERIC_ELEMENTAL_SWARM)
    NumCreatureLT([GOODCUTOFF.0.0.0.0.SUMMONED],3)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,CLERIC_ELEMENTAL_SWARM)
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

// CLERIC_GREATER_ELEMENTAL_SWARM
IF
    ActionListEmpty()
    GlobalTimerNotExpired("SHORT_BUFF","LOCALS")  
    NumCreatureLT([GOODCUTOFF.0.0.0.0.SUMMONED],3)
    HaveSpell(CLERIC_GREATER_ELEMENTAL_SWARM)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,CLERIC_GREATER_ELEMENTAL_SWARM)
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

// ======================================================
// SECTION: SUMMONING SPELLS (WIZARD)
// ======================================================

IF
    ActionListEmpty()
    HaveSpell(WIZARD_SUMMON_PLANATAR_EVIL)  // SPWI615.SPL (Summon Hakeashar)
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    GlobalTimerNotExpired("SHORT_BUFF","LOCALS")  
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,WIZARD_SUMMON_PLANATAR_EVIL)  // Summon Hakeashar to disrupt enemy spellcasting
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    GlobalTimerNotExpired("SUMMON","LOCALS")
    HaveSpell(WIZARD_SUMMON_PLANATAR_GOOD)  // SPWI615.SPL (Summon Hakeashar)
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,WIZARD_SUMMON_PLANATAR_GOOD)  // Summon Hakeashar to disrupt enemy spellcasting
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    GlobalTimerNotExpired("SUMMON","LOCALS")
    HaveSpell(WIZARD_GATE)  // SPWI615.SPL (Summon Hakeashar)
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckSpellState(Myself,PROTECTION_FROM_EVIL)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,WIZARD_GATE)  // Summon Hakeashar to disrupt enemy spellcasting
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    HaveSpell(WIZARD_SUMMON_FIEND)  // SPWI615.SPL (Summon Hakeashar)
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckSpellState(Myself,PROTECTION_FROM_EVIL)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    GlobalTimerNotExpired("SUMMON","LOCALS")
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,WIZARD_SUMMON_FIEND)  // Summon Hakeashar to disrupt enemy spellcasting
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    HaveSpell( WIZARD_SIMULACRUM)  // SPWI615.SPL (Summon Hakeashar)
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    GlobalTimerNotExpired("SUMMON","LOCALS")
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself, WIZARD_SIMULACRUM)  // Summon Hakeashar to disrupt enemy spellcasting
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END


IF
    ActionListEmpty()
    HaveSpell(WIZARD_SUMMON_DJINNI)  // SPWI615.SPL (Summon Hakeashar)
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    GlobalTimerNotExpired("SUMMON","LOCALS")
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,WIZARD_SUMMON_DJINNI)  // Summon Hakeashar to disrupt enemy spellcasting
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    GlobalTimerNotExpired("SUMMON","LOCALS")
    HaveSpell(WIZARD_SUMMON_HAKEASHAR)  // SPWI615.SPL (Summon Hakeashar)
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,WIZARD_SUMMON_HAKEASHAR)  // Summon Hakeashar to disrupt enemy spellcasting
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    GlobalTimerNotExpired("SUMMON","LOCALS")
    HaveSpell(WIZARD_SUMMON_EFREET)  // SPWI615.SPL (Summon Hakeashar)
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,WIZARD_SUMMON_EFREET)  // Summon Hakeashar to disrupt enemy spellcasting
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    GlobalTimerNotExpired("SUMMON","LOCALS")
    HaveSpell(WIZARD_MORDENKAINENS_SWORD)  // SPWI615.SPL (Summon Hakeashar)
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,WIZARD_MORDENKAINENS_SWORD)  // Summon Hakeashar to disrupt enemy spellcasting
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    GlobalTimerNotExpired("SUMMON","LOCALS")
    HaveSpell(WIZARD_CACOFIEND) 
    NumCreatureLT([GOODCUTOFF.0.0.0.0.SUMMONED],3)
    CheckSpellState(Myself,PROTECTION_FROM_EVIL)
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,WIZARD_CACOFIEND)  // Summon Hakeashar to disrupt enemy spellcasting
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    GlobalTimerNotExpired("SUMMON","LOCALS")
    NumCreatureLT([GOODCUTOFF.0.0.0.0.SUMMONED],6)
    HaveSpell(WIZARD_CONJURE_EARTH_ELEMENTAL) 
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,WIZARD_CONJURE_EARTH_ELEMENTAL) 
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    GlobalTimerNotExpired("SUMMON","LOCALS")
    NumCreatureLT([GOODCUTOFF.0.0.0.0.SUMMONED],6)
    HaveSpell(WIZARD_CONJURE_AIR_ELEMENTAL) 
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,WIZARD_CONJURE_AIR_ELEMENTAL) 
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    GlobalTimerNotExpired("SUMMON","LOCALS")
    NumCreatureLT([GOODCUTOFF.0.0.0.0.SUMMONED],6)
    HaveSpell(WIZARD_CONJURE_FIRE_ELEMENTAL) 
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,WIZARD_CONJURE_FIRE_ELEMENTAL) 
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END


IF
    ActionListEmpty()
    GlobalTimerNotExpired("SUMMON","LOCALS")
    NumCreatureLT([GOODCUTOFF.0.0.0.0.SUMMONED],3)
    HaveSpell(WIZARD_CARRION) 
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,WIZARD_CARRION) 
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    GlobalTimerNotExpired("SUMMON","LOCALS")
    HaveSpell(WIZARD_WYVERN_CALL) 
    NumCreatureLT([GOODCUTOFF.0.0.0.0.SUMMONED],3)
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,WIZARD_WYVERN_CALL)  // Summon Hakeashar to disrupt enemy spellcasting
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    GlobalTimerNotExpired("SUMMON","LOCALS")
    HaveSpell(WIZARD_SUMMON_NISHRUU)  
    NumCreatureLT([GOODCUTOFF.0.0.0.0.SUMMONED],3)
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,WIZARD_SUMMON_NISHRUU) 
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    GlobalTimerNotExpired("SUMMON","LOCALS")
    HaveSpell(WIZARD_INVISIBLE_STALKER) 
    NumCreatureLT([GOODCUTOFF.0.0.0.0.SUMMONED],3)
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,WIZARD_INVISIBLE_STALKER)  
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END


IF
    ActionListEmpty()
    GlobalTimerNotExpired("SUMMON","LOCALS")
    NumCreatureLT([GOODCUTOFF.0.0.0.0.SUMMONED],3)
    HaveSpell(WIZARD_CONJURE_LESSER_EARTH_ELEMENTAL) 
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,WIZARD_CONJURE_LESSER_EARTH_ELEMENTAL) 
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    GlobalTimerNotExpired("SUMMON","LOCALS")
    NumCreatureLT([GOODCUTOFF.0.0.0.0.SUMMONED],3)
    HaveSpell(WIZARD_CONJURE_LESSER_FIRE_ELEMENTAL) 
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,WIZARD_CONJURE_LESSER_FIRE_ELEMENTAL) 
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    GlobalTimerNotExpired("SUMMON","LOCALS")
    NumCreatureLT([GOODCUTOFF.0.0.0.0.SUMMONED],3)
    HaveSpell(WIZARD_CONJURE_LESSER_AIR_ELEMENTAL) 
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,WIZARD_CONJURE_LESSER_AIR_ELEMENTAL) 
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    GlobalTimerNotExpired("SUMMON","LOCALS")
    HaveSpell(WIZARD_ANIMATE_DEAD)  
    NumCreatureLT([GOODCUTOFF.0.0.0.0.SUMMONED],3)
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,WIZARD_ANIMATE_DEAD) 
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

//Summon Ghast Tiax!
IF
    ActionListEmpty()
    ActuallyInCombat()
    HaveSpellRES("SPIN115")
    NumCreatureLT([GOODCUTOFF.0.0.0.0.SUMMONED],3)
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        SpellRES("SPIN115",[ANYONE])  
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    GlobalTimerNotExpired("SHORT_BUFF","LOCALS")  
    HaveSpell(WIZARD_MONSTER_SUMMONING_3) 
    NumCreatureLT([GOODCUTOFF.0.0.0.0.SUMMONED],3)
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,WIZARD_MONSTER_SUMMONING_3) 
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    GlobalTimerNotExpired("SHORT_BUFF","LOCALS")  
    HaveSpell(WIZARD_EYE)  
    NumCreatureLT([GOODCUTOFF.0.0.0.0.SUMMONED],3)
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,WIZARD_EYE)  // Summon spiders to aid in combat
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    GlobalTimerNotExpired("SHORT_BUFF","LOCALS")  
    HaveSpell(WIZARD_SPIDER_SPAWN)  
    NumCreatureLT([GOODCUTOFF.0.0.0.0.SUMMONED],3)
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,WIZARD_SPIDER_SPAWN)  // Summon spiders to aid in combat
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    GlobalTimerNotExpired("SHORT_BUFF","LOCALS")  
    HaveSpell(WIZARD_MONSTER_SUMMONING_2)  // SPWI511.SPL (Monster Summoning II)
    NumCreatureLT([GOODCUTOFF.0.0.0.0.SUMMONED],3)
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,WIZARD_MONSTER_SUMMONING_2)  // Summon stronger monsters to assist in combat
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    GlobalTimerNotExpired("SUMMON","LOCALS")
    HaveSpell(WIZARD_MONSTER_SUMMONING_1)  // SPWI103.SPL (Summon Monster I)
    NumCreatureLT([GOODCUTOFF.0.0.0.0.SUMMONED],3)
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,WIZARD_MONSTER_SUMMONING_1)  // Summon a monster to assist in combat
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    GlobalTimerNotExpired("SUMMON","LOCALS")
    HaveSpell(WIZARD_FIND_FAMILAR)  // SPWI123.SPL (Find Familiar)
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    !CheckSpellState(Myself,DEAD_MAGIC_AREA)
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,WIZARD_FIND_FAMILAR)  // Summon a familiar to assist
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END



// ======================================================
// SECTION: Short Duration BUFFS (WIZARD)
// ======================================================
IF
    ActionListEmpty()
    HaveSpell(WIZARD_CHAOS_SHIELD) 
    GlobalTimerNotExpired("SHORT_BUFF","LOCALS")  
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")  
THEN
    RESPONSE #100
        Spell(Myself,WIZARD_CHAOS_SHIELD)  
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND) 
END

IF
    ActionListEmpty()
    HaveSpell(WIZARD_IMPROVED_CHAOS_SHIELD) 
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")  
THEN
    RESPONSE #100
        Spell(Myself,WIZARD_IMPROVED_CHAOS_SHIELD)  
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND) 
END

// Cast Haste if conditions are met
IF
    ActionListEmpty()
    ActuallyInCombat()
    HaveSpell(WIZARD_HASTE)  // Ensure the Haste spell is available
    GlobalTimerNotExpired("SHORT_BUFF","LOCALS")  // Timer expired
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")  // Ensure previous spell cast timer has expired
    !StateCheck(Myself,STATE_HASTED)  // Ensure Haste is not already active
THEN
    RESPONSE #100
        Spell(Myself,WIZARD_HASTE)  // Cast Haste on Myself
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)  // Set timer to prevent repeated casting
END


IF
    ActionListEmpty()
    GlobalTimerNotExpired("SHORT_BUFF","LOCALS")  // Timer expired
    HaveSpell(WIZARD_MINOR_GLOBE_OF_INVULNERABILITY)  // SPWI604.SPL (Globe of Invulnerability)
    //If any spell is cast by an enemy then this is useful
    OR(2)
        SpellCast([ENEMY],0)
        !GlobalTimerNotExpired("CASTER_ENEMY","LOCALS")
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,WIZARD_MINOR_GLOBE_OF_INVULNERABILITY)  // Cast Globe of Invulnerability for spell protection
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    GlobalTimerNotExpired("SHORT_BUFF","LOCALS")
    See(NearestEnemyOf(Myself))
    HaveSpell(WIZARD_GLOBE_OF_INVULNERABILITY)  
    //If any spell is cast by an enemy then this is useful
    OR(2)
        SpellCast([ENEMY],0)
        !GlobalTimerNotExpired("CASTER_ENEMY","LOCALS")
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
    THEN
        RESPONSE #100
        Spell(Myself,WIZARD_GLOBE_OF_INVULNERABILITY) 
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

/*

*/
IF
    ActionListEmpty()
    HaveSpell(WIZARD_MINOR_SPELL_DEFLECTION) 
    !HasBounceEffects(Myself)
    !HasImmunityEffects(Myself)
        //If any spell is cast by an enemy then this is useful
    OR(2)
        SpellCast([ENEMY],0)
        GlobalTimerNotExpired("CASTER_ENEMY","LOCALS")
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,WIZARD_MINOR_SPELL_DEFLECTION)
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END


IF
    ActionListEmpty()
    HaveSpell(WIZARD_SPELL_DEFLECTION)  
    !HasBounceEffects(Myself)
    !HasImmunityEffects(Myself)
        //If any spell is cast by an enemy then this is useful
    OR(2)
        SpellCast([ENEMY],0)
        GlobalTimerNotExpired("CASTER_ENEMY","LOCALS")
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,WIZARD_SPELL_DEFLECTION)  
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

/*
Minor Spell Turning
(Abjuration)

Level: 5
Range: 0
Duration: 3 rounds/level
Casting Time: 5
Area of Effect: The caster
Saving Throw: None

This spell is similar to the 7th-level Spell Turning, which causes the spells cast against the wizard to rebound upon the original caster. This affects a total of 4 spell levels—including spells cast from scrolls and innate spell-like abilities—but excludes the following: area effects that are not centered directly upon the wizard, as well as area effects that are stationary, such as Cloudkill and Stinking Cloud. As long as the spell is cast directly at the wizard, it will be reflected back upon the caster. This spell will only affect up to 4th-level spells, but as long as there are levels remaining, a spell will be reflected. For example, if there is only 1 level left and a 3rd-level spell is cast at the wizard, the spell will be reflected while canceling the Spell Turning.

This spell will not protect the caster from Dispel Magic, but will not be dispelled by Dispel Magic either.
*/
IF
    ActionListEmpty()
    HaveSpell(WIZARD_MINOR_SPELL_TURNING)  // SPWI522.SPL (Minor Spell Turning)
    CheckStatLT(Myself,1,WIZARD_SPELL_TURNING)
    //If any spell is cast by an enemy then this is useful
    OR(2)
        SpellCast([ENEMY],0)
        !GlobalTimerNotExpired("CASTER_ENEMY","LOCALS")
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,WIZARD_MINOR_SPELL_TURNING)  // Cast Minor Spell Turning
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    HaveSpell(WIZARD_SPELL_IMMUNITY)  // SPWI522.SPL (Minor Spell Turning)
    !HasBounceEffects(Myself)
    !HasImmunityEffects(Myself)
    //If any spell is cast by an enemy then this is useful
    OR(2)
        SpellCast([ENEMY],0)
        !GlobalTimerNotExpired("CASTER_ENEMY","LOCALS")
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
    GlobalTimerNotExpired("SHORT_BUFF","LOCALS") 
THEN
    RESPONSE #100
        Spell(Myself,WIZARD_SPELL_IMMUNITY)  // Cast Minor Spell Turning
        Spell(Myself,WIZARD_SPELL_IMMUNITY_ABJURATION)
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

/*
Spell Shield
(Abjuration)

Level: 5
Range: 0
Duration: 3 rounds/level
Casting Time: 8
Area of Effect: The caster
Saving Throw: None

When this spell is cast, the wizard is protected from the next magical attack against <PRO_HIMHER>. The spells from which the wizard is protected are Spell Thrust, Secret Word, Breach, Lower Resistance, Pierce Magic, Ruby Ray, Khelben's Warding Whip, Pierce Shield, and Spellstrike. If one of these spells is cast at the wizard, this spell activates and absorbs the attack. However, this only works once and this spell is consumed in the process. Otherwise, it will last for its duration.
*/
IF
    ActionListEmpty()
    HaveSpell(WIZARD_SPELL_SHIELD)  // SPWI522.SPL (Minor Spell Turning)
    !HasBounceEffects(Myself)
    !HasImmunityEffects(Myself)
    //If any spell is cast by an enemy then this is useful
    OR(2)
        SpellCast([ENEMY],0)
        !GlobalTimerNotExpired("CASTER_ENEMY","LOCALS")
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,WIZARD_SPELL_SHIELD)  // Cast Minor Spell Turning
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    HaveSpell(WIZARD_SPELL_TURNING)  // SPWI701.SPL (Spell Turning)
    !HasBounceEffects(Myself)
    !HasImmunityEffects(Myself)
    //If any spell is cast by an enemy then this is useful
    OR(2)
        SpellCast([ENEMY],0)
        !GlobalTimerNotExpired("CASTER_ENEMY","LOCALS")
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,WIZARD_SPELL_TURNING)  // Cast Spell Turning
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    HaveSpell(WIZARD_LIMITED_WISH) 
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
    GlobalTimerNotExpired("SHORT_BUFF","LOCALS") 
    THEN
        RESPONSE #100
        Spell(Myself,WIZARD_LIMITED_WISH)  // Cast WIZARD_LIMITED_WISH
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    HaveSpell(WIZARD_WISH) 
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
    GlobalTimerNotExpired("SHORT_BUFF","LOCALS") 
    THEN
        RESPONSE #100
        Spell(Myself,WIZARD_WISH)  // Cast WIZARD_LIMITED_WISH
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END



IF
    ActionListEmpty()
    See(NearestEnemyOf(Myself))
    HaveSpell(WIZARD_IMPROVED_INVISIBILITY)  // SPWI206.SPL (Invisibility)
    !StateCheck(Myself,STATE_IMPROVEDINVISIBILITY)
    !StateCheck(Myself,STATE_INVISIBLE)
    DamageTaken(10)
    HPPercentLT(Myself,90)
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,WIZARD_IMPROVED_INVISIBILITY)  // Cast Invisibility if not already invisible
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    HaveSpell(WIZARD_MASS_INVISIBILITY)  // 2721 (WIZARD_MASS_INVISIBILITY)
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
    GlobalTimerNotExpired("SHORT_BUFF","LOCALS")  // Timer expired
    THEN
        RESPONSE #100
        Spell(Myself,WIZARD_MASS_INVISIBILITY)  // Cast WIZARD_MASS_INVISIBILITY
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    HaveSpell(WIZARD_MIRROR_IMAGE)  // 2721 (WIZARD_MASS_INVISIBILITY)
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
    GlobalTimerNotExpired("SHORT_BUFF","LOCALS") 
    THEN
        RESPONSE #100
            Spell(Myself,WIZARD_MIRROR_IMAGE)  // Cast WIZARD_MASS_INVISIBILITY
            SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END


IF
    ActionListEmpty()
    GlobalTimerNotExpired("SHORT_BUFF","LOCALS")  // Timer expired
    HaveSpell(WIZARD_ENERGY_BLADES)
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself, WIZARD_ENERGY_BLADES)  // Cast Energy Blades
        Continue()
END


//This disables spell casting
IF
    ActuallyInCombat()
    ActionListEmpty()
    HaveSpell(WIZARD_SHAPECHANGE)  // 2916 (WIZARD_SHAPECHANGE)
    GlobalTimerNotExpired("SHORT_BUFF","LOCALS") 
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
    THEN
        RESPONSE #100
            Spell(Myself,WIZARD_SHAPECHANGE)  // Cast WIZARD_SHAPECHANGE
            SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    HaveSpell(WIZARD_FIRE_SHIELD_BLUE)  
    OR(2)
        TookDamage()
        Range([ENEMY],8)
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
    GlobalTimerNotExpired("SHORT_BUFF","LOCALS") 
    THEN
        RESPONSE #100
            Spell(Myself,WIZARD_FIRE_SHIELD_BLUE)  
            SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    HaveSpell(WIZARD_STRENGTH)  
    CheckStatLT([PC],18,STR)
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
    GlobalTimerNotExpired("SHORT_BUFF","LOCALS") 
    THEN
        RESPONSE #100
            Spell([PC],WIZARD_STRENGTH)  
            SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    HaveSpell(WIZARD_FIRE_SHIELD_RED)  
    OR(2)
        TookDamage()
        Range([ENEMY],8)
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
    GlobalTimerNotExpired("SHORT_BUFF","LOCALS") 
    THEN
        RESPONSE #100
            Spell(Myself,WIZARD_FIRE_SHIELD_RED)  
            SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    HaveSpell(WIZARD_PROTECTION_FROM_FIRE)  
    HitBy([ANYONE],FIRE)
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
    GlobalTimerNotExpired("SHORT_BUFF","LOCALS") 
    THEN
        RESPONSE #100
            Spell(Myself,WIZARD_PROTECTION_FROM_FIRE)  
            SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    HaveSpell(WIZARD_PROTECTION_FROM_ACID)  
    HitBy([ANYONE],ACID)
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
    GlobalTimerNotExpired("SHORT_BUFF","LOCALS") 
    THEN
        RESPONSE #100
            Spell(Myself,WIZARD_PROTECTION_FROM_ACID)  
            SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END


/*
Phantom Blade
(Evocation)

Level: 5
Range: 0
Duration: 3 rounds + 1 round/level
Casting Time: 5
Area of Effect: Special
Saving Throw: None

This spell creates a translucent, shadow-like, weightless area of magical force extending from the fingers of one of the caster's hands. The silent, blade-shaped construct's cutting edges inflict damage just as those of a real sword do. The caster wields the phantom blade as if proficient with it, at <PRO_HISHER> normal THAC0.

The phantom blade acts as a +3 magical sword in terms of to-hit and damage bonuses as well as the type of creatures it can hit. However, due to its etheric nature, it causes an extra +10 damage against undead creatures. This sword can only be used by the caster and remains in <PRO_HISHER> hand for the duration of the spell or until dispelled.
*/
IF
    ActuallyInCombat()
    ActionListEmpty()
    HaveSpell(WIZARD_PHANTOM_BLADE)  // 2613 (WIZARD_IMPROVED_HASTE)
    Range([ENEMY],10)
    General([ENEMY],UNDEAD)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    GlobalTimerNotExpired("SHORT_BUFF","LOCALS")  // Timer expired
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
    THEN
        RESPONSE #100
        Spell(Myself,WIZARD_PHANTOM_BLADE)  // Cast WIZARD_IMPROVED_HASTE
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

IF
    ActuallyInCombat()
    ActionListEmpty()
    HaveSpell(WIZARD_BLACK_BLADE_OF_DISASTER)  // 2613 (WIZARD_IMPROVED_HASTE)
    Range([ENEMY],10)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    GlobalTimerNotExpired("SHORT_BUFF","LOCALS")  // Timer expired
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
    THEN
        RESPONSE #100
        Spell(Myself,WIZARD_BLACK_BLADE_OF_DISASTER)  // Cast WIZARD_IMPROVED_HASTE
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

IF
    ActuallyInCombat()
    ActionListEmpty()
    HaveSpell(WIZARD_IMPROVED_HASTE)  // 2613 (WIZARD_IMPROVED_HASTE)
    CheckStatLT([PC],1,IMPROVEDHASTE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    GlobalTimerNotExpired("SHORT_BUFF","LOCALS")  // Timer expired
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
    THEN
        RESPONSE #100
        Spell([PC],WIZARD_IMPROVED_HASTE)  // Cast WIZARD_IMPROVED_HASTE
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

IF
    HaveSpell(WIZARD_TENSERS_TRANSFORMATION)  // SPWI603.SPL (Tenser's Transformation)
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
    OR(3)
        Range(LastSeenBy(Myself),5)
        HasItem("BLAKBLAD",Myself)  // Black Blade of Disaster
        HasItem("PHANBLAD",Myself)  // Phantom Blade
THEN
    RESPONSE #100
        Spell(Myself,WIZARD_TENSERS_TRANSFORMATION)  // SPWI603.SPL (Tenser's Transformation)
END

// Cast Blur if conditions are met
IF
    ActionListEmpty()
    HaveSpell(WIZARD_BLUR)  // Ensure the Blur spell is available
    GlobalTimerNotExpired("SHORT_BUFF","LOCALS")  // Timer expired
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")  // Ensure previous spell cast timer has expired
    !StateCheck(Myself,STATE_BLUR)  // Ensure Blur is not already active
THEN
    RESPONSE #100
        Spell(Myself,WIZARD_BLUR)  // Cast Blur on Myself
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)  // Set timer to prevent repeated casting
END



// Cast Luck if conditions are met
IF
    ActionListEmpty()
    HaveSpell(WIZARD_LUCK)  // Ensure the Luck spell is available
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    GlobalTimerNotExpired("SHORT_BUFF","LOCALS")  // Timer expired
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")  // Ensure previous spell cast timer has expired
THEN
    RESPONSE #100
        Spell(Myself,WIZARD_LUCK)  // Cast Luck on Myself
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)  // Set timer to prevent repeated casting
END



// Cast Melf's Minute Meteors if conditions are met
IF
    ActionListEmpty()
    HaveSpell(WIZARD_MELF_METEOR)  // Ensure Melf's Minute Meteors spell is available
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")  // Ensure previous spell cast timer has expired
THEN
    RESPONSE #100
        Spell(Myself,WIZARD_MELF_METEOR)  // Cast Melf's Minute Meteors on Myself
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)  // Set timer to prevent repeated casting
END

IF
    ActionListEmpty()
    See(NearestEnemyOf(Myself))
    StateCheck(Myself,STATE_SILENCED)
    HaveSpell(WIZARD_VOCALIZE)  // SPWI219.SPL (Vocalize)
    GlobalTimerNotExpired("SHORT_BUFF","LOCALS")  // Timer expired
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,WIZARD_VOCALIZE)  // Cast Vocalize if silenced
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

IF
    ActuallyInCombat()
    ActionListEmpty()
    See([ENEMY])
    GlobalTimerNotExpired("SHORT_BUFF","LOCALS")  // Timer expired
    HaveSpell(WIZARD_PROTECTION_FROM_EVIL)  // Ensure the spell is available
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,WIZARD_PROTECTION_FROM_EVIL) // Cast Protection from Evil on Myself
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END


// ======================================================
// SECTION: Short Duration BUFFS (CLERIC)
// ======================================================


IF
    ActionListEmpty()
    ActuallyInCombat()
    HaveSpell(CLERIC_ARMOR_OF_FAITH)  // SPPR111.SPL (Armor of Faith)
    !CheckSpellState(Myself,ARMOR_OF_FAITH)  // Correct spell state for Armor of Faith
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    GlobalTimerNotExpired("SHORT_BUFF","LOCALS")  
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,CLERIC_ARMOR_OF_FAITH)  // Cast Armor of Faith
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    ActuallyInCombat()
    HaveSpell(CLERIC_SHIELD_OF_THE_ARCHONS)  // SPPR111.SPL (Armor of Faith)
    !CheckSpellState(Myself,ARMOR_OF_FAITH)  // Correct spell state for Armor of Faith
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    GlobalTimerNotExpired("SHORT_BUFF","LOCALS")  
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,CLERIC_SHIELD_OF_THE_ARCHONS)  // Cast Armor of Faith
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END


IF
    ActionListEmpty()
    HaveSpell(CLERIC_DEFENSIVE_HARMONY)  
    !CheckStatLT([PC],1,CLERIC_DEFENSIVE_HARMONY)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    GlobalTimerNotExpired("SHORT_BUFF","LOCALS")  // Timer expired
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell([PC],CLERIC_DEFENSIVE_HARMONY)  // Cast Protection from Fire on yourself
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    HaveSpell(CLERIC_DEATH_WARD)  
    See([PC])
    !CheckSpellState(Myself,DEATH_WARD) 
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    GlobalTimerNotExpired("SHORT_BUFF","LOCALS")  
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,CLERIC_DEATH_WARD)  
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    OR(2)
        ActuallyInCombat()
        GlobalTimerNotExpired("SHORT_BUFF","LOCALS")  
    HaveSpell(CLERIC_CHANT)  
    !StateCheck([PC],STATE_CHANT)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell([PC],CLERIC_CHANT)  
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    OR(2)
        ActuallyInCombat()
        GlobalTimerNotExpired("SHORT_BUFF","LOCALS")  
    !StateCheck([PC],STATE_BLESS)
    HaveSpell(CLERIC_BLESS)  
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell([PC],CLERIC_BLESS)  // Cast Protection from Fire on yourself
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    ActuallyInCombat()
    HaveSpellRES("ohtmps2")
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
THEN
    RESPONSE #100
        SpellRES("ohtmps2",Myself)  
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    ActuallyInCombat()
    HaveSpell(CLERIC_SANCTUARY)  // SPPR109.SPL (Sanctuary)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
    HPPercentLT(Myself,60)  // Party member's HP is below 25%
      // The target was last seen by the cleric
THEN
    RESPONSE #100
        Spell(LastSeenBy(Myself),CLERIC_SANCTUARY)  // Cast Sanctuary on the party member with low HP
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    HaveSpell(CLERIC_PROTECTION_FROM_EVIL_10_FOOT)  // SPPR107.SPL (Protection from Evil)
    !CheckSpellState(Myself,PROTECTION_FROM_EVIL)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    GlobalTimerNotExpired("SHORT_BUFF","LOCALS")
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,CLERIC_PROTECTION_FROM_EVIL_10_FOOT)  // Cast Protection from Evil
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    HaveSpell(PALADIN_PROTECTION_FROM_EVIL)  // SPPR107.SPL (Protection from Evil)
    !CheckSpellState(Myself,PROTECTION_FROM_EVIL)
    !CheckStatGT(Myself,0,PROTECTION_FROM_EVIL)
    CheckStatLT(Myself,1,DEAD_MAGIC)  
    GlobalTimerNotExpired("SHORT_BUFF","LOCALS")  
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
    Delay(60)//Wait a minute because this spell doesn't set the protection from evil flag correctly
THEN
    RESPONSE #100
        Spell(Myself,PALADIN_PROTECTION_FROM_EVIL)  // Cast Protection from Evil
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
        Continue()
END


IF
    ActionListEmpty()
    HaveSpell(CLERIC_PROTECTION_FROM_LIGHTNING)  
    !CheckStatLT([PC],100,RESISTELECTRICITY)
    HitBy([ANYONE],ELECTRICITY)
    GlobalTimerNotExpired("FIRE_ENEMIES","LOCALS")  // Timer expired
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell([PC],CLERIC_PROTECTION_FROM_LIGHTNING)  // Cast Protection from Fire on yourself
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

/*
Magic Resistance
(Alteration)

Level: 5
Sphere: Protection
Range: Touch
Duration: 3 rounds + 1 round/level
Casting Time: 9
Area of Effect: 1 creature
Saving Throw: None 

When this spell is cast, the recipient receives a resistance to all magic. The resistance conferred is 2% per level of the caster, up to a maximum of 40% at 20th level. This resistance is set so that if the target already has more Magic Resistance than the priest would confer, it will actually lower it to the set value. This effect will last for the duration of the spell or until dispelled.
*/
IF
    ActionListEmpty()
    HaveSpell(CLERIC_MAGIC_RESISTANCE)  
    HitBy([ANYONE],MAGIC)
    !CheckStatLT([PC],20,RESISTMAGIC)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    GlobalTimerNotExpired("SHORT_BUFF","LOCALS")  // Timer expired
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell([PC],CLERIC_MAGIC_RESISTANCE)  // Cast Protection from Fire on yourself
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    HaveSpell(CLERIC_PROTECTION_FROM_FIRE)  
    HitBy([ANYONE],FIRE)
    !CheckStatLT([PC],100,RESISTFIRE)
    CheckStatLT(Myself,1,DEAD_MAGIC)  
    GlobalTimerNotExpired("SHORT_BUFF","LOCALS")  // Timer expired  
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell([PC],CLERIC_PROTECTION_FROM_FIRE)  // Cast Protection from Fire on yourself
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    See([PC])
    !CheckStatLT(LastSeenBy(Myself),100,RESISTFIRE)
    HaveSpell(CLERIC_PROTECTION_FROM_FIRE)  
    GlobalTimerNotExpired("SHORT_BUFF","LOCALS")  // Timer expired
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(LastSeenBy(Myself),CLERIC_PROTECTION_FROM_FIRE)  // Cast Protection from Fire on yourself
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    HaveSpell(CLERIC_BARKSKIN)  
    See([PC])
    !CheckSpellState(LastSeenBy(Myself),BARKSKIN)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    GlobalTimerNotExpired("SHORT_BUFF","LOCALS")  // Timer expired
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(LastSeenBy(Myself),CLERIC_BARKSKIN)  // Cast Protection from Fire on yourself
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

//Long term buff, remove fear works for 1 hour and removes the fear and blocks it.
IF
    ActionListEmpty()
    HaveSpell(CLERIC_REMOVE_FEAR) 
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")  
THEN
    RESPONSE #100
        Spell(Myself,CLERIC_REMOVE_FEAR)  
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    HaveSpell(CLERIC_PIXIE_DUST)  
    See([PC])
    !StateCheck([PC],STATE_INVISIBLE)
    GlobalTimerNotExpired("SHORT_BUFF","LOCALS")  // Timer expired
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(LastSeenBy(Myself),CLERIC_PIXIE_DUST)  // Cast Protection from Fire on yourself
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    HaveSpell(CLERIC_IRONSKIN)  
    See([PC])
    !CheckSpellState(LastSeenBy(Myself),IRON_SKINS)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(LastSeenBy(Myself),CLERIC_IRONSKIN)  // Cast Protection from Fire on yourself
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    HaveSpell(CLERIC_FLAME_BLADE)  
    OR(2)
        GlobalTimerNotExpired("TROLL_ENEMIES","LOCALS")
        LevelLT(Myself,8)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,CLERIC_FLAME_BLADE)  // Cast Protection from Fire on yourself
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

//Blackguard innate abilities
IF
    ActionListEmpty()
    ActuallyInCombat()
    HaveSpell(ASSASSIN_POISON)  
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    Delay(30)
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,ASSASSIN_POISON) 
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    ActuallyInCombat()
    HaveSpell(CLERIC_CLOAK_OF_FEAR)  
    OR(2)
        LevelGT([ENEMY],2)
        NumCreatureGT([ENEMY],1)
    Range([ENEMY],10)
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
    Delay(10)
THEN
    RESPONSE #100
        Spell(Myself,CLERIC_CLOAK_OF_FEAR)  
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

/*
Blade Barrier
(Evocation)

Level: 6 
Sphere: Guardian, Creation
Range: 0
Duration: 1 turn
Casting Time: 9
Area of Effect: Special
Saving Throw: Special

The priest employs this spell to set up a wall of circling, razor-sharp blades. These whirl and flash around the caster, creating an impenetrable barrier. Any creature attempting to pass through the Blade Barrier suffers 8d8 points of damage. Creatures within the area of the barrier when it is invoked are entitled to a Saving Throw vs. Spell to negate the damage. The barrier remains for 1 turn.
*/
IF
    ActionListEmpty()
    ActuallyInCombat()
    HaveSpell(CLERIC_BLADE_BARRIER)  
    OR(2)
        LevelGT([ENEMY],2)
        NumCreatureGT([ENEMY],1)
    Range([ENEMY],10)
    !Range([PC],6)
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
    Delay(10)
THEN
    RESPONSE #100
        Spell(Myself,CLERIC_BLADE_BARRIER)  
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    ActuallyInCombat()
    HaveSpell(CLERIC_AURA_OF_FLAMING_DEATH)  
    OR(2)
        LevelGT([ENEMY],2)
        NumCreatureGT([ENEMY],1)
    Range([ENEMY],10)
    !Range([PC],6)
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
    Delay(10)
THEN
    RESPONSE #100
        Spell(Myself,CLERIC_AURA_OF_FLAMING_DEATH)  
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    ActuallyInCombat()
    HaveSpell(CLERIC_GLOBE_OF_BLADES)  
    OR(2)
        LevelGT([ENEMY],2)
        NumCreatureGT([ENEMY],1)
    Range([ENEMY],10)
    !Range([PC],6)
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
    Delay(10)
THEN
    RESPONSE #100
        Spell(Myself,CLERIC_GLOBE_OF_BLADES)  
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END
/*
Physical Mirror
(Alteration)

Level: 6
Sphere: Numbers
Range: 90 ft.
Duration: 9 rounds
Casting Time: 6
Area of Effect: Special
Saving Throw: None

This spell causes a localized folding of space. The folded space takes the form of an invisible disk that protects the caster. Any missile weapon that intersects this disk is instantaneously reversed in direction. Melee factors such as speed, range, and damage are unaffected; the direction of the object or force is simply rotated through a 180-degree arc. The sender of the missile finds <PRO_HIMHER>self the target of <PRO_HISHER> own attack. The caster of the mirror may direct missile attacks normally through the space occupied by the mirror.
*/
IF
    ActionListEmpty()
    ActuallyInCombat()
    HaveSpell(CLERIC_PHYSICAL_MIRROR)  
    OR(2)
        LevelGT([ENEMY],2)
        NumCreatureGT([ENEMY],1)
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
    Delay(10)
THEN
    RESPONSE #100
        Spell(Myself,CLERIC_PHYSICAL_MIRROR)  
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

/*
Nature's Beauty
(Illusion/Phantasm)

Level: 7
Sphere: Elemental
Range: 0
Duration: Instant
Casting Time: 6
Area of Effect: 15-ft. radius
Saving Throw: Neg.

When this spell is cast, the caster appears to undergo a remarkable transformation. The caster becomes the very ideal of beauty: For a male, this is usually a nymph; for a female, it varies. As with a nymph, anyone viewing the disguised caster must make a Saving Throw vs. Spell with +3 bonus or die of longing for the denied illusion. Even if the Saving Throw is successful, hapless viewers of the transformed Druid are all instantly smitten with permanent blindness (until dispelled). The transformation is instantaneous, but lasts only seconds, affecting those near the caster (excluding fellow party members).
*/
IF
    ActionListEmpty()
    ActuallyInCombat()
    HaveSpell(CLERIC_NATURE_BEAUTY)  
    OR(2)
        LevelGT([ENEMY],2)
        NumCreatureGT([ENEMY],1)
    Range([ENEMY],10)
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
    Delay(10)
THEN
    RESPONSE #100
        Spell(Myself,CLERIC_NATURE_BEAUTY)  
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    ActuallyInCombat()
    HaveSpell(AURA_OF_DESPAIR)  
    OR(2)
        LevelGT([ENEMY],2)
        NumCreatureGT([ENEMY],1)
    Range([ENEMY],10)
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
    Delay(10)
THEN
    RESPONSE #100
        Spell(Myself,AURA_OF_DESPAIR)  
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    HaveSpell(CLERIC_SPIRITUAL_HAMMER)  
    OR(3)
        HasItemEquiped("HAMM01",Myself) // Basic War Hammer
        HasItemEquiped("HAMM02",Myself) // War Hammer +1 (if you also want to replace this)
        HasItemEquiped("IHAMM01",Myself) // Improved hammer, only from beregost smith after nashkel mine quest
    InWeaponRange(NearestEnemyOf(Myself))
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,CLERIC_SPIRITUAL_HAMMER)  
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

/*
Fire Seeds
(Conjuration/Summoning)

Level: 6
Sphere: Elemental
Range: 0
Duration: 3 turns
Casting Time: 9
Area of Effect: The caster
Saving Throw: 1/2

Casting the Fire Seed spell creates 4 fire seeds that will appear in the caster's inventory. The seeds will remain in existence for 3 turns after the spell is cast. If they are thrown at an enemy, a fireball will ensue, causing 2d8 points of damage to all within a 7-ft. radius unless they make a Saving Throw vs. Spell for half damage.
*/
IF
    ActionListEmpty()
    HaveSpell(CLERIC_FIRE_SEEDS)  
    !InWeaponRange(NearestEnemyOf(Myself))
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,CLERIC_FIRE_SEEDS)  
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

/*
Sol's Searing Orb
(Invocation)

Level: 6
Sphere: Sun
Range: 90 ft.
Duration: Instant
Casting Time: 6
Area of Effect: 1 creature
Saving Throw: Special

When the spell is completed, it creates a glowing stone. This gem must be immediately thrown at an opponent, for it quickly becomes too hot to hold. It is not possible for the priest to give the stone to another character to throw. The priest must make an attack roll with +3 bonus and no penalty for lack of weapon proficiency. In addition, the glowing gem can be used to strike any creature, even those hit only by magical weapons, although there is no damage bonus.

When it hits, the gem bursts with a brilliant, searing flash that causes 6d6 points of fire damage to the target and blinds <PRO_HIMHER> for 1d6 rounds. The victim is allowed a Saving Throw vs. Spell for half damage and to avoid being blinded. Undead creatures suffer 12d6 points of fire damage and are blinded for 12 rounds (if applicable) upon a failed Saving Throw; otherwise, they receive 9d6 points of damage and are blinded for 6 rounds.
*/
IF
    ActionListEmpty()
    HaveSpell(CLERIC_SOL_SEARING_ORB)  
    !Range([ENEMY],20)
    Range([PC],7)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell([ENEMY],CLERIC_SOL_SEARING_ORB)  
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END


IF
    ActionListEmpty()
    HaveSpellRES("SPIN113")
    OR(3)
        HasItemEquiped("HAMM01",Myself) // Basic War Hammer
        HasItemEquiped("HAMM02",Myself) // War Hammer +1 (if you also want to replace this)
        HasItemEquiped("IHAMM01",Myself) // Improved hammer, only from beregost smith after nashkel mine quest
    InWeaponRange(NearestEnemyOf(Myself))  
    CheckStatGT(Myself,3,THAC0)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    Delay(30)
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
THEN
    RESPONSE #100
        SpellRES("SPIN113",Myself)  
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    ActuallyInCombat()
    HaveSpell(CLERIC_SANCTUARY)  
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
    HPPercentLT(Myself,50)  
THEN
    RESPONSE #100
        Spell(Myself,CLERIC_SANCTUARY)  // Cast Sanctuary on the party member with low HP
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END



IF
    ActionListEmpty()
    ActuallyInCombat()
    See(NearestEnemyOf(Myself))
    HaveSpell(CLERIC_PROTECT_FROM_EVIL)  // SPPR107.SPL (Protection from Evil)
    !CheckSpellState(Myself,PROTECTION_FROM_EVIL)  // Correct spell state for Protection from Evil
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    GlobalTimerNotExpired("SHORT_BUFF","LOCALS")  // Timer expired
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,CLERIC_PROTECT_FROM_EVIL)  // Cast Protection from Evil
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

//CHAOS OF BATTLE: Chaos of Battle applies bonuses to all allies and penalties to all enemies within a 30-ft. radius of the caster. The spell lasts 1 turn and will randomly affect the targets' Armor Class, Hit Points, THAC0, saves, or luck. The magnitude of the effect starts at 1 (5 for Hit Points) at level 1 and will improve by 1 (5 for Hit Points) every 6 levels of the caster.
IF
    ActionListEmpty()
    ActuallyInCombat()
    HaveSpellRES("OHTMPS2")  
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    GlobalTimerNotExpired("SHORT_BUFF","LOCALS")  // Timer expired
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
    Delay(30)
THEN
    RESPONSE #100
        SpellRES("OHTMPS2",Myself) 
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

//BOON OF LATHANDER: This spell lasts 1 round per level of the caster. It gives the caster a +1 bonus to attack and damage rolls, a +1 bonus to all Saving Throws, and 1 extra attack per round. It also protects the recipient from level drain.
IF
    ActionListEmpty()
    ActuallyInCombat()
    HaveSpell(LATHANDER_BOON)  
    !CheckSpellState(Myself,LATHANDER_BOON) 
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    GlobalTimerNotExpired("SHORT_BUFF","LOCALS")  // Timer expired
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,LATHANDER_BOON)  
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    ActuallyInCombat()
    HaveSpell(CLERIC_HOLY_POWER)  
    !CheckSpellState(Myself,HOLY_POWER)  // State 9 for Holy Power
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    GlobalTimerNotExpired("SHORT_BUFF","LOCALS")  // Timer expired
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,CLERIC_HOLY_POWER)  // Cast Holy Power for increased strength
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

/*
Strength of One
(Alteration)

Level: 3
Sphere: Law
Range: 0 
Duration: 1 turn 
Casting Time: 3 
Area of Effect: 15-ft. radius
Saving Throw: None

When this spell is cast, party members within the area of effect are given a Strength score of 18/75. If a party member has a Strength score higher than this (either naturally, or through a magical item), then <PRO_HISHER> Strength is lowered to 18/75. The spell lasts for 1 turn, whereupon everyone's Strength returns to normal.
*/
IF
    ActionListEmpty()
    ActuallyInCombat()
    HaveSpell(CLERIC_CHAMPIONS_STRENGTH)  
    CheckStatLT(Myself,18,STR)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    GlobalTimerNotExpired("SHORT_BUFF","LOCALS")  // Timer expired
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,CLERIC_CHAMPIONS_STRENGTH)  // Cast Holy Power for increased strength
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    ActuallyInCombat()
    HaveSpell(CLERIC_STRENGTH_OF_ONE)  
    CheckStatLT(Myself,18,STR)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    GlobalTimerNotExpired("SHORT_BUFF","LOCALS")  // Timer expired
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,CLERIC_STRENGTH_OF_ONE)  // Cast Holy Power for increased strength
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    ActuallyInCombat()
    HaveSpellRES("ohtmps1")  
    !CheckSpellState(Myself,HOLY_POWER)  // State 9 for Holy Power
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
THEN
    RESPONSE #100
        SpellRES("ohtmps1",Myself)  // Cast Holy Power for increased strength
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

//Holy might power
IF
    ActionListEmpty()
    ActuallyInCombat()
    HaveSpellRES("SPIN103")  
    !CheckSpellState(Myself,HOLY_POWER)  // State 9 for Holy Power
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
    GlobalTimerNotExpired("SHORT_BUFF","LOCALS")  
    Delay(20)
THEN
    RESPONSE #100
        SpellRES("SPIN103",Myself)  // Cast Holy Power for increased strength
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    ActuallyInCombat()
    HaveSpell(CLERIC_RIGHTEOUS_MAGIC)  
    !CheckSpellState(Myself,ALLIED_RIGHTEOUS_WRATH_OF_THE_FAITHFUL)  // State 16 for Righteous Wrath of the Faithful (closest match)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    GlobalTimerNotExpired("SHORT_BUFF","LOCALS") 
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,CLERIC_RIGHTEOUS_MAGIC)  // Cast Righteous Magic to increase combat abilities
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END


IF
    ActionListEmpty()
    ActuallyInCombat()
    LevelGT([ENEMY],10)
    General([ENEMY],UNDEAD)
    HaveSpell(CLERIC_NEGATIVE_PLANE_PROTECTION)  
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    GlobalTimerNotExpired("SHORT_BUFF","LOCALS")  // Timer expired
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell([PC],CLERIC_NEGATIVE_PLANE_PROTECTION)  // Cast Death Ward to protect from death magic
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    ActuallyInCombat()
    HaveSpell(CLERIC_DEATH_WARD)  
    !CheckSpellState(Myself,DEATH_WARD)  // State 8 for Death Ward
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    GlobalTimerNotExpired("SHORT_BUFF","LOCALS")  // Timer expired
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,CLERIC_DEATH_WARD)  // Cast Death Ward to protect from death magic
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END



IF
    ActionListEmpty()
    See([PC])
    HaveSpell(CLERIC_CHAOTIC_COMMANDS)  
    GlobalTimerNotExpired("SHORT_BUFF","LOCALS")  // Timer expired
    !CheckSpellState(LastSeenBy(Myself),CHAOTIC_COMMANDS)  // State 41 for Chaotic Commands
    CheckStatLT(LastSeenBy(Myself),1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(LastSeenBy(Myself),CLERIC_CHAOTIC_COMMANDS)  // Cast Chaotic Commands to protect from mind control
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    GlobalTimerNotExpired("SHORT_BUFF","LOCALS")  // Timer expired
    HaveSpell(CLERIC_FREE_ACTION)  
    !CheckSpellState(Myself,FREE_ACTION)  // State 29 for Free Action
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,CLERIC_FREE_ACTION)  // Cast Free Action to avoid slow or hold effects
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    See([PC])
    HaveSpell(CLERIC_FREE_ACTION)  
    GlobalTimerNotExpired("SHORT_BUFF","LOCALS")  
    !CheckSpellState(LastSeenBy(Myself),FREE_ACTION)  
    GlobalTimerNotExpired("PSYCHIC_ENEMIES","LOCALS")
    CheckStatLT(LastSeenBy(Myself),1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(LastSeenBy(Myself),CLERIC_FREE_ACTION)  
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

// ======================================================
// IN COMBAT SPELLCASTING - Crowd Control AOE (WIZARD)
// ======================================================

IF
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
    HaveSpell(WIZARD_POWER_WORD_STUN)  // SPWI715.SPL (Power Word, Stun)
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    !CheckStatGT(Myself,0,CLERIC_INSECT_PLAGUE)
    !HasBounceEffects(LastSeenBy(Myself))
    !StateCheck(Myself,STATE_SILENCED)
    HPLT([ENEMY],90)
    See([ENEMY])
    !StateCheck([ENEMY],STATE_REALLY_DEAD)
    !StateCheck([ENEMY],STATE_NOT_TARGETABLE)
    !StateCheck([ENEMY],STATE_HARMLESS)
    !CheckStatGT([ENEMY],0,WIZARD_SPELL_DEFLECTION)
    !CheckStatGT([ENEMY],0,WIZARD_SPELL_TURNING)
    !CheckStatGT([ENEMY],0,WIZARD_SPELL_TRAP)
    !CheckStatGT([ENEMY],0,CLERIC_CHAOTIC_COMMANDS)
    !CheckStatGT([ENEMY],0,CLERIC_FREE_ACTION)
    !CheckStat([ENEMY],2,WIZARD_SPELL_IMMUNITY)
    !CheckStat([ENEMY],1,OFFENSIVE_MODIFIER)
    !CheckStat([ENEMY],1,CLERIC_SHIELD_OF_THE_ARCHONS)
    CheckStatLT(LastSeenBy(Myself),100,RESISTMAGIC)
    !HasItemEquipedReal("NPSW01",[ENEMY])  // Sword of Arvoreen +2
    !HasItemEquipedReal("SW1H27",[ENEMY])  // Arbane's Sword of Agility +2
    !HasItemEquiped("RING09",[ENEMY])  // Edventar's Gift
    !HasItemEquipedReal("SW2H06",[ENEMY])  // Spider's Bane +2
    CheckStatLT([ENEMY],50,RESISTMAGIC)
THEN
    RESPONSE #100
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
        Spell([ENEMY],WIZARD_POWER_WORD_STUN)  // SPWI715.SPL (Power Word, Stun)
END


IF
    ActuallyInCombat()
    ActionListEmpty()
    See([ENEMY])
    HaveSpell(WIZARD_SYMBOL_FEAR)  // SPWI109.SPL (Symbol of Fear)
    !CheckSpellState([ENEMY],BERSERKER_RAGE)
    !CheckSpellState([ENEMY],BARBARIAN_RAGE)
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
    THEN
        RESPONSE #100
        Spell([ENEMY],WIZARD_SYMBOL_FEAR)  // Cast Symbol of Fear
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

IF
    ActuallyInCombat()
    ActionListEmpty()
    See(NearestEnemyOf(Myself))
    HaveSpell(WIZARD_SYMBOL_STUN)  // SPWI110.SPL (Symbol of Stun)
    Range(NearestEnemyOf(Myself),30)
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
    THEN
        RESPONSE #100
        Spell(NearestEnemyOf(Myself),WIZARD_SYMBOL_STUN)  // Cast Symbol of Stun
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

IF
    ActuallyInCombat()
    ActionListEmpty()
    See(LastSeenBy(Myself))
    LevelGT([ENEMY],4)
    !ImmuneToSpellLevel(LastSeenBy(Myself),4)
    CheckStatLT(LastSeenBy(Myself),100,RESISTMAGIC)
    HaveSpell(WIZARD_EMOTION_HOPELESSNESS)
    HPGT(LastSeenBy(Myself),40)
    !StateCheck(LastSeenBy(Myself),STATE_HELPLESS)
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
    THEN
        RESPONSE #100
        Spell(LastSeenBy(Myself),WIZARD_EMOTION_HOPELESSNESS)
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

/*
Power Word, Sleep
(Conjuration/Summoning)

Level: 2
Range: 90 ft.
Duration: 5 rounds
Casting Time: 1
Area of Effect: 1 creature
Saving Throw: None

When a wizard calls upon a Power Word, Sleep spell, <PRO_HESHE> causes a comatose slumber to come upon 1 creature (other than undead and certain other creatures specifically excluded from the spell's effects). The creature targeted must have less than 20 Hit Points and gets no Saving Throw. Magically sleeping opponents can be attacked with substantial bonuses. The Sleep effect will last for 5 rounds. This spell has no effect on creatures with more than 20 Hit Points.
*/
IF
    ActuallyInCombat()
    ActionListEmpty()
    HaveSpell(WIZARD_POWER_WORD_SLEEP)  // SPWI101.SPL (Sleep)
    LevelLT([ENEMY],3)
    !StateCheck(NearestEnemyOf(Myself),STATE_HELPLESS)
    !Race([ENEMY],ELF)  // Exclude elves
    !General(NearestEnemyOf(Myself),UNDEAD)  // Exclude undead
    !See(NearestEnemyOfType([ENEMY.0.GOLEM]))
    !See(NearestEnemyOfType([ENEMY.0.MEPHIT]))
    !CheckSpellState([ENEMY],BERSERKER_RAGE)
    !CheckSpellState([ENEMY],BARBARIAN_RAGE)
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
    Delay(12)
    THEN
        RESPONSE #100
        Spell([ENEMY],WIZARD_POWER_WORD_SLEEP)  // Cast Sleep
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

IF
    ActuallyInCombat()
    ActionListEmpty()
    HaveSpell(WIZARD_SLEEP)  // SPWI101.SPL (Sleep)
    LevelLT([ENEMY],5)
    !StateCheck(NearestEnemyOf(Myself),STATE_HELPLESS)
    !Race([ENEMY],ELF)  // Exclude elves
    !General(NearestEnemyOf(Myself),UNDEAD)  // Exclude undead
    !See(NearestEnemyOfType([ENEMY.0.GOLEM]))
    !See(NearestEnemyOfType([ENEMY.0.MEPHIT]))
    !CheckSpellState([ENEMY],BERSERKER_RAGE)
    !CheckSpellState([ENEMY],BARBARIAN_RAGE)
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
    Delay(12)
    THEN
        RESPONSE #100
        Spell([ENEMY],WIZARD_SLEEP)  // Cast Sleep
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

IF
    ActuallyInCombat()
    ActionListEmpty()
    See([ENEMY])
    HaveSpell(WIZARD_SLOW)  
    StateCheck([ENEMY],STATE_SLOWED)
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
    THEN
        RESPONSE #100
        Spell([ENEMY],WIZARD_SLOW)  
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

IF
    ActuallyInCombat()
    ActionListEmpty()
    See([ENEMY])
    !ImmuneToSpellLevel(LastSeenBy(Myself),2)
    !HasBounceEffects(LastSeenBy(Myself))
    HaveSpell(WIZARD_HORROR) 
    !StateCheck(LastSeenBy(Myself),STATE_HELPLESS)
    !CheckSpellState(LastSeenBy(Myself),BERSERKER_RAGE)
    !CheckSpellState(LastSeenBy(Myself),BARBARIAN_RAGE)
    !General(LastSeenBy(Myself),UNDEAD)  // Exclude undead
    !Race(LastSeenBy(Myself),GOLEM)
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(LastSeenBy(Myself),WIZARD_HORROR) 
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END


IF
    ActuallyInCombat()
    ActionListEmpty()
    See([ENEMY])
    !HasBounceEffects(LastSeenBy(Myself))
    !ImmuneToSpellLevel(LastSeenBy(Myself),5)
    HaveSpell(WIZARD_CHAOS)  
    !StateCheck(LastSeenBy(Myself),STATE_HELPLESS)
    !CheckSpellState(LastSeenBy(Myself),BERSERKER_RAGE)
    !CheckSpellState(LastSeenBy(Myself),BARBARIAN_RAGE)
    !General(LastSeenBy(Myself),UNDEAD)  // Exclude undead
    !Race(LastSeenBy(Myself),GOLEM)
    !Race(LastSeenBy(Myself),SWORD)
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(LastSeenBy(Myself),WIZARD_CHAOS) 
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

IF
    ActuallyInCombat()
    ActionListEmpty()
    !HasBounceEffects(LastSeenBy(Myself))
    HaveSpell(WIZARD_WEB)  // SPWI206.SPL (Web)
    !Race([ENEMY],SPIDER)  // Exclude spiders
    CheckStatLT([ENEMY],100,RESISTMAGIC)
    !Range(FarthestEnemyOf(Myself),24)
    // How close is the closest ally 
    Range(NearestEnemyOf(FarthestEnemyOf(Myself)),6)
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(FarthestEnemyOf(Myself),WIZARD_WEB)  // Cast Web on any visible enemies
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

IF
    ActuallyInCombat()
    ActionListEmpty()
    HaveSpell(WIZARD_STINKING_CLOUD)  
    !HasBounceEffects(LastSeenBy(Myself))
    !Range(FarthestEnemyOf(Myself),20)
    !Range(NearestEnemyOf(FarthestEnemyOf(Myself)),15)
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(FarthestEnemyOf(Myself),WIZARD_STINKING_CLOUD)
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END


IF
    ActuallyInCombat()
    ActionListEmpty()
    See([ENEMY])
    !ImmuneToSpellLevel(LastSeenBy(Myself),5)
    !HasBounceEffects(LastSeenBy(Myself))
    HaveSpell(WIZARD_CONFUSION)  
    !StateCheck(LastSeenBy(Myself),STATE_HELPLESS)
    !CheckSpellState(LastSeenBy(Myself),BERSERKER_RAGE)
    !CheckSpellState(LastSeenBy(Myself),BARBARIAN_RAGE)
    !General(LastSeenBy(Myself),UNDEAD)  // Exclude undead
    !Race(LastSeenBy(Myself),GOLEM)
    !Race(LastSeenBy(Myself),SWORD)
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(LastSeenBy(Myself),WIZARD_CONFUSION)
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    ActuallyInCombat()
    !HasBounceEffects(LastSeenBy(Myself))
    !Range(FarthestEnemyOf(Myself),18)
    Range(NearestEnemyOf(FarthestEnemyOf(Myself)),8)
    HaveSpell(WIZARD_GREASE) 
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(FarthestEnemyOf(Myself),WIZARD_GREASE) 
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END


// ======================================================
// IN COMBAT SPELLCASTING - Crowd Control Single Target (WIZARD)
// ======================================================

IF
    ActionListEmpty()
    ActuallyInCombat()
    LevelGT([ENEMY],4)
    !ImmuneToSpellLevel(LastSeenBy(Myself),4)
    CheckStatLT(LastSeenBy(Myself),100,RESISTMAGIC)
    !HasBounceEffects([ENEMY])
    HaveSpell(WIZARD_GREATER_MALISON) 
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell([ENEMY],WIZARD_GREATER_MALISON)  
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END


IF
    ActuallyInCombat()
    ActionListEmpty()
    HaveSpell(WIZARD_RAY_OF_ENFEEBLEMENT) 
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell([ENEMY],WIZARD_RAY_OF_ENFEEBLEMENT) 
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END


IF
    ActuallyInCombat()
    ActionListEmpty()
    HaveSpell(WIZARD_CONTAGION)  // SPWI104.SPL (Contagion)
    !HasBounceEffects(LastSeenBy(Myself))
    HPGT([ENEMY],50)
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
    THEN
        RESPONSE #100
        Spell([ENEMY],WIZARD_CONTAGION)  // Cast Contagion
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    ActuallyInCombat()
    See([ENEMY])
    HPGT([ENEMY],30)
    !HasBounceEffects(LastSeenBy(Myself))
    !HasBounceEffects([ENEMY])
    !HasImmunityEffects([ENEMY])
    !StateCheck([ENEMY],STATE_HELPLESS)
    !CheckSpellState(LastSeenBy(Myself),BERSERKER_RAGE)
    !CheckSpellState(LastSeenBy(Myself),BARBARIAN_RAGE)
    HaveSpell(WIZARD_HOLD_MONSTER)  // SPWI507.SPL (Hold Monster)
    CheckStatLT(LastSeenBy(Myself),100,RESISTMAGIC)
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell([ENEMY],WIZARD_HOLD_MONSTER)  // Cast Hold Monster
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

IF
    ActuallyInCombat()
    ActionListEmpty()
    See(NearestEnemyOf(Myself))
    HaveSpell(WIZARD_SYMBOL_DEATH)  // SPWI111.SPL (Symbol of Death)
    Range(NearestEnemyOf(Myself),30)
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
    THEN
        RESPONSE #100
        Spell(NearestEnemyOf(Myself),WIZARD_SYMBOL_DEATH)  // Cast Symbol of Death
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

IF
    ActuallyInCombat()
    ActionListEmpty()
    HaveSpell(WIZARD_POWER_WORD_BLIND)  // SPWI112.SPL (Power Word: Kill)
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
    THEN
        RESPONSE #100
        Spell([ENEMY],WIZARD_POWER_WORD_BLIND)  // Cast Power Word: Kill
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

IF
    ActuallyInCombat()
    ActionListEmpty()
    See(NearestEnemyOf(Myself))
    HaveSpell(WIZARD_POWER_WORD_KILL)  // SPWI112.SPL (Power Word: Kill)
    Range(NearestEnemyOf(Myself),30)
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
    THEN
        RESPONSE #100
        Spell(NearestEnemyOf(Myself),WIZARD_POWER_WORD_KILL)  // Cast Power Word: Kill
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

IF
    ActuallyInCombat()
    ActionListEmpty()
    See(NearestEnemyOf(Myself))
    HaveSpell(WIZARD_ENERGY_DRAIN)  // SPWI113.SPL (Energy Drain)
    Range(NearestEnemyOf(Myself),30)
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
    THEN
        RESPONSE #100
        Spell(NearestEnemyOf(Myself),WIZARD_ENERGY_DRAIN)  // Cast Energy Drain
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

/*
Level: 4
Range: 40 ft.
Duration: Permanent
Casting Time: 4
Area of Effect: 1 creature
Saving Throw: Neg. 

The Polymorph Other spell is a powerful magic that permanently alters the form of 
the creature affected. Mental attributes are not affected, and the target does not 
receive the special abilities of the new form. However all physical attributes are 
changed to adhere to the new form. This is a specific version of the spell in that the
 recipient will be transformed into a squirrel unless a Save vs. Petrification/Polymorph 
 is made successfully. The transformation is instant and permanent until a Dispel Magic 
 is cast successfully upon the affected creature. The natural attacks of the new form 
 also become available and all clothes and equipment that the target was wearing will mold into the new form.
*/
IF
    ActionListEmpty()
    ActuallyInCombat()
    See([ENEMY])
    !ImmuneToSpellLevel(LastSeenBy(Myself),4)
    LevelGT(LastSeenBy(Myself),4)
    !HasBounceEffects(LastSeenBy(Myself))
    CheckStatLT(LastSeenBy(Myself),100,RESISTMAGIC)
    CheckStatGT(LastSeenBy(Myself),6,SAVEVSPOLY) //Atleast 50% chance 
    !Race(LastSeenBy(Myself),SWORD)
    HaveSpell(WIZARD_POLYMORPH_OTHER) 
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(LastSeenBy(Myself),WIZARD_POLYMORPH_OTHER)  // SPWI106.SPL (Blindness)
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    ActuallyInCombat()
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
    HaveSpell(WIZARD_FEEBLEMIND)  // SPWI509.SPL (Feeblemind)
    See([ENEMY])
    !StateCheck(LastSeenBy(Myself),STATE_NOT_TARGETABLE)
    !StateCheck(LastSeenBy(Myself),STATE_HARMLESS)
    CheckStatLT(LastSeenBy(Myself),50,RESISTMAGIC)
    CheckStatGT(LastSeenBy(Myself),-2,SAVEVSSPELL)
    !CheckStatGT(LastSeenBy(Myself),0,CLERIC_CHAOTIC_COMMANDS)
    !CheckStatGT(LastSeenBy(Myself),0,WIZARD_SPELL_TURNING)
    !CheckStatGT(LastSeenBy(Myself),0,WIZARD_SPELL_DEFLECTION)
    !CheckStatGT(LastSeenBy(Myself),0,WIZARD_SPELL_TRAP)
    !CheckStat(LastSeenBy(Myself),1,CLERIC_SHIELD_OF_THE_ARCHONS)
    !CheckStat(LastSeenBy(Myself),1,OFFENSIVE_MODIFIER)
    !CheckStat(LastSeenBy(Myself),4,WIZARD_SPELL_IMMUNITY)
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    !CheckStatGT(Myself,0,CLERIC_INSECT_PLAGUE)
    !StateCheck(Myself,STATE_SILENCED)
THEN
    RESPONSE #100
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
        Spell(LastSeenBy(Myself),WIZARD_FEEBLEMIND)  // SPWI509.SPL (Feeblemind)
END

IF
    ActionListEmpty()
    ActuallyInCombat()
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
    HaveSpell(WIZARD_EMOTION_HOPELESSNESS)  // SPWI411.SPL (Emotion: Hopelessness)
    See([EVILCUTOFF.HUMANOID])
    !Race(LastSeenBy(Myself),ELF)
    !StateCheck(LastSeenBy(Myself),STATE_NOT_TARGETABLE)
    !StateCheck(LastSeenBy(Myself),STATE_HARMLESS)
    CheckStatLT(LastSeenBy(Myself),50,RESISTMAGIC)
    CheckStatGT(LastSeenBy(Myself),0,SAVEVSSPELL)
    !CheckStatGT(LastSeenBy(Myself),0,CLERIC_CHAOTIC_COMMANDS)
    !CheckStat(LastSeenBy(Myself),4,WIZARD_SPELL_IMMUNITY)
    !CheckStat(LastSeenBy(Myself),1,OFFENSIVE_MODIFIER)
    !CheckStatGT(LastSeenBy(Myself),0,MINORGLOBE)
    !HasItem("MORSWORD",LastSeenBy(Myself))  // Mordenkainen's Sword
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    !StateCheck(Myself,STATE_SILENCED)
    !CheckStatGT(Myself,0,CLERIC_INSECT_PLAGUE)
THEN
    RESPONSE #100
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
        Spell(LastSeenBy(Myself),WIZARD_EMOTION_HOPELESSNESS)  // SPWI411.SPL (Emotion: Hopelessness)
END

IF
    ActuallyInCombat()
    ActionListEmpty()
    HaveSpell(WIZARD_SPOOK)  // SPWI101.SPL (Sleep)
    !StateCheck(NearestEnemyOf(Myself),STATE_HELPLESS)
    !General(NearestEnemyOf(Myself),UNDEAD)  // Exclude undead
    !See(NearestEnemyOfType([ENEMY.0.GOLEM]))
    !See(NearestEnemyOfType([ENEMY.0.MEPHIT]))
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
    THEN
        RESPONSE #100
        DisplayStringHead(Myself,160)
        Spell([ENEMY],WIZARD_SPOOK)  // Cast Sleep
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

// ======================================================
// IN COMBAT SPELLCASTING - Crowd Control (CLERIC)
// ======================================================


IF
    ActuallyInCombat()
    ActionListEmpty()
    See([ENEMY])
    !ImmuneToSpellLevel(LastSeenBy(Myself),5)
    HaveSpell(CLERIC_CONFUSION)  
    !StateCheck(LastSeenBy(Myself),STATE_HELPLESS)
    !CheckSpellState(LastSeenBy(Myself),BERSERKER_RAGE)
    !CheckSpellState(LastSeenBy(Myself),BARBARIAN_RAGE)
    !General(LastSeenBy(Myself),UNDEAD)  // Exclude undead
    !Race(LastSeenBy(Myself),GOLEM)
    !Race(LastSeenBy(Myself),SWORD)
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(LastSeenBy(Myself),CLERIC_CONFUSION)
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    ActuallyInCombat()
    OR(6)
        See([ENEMY.0.0.MAGE_ALL])
        See([ENEMY.0.0.CLERIC_ALL])
        See([ENEMY.0.0.BARD_ALL])
        See([ENEMY.0.0.DRUID_ALL])
        See([ENEMY.0.0.SORCERER])
        See([ENEMY.0.0.RAKSHASA])
    HaveSpell(CLERIC_INSECT_PLAGUE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(LastSeenBy(Myself),CLERIC_INSECT_PLAGUE)
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

// CLERIC_SUMMON_INSECTS
IF
    ActionListEmpty()
    ActuallyInCombat()
    See([ENEMY])
    OR(7)
        See([ENEMY.0.0.MAGE_ALL])
        See([ENEMY.0.0.CLERIC_ALL])
        See([ENEMY.0.0.BARD_ALL])
        See([ENEMY.0.0.DRUID_ALL])
        See([ENEMY.0.0.SORCERER])
        See([ENEMY.0.0.RAKSHASA])
        SpellCast([ENEMY],CLERIC_SUMMON_INSECTS)
    HaveSpell(CLERIC_SUMMON_INSECTS)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(LastSeenBy(Myself),CLERIC_SUMMON_INSECTS)
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

// ======================================================
// IN COMBAT SPELLCASTING - AOE OFFENSIVE (WIZARD)
// ======================================================
/* Comet for high damage and knockback */
IF
    ActuallyInCombat()
    ActionListEmpty()
    HaveSpell(WIZARD_COMET)  // SPWI909.SPL (Comet)
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(FarthestEnemyOf(Myself), WIZARD_COMET)
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    ActuallyInCombat()
    HaveSpell(WIZARD_DRAGONS_BREATH)
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(FarthestEnemyOf(Myself),WIZARD_DRAGONS_BREATH)  // Cast Dragon's Breath
END

/*
Meteor Swarm
(Evocation)

Level: 9
Range: 270 ft.
Duration: 4 rounds
Casting Time: 9
Area of Effect: 15-ft. radius
Saving Throw: None

When the caster utters the words to this powerful spell, <PRO_HESHE> calls upon powerful forces indeed. 
These forces pull down meteors from above, hurling them randomly at anyone in the area of effect. 
Anyone caught in the destructive path of the meteors—whether friend or foe—will suffer 4d10 points of damage with no Saving Throw. 
The caster is well advised to be careful in <PRO_HISHER> use of this spell.
*/
IF
    ActionListEmpty()
    ActuallyInCombat()
    HaveSpell(WIZARD_METEOR_SWARM)
    CheckStatLT(FarthestEnemyOf(Myself),100,RESISTMAGIC)
    CheckStatLT(FarthestEnemyOf(Myself),100,RESISTFIRE)
    !Range(FarthestEnemyOf(Myself),22)  
    Range(NearestEnemyOf(FarthestEnemyOf(Myself)),8)
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(FarthestEnemyOf(Myself),WIZARD_METEOR_SWARM)  // Cast Dragon's Breath
END

/*
Death Fog
(Evocation)

Level: 6
Range: 30 ft.
Duration: 1 turn
Casting Time: 6
Area of Effect: 15-ft. radius
Saving Throw: None

The casting of a Death Fog spell creates an area of solid fog that has the additional property of being highly acidic.
All animal life not immune to acid suffers 8 points of damage for each round they are exposed to the vapors of the
Death Fog. Death Fog will also instantly kill all summoned creatures, regardless of their Hit Dice and immunities.
*/
IF
    ActionListEmpty()
    HaveSpell(WIZARD_DEATH_FOG) 
    CheckStatLT([ENEMY],100,RESISTACID)
    CheckStatLT([ENEMY],100,RESISTMAGIC)
    !ImmuneToSpellLevel([ENEMY],1)
    !CheckSpellState([ENEMY],SI_EVOCATION)
    !Range(FarthestEnemyOf(Myself),30)  
    Range(NearestEnemyOf(FarthestEnemyOf(Myself)),8)
    NumCreatureLT([GOODCUTOFF.0.0.0.0.SUMMONED],1)
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(FarthestEnemyOf(Myself),WIZARD_DEATH_FOG)
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
        Continue()
END

/*
Sphere of Chaos
(Alteration)

Level: 7
Range: 40 ft.
Duration: 1 turn
Casting Time: 7
Area of Effect: 15-ft. radius
Saving Throw: Special

All enemies within the area of effect must make a Saving Throw vs. Spell every round that they remain in the sphere. 
If the Saving Throw is failed, one of the following random effects occurs:
 – target is polymorphed into a squirrel
 – target confused
 – target bursts into flames
 – target is paralyzed
 – target is disintegrated
 – target is healed 20 Hit Points
 – target is randomly teleported
 – target is rendered unconscious
 – target is hasted
*/
IF
    ActionListEmpty()
    ActuallyInCombat()
    HaveSpell(WIZARD_SPHERE_OF_CHAOS)
    CheckStatLT([ENEMY],100,RESISTMAGIC)
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell([ENEMY],WIZARD_SPHERE_OF_CHAOS)  // Cast Dragon's Breath
END


IF
    ActionListEmpty()
    ActuallyInCombat()
    HaveSpell(WIZARD_CLOUDKILL)
    CheckStatLT(FarthestEnemyOf(Myself),100,RESISTMAGIC)
    CheckStatLT(FarthestEnemyOf(Myself),100,RESISTPOISON)
    !Range(FarthestEnemyOf(Myself),16)  
    Range(NearestEnemyOf(FarthestEnemyOf(Myself)),8)
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(FarthestEnemyOf(Myself),WIZARD_CLOUDKILL)  // Cast Dragon's Breath
END

IF
    ActionListEmpty()
    ActuallyInCombat()
    HaveSpell(WIZARD_INCENDIARY_CLOUD)
    CheckStatLT(FarthestEnemyOf(Myself),100,RESISTMAGIC)
    CheckStatLT(FarthestEnemyOf(Myself),100,RESISTFIRE)
    !Range(FarthestEnemyOf(Myself),16)  
    Range(NearestEnemyOf(FarthestEnemyOf(Myself)),8)
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(FarthestEnemyOf(Myself),WIZARD_INCENDIARY_CLOUD)  // Cast Dragon's Breath
END

IF
    ActionListEmpty()
    ActuallyInCombat()
    HaveSpell(WIZARD_ABI_DALZIMS_HORRID_WILTING)
    CheckStatLT(FarthestEnemyOf(Myself),100,RESISTMAGIC)
    !Range(FarthestEnemyOf(Myself),16)  
    Range(NearestEnemyOf(FarthestEnemyOf(Myself)),8)
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(FarthestEnemyOf(Myself),WIZARD_ABI_DALZIMS_HORRID_WILTING)  // Cast Dragon's Breath
END

IF
    ActionListEmpty()
    ActuallyInCombat()
    HaveSpell(WIZARD_SKULL_TRAP)
    CheckStatLT(FarthestEnemyOf(Myself),100,RESISTMAGIC)
    !Range(FarthestEnemyOf(Myself),16)  // Ensure the enemy is within medium range
    // How close is the closest ally 
    Range(NearestEnemyOf(FarthestEnemyOf(Myself)),8)
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(FarthestEnemyOf(Myself),WIZARD_SKULL_TRAP)  // Cast Dragon's Breath
END

IF
    ActionListEmpty()
    ActuallyInCombat()
    OR(2)
        CheckSpellState(Myself,CHAOS_SHIELD)
        CheckSpellState(Myself,IMPROVED_CHAOS_SHIELD)
    HaveSpell(WIZARD_ALARM)  
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS") 
THEN
    RESPONSE #100
        Spell(Myself,WIZARD_ALARM)  
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND) 
END


IF
    ActionListEmpty()
    HaveSpell(WIZARD_DELAYED_BLAST_FIREBALL)  // SPWI304.SPL (Fireball)
    CheckStatLT([ENEMY],100,RESISTFIRE)
    CheckStatLT([ENEMY],100,RESISTMAGIC)
    !Range(FarthestEnemyOf(Myself),16)
    // How close is the closest ally 
    Range(NearestEnemyOf(FarthestEnemyOf(Myself)),8)
    !HasBounceEffects(FarthestEnemyOf(Myself))
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(FarthestEnemyOf(Myself),WIZARD_DELAYED_BLAST_FIREBALL)  // SPWI304.SPL (Fireball)
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END


IF
    ActionListEmpty()
    HaveSpell(WIZARD_SUN_FIRE)  // SPWI304.SPL (Fireball)
    CheckStatLT([ENEMY],100,RESISTFIRE)
    CheckStatLT([ENEMY],100,RESISTMAGIC)
    !Range(FarthestEnemyOf(Myself),16)
    // How close is the closest ally 
    Range(NearestEnemyOf(FarthestEnemyOf(Myself)),8)
    !HasBounceEffects(FarthestEnemyOf(Myself))
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(FarthestEnemyOf(Myself),WIZARD_SUN_FIRE)  // SPWI304.SPL (Fireball)
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    HaveSpell(WIZARD_CHAIN_LIGHTNING)  // SPWI304.SPL (Fireball)
    CheckStatLT([ENEMY],100,RESISTELECTRICITY)
    CheckStatLT([ENEMY],100,RESISTMAGIC)
    !Range(FarthestEnemyOf(Myself),16)
    // How close is the closest ally 
    Range(NearestEnemyOf(FarthestEnemyOf(Myself)),8)
    !HasBounceEffects(FarthestEnemyOf(Myself))
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(FarthestEnemyOf(Myself),WIZARD_CHAIN_LIGHTNING)  // SPWI304.SPL (Fireball)
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    HaveSpell(WIZARD_FIREBALL)  // SPWI304.SPL (Fireball)
    CheckStatLT([ENEMY],100,RESISTFIRE)
    CheckStatLT([ENEMY],100,RESISTMAGIC)
    !Range(FarthestEnemyOf(Myself),14)
    // How close is the closest ally 
    Range(NearestEnemyOf(FarthestEnemyOf(Myself)),8)
    !HasBounceEffects(FarthestEnemyOf(Myself))
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(FarthestEnemyOf(Myself),WIZARD_FIREBALL)  // SPWI304.SPL (Fireball)
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

/* Ice Storm for enemies with more than 60 HP at medium range */
IF
    ActionListEmpty()
    HPGT(FarthestEnemyOf(Myself),40)
    HaveSpell(WIZARD_ICE_STORM)  // SPWI409.SPL (Ice Storm)
    CheckStatLT([ENEMY],100,RESISTCOLD)
    CheckStatLT([ENEMY],100,RESISTMAGIC)
    !Range(FarthestEnemyOf(Myself),10)  // Ensure the enemy is within medium range
    // How close is the closest ally 
    Range(FarthestEnemyOf(FarthestEnemyOf(Myself)),8)
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(FarthestEnemyOf(Myself),WIZARD_ICE_STORM)  // SPWI409.SPL (Ice Storm)
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END



/* Burning Hands for nearby enemies with more than 20 HP */
IF
    ActionListEmpty()
    !HasBounceEffects(NearestEnemyOf(Myself))
    HaveSpell(WIZARD_BURNING_HANDS)  // SPWI103.SPL (Burning Hands)
    CheckStatLT([ENEMY],100,RESISTFIRE)
    CheckStatLT([ENEMY],100,RESISTMAGIC)
    Range(NearestEnemyOf(Myself),6)  // Ensure the enemy is close enough
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(NearestEnemyOf(Myself),WIZARD_BURNING_HANDS)  // SPWI103.SPL (Burning Hands)
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
        Continue()
END

/* Color Spray for nearby enemies with more than 20 HP */
IF
    ActionListEmpty()
    See(NearestEnemyOf(Myself))
    !HasBounceEffects(NearestEnemyOf(Myself))
    HaveSpell(WIZARD_PRISMATIC_SPRAY)  // SPWI105.SPL (Color Spray)
    Range(NearestEnemyOf(Myself),10)  // Ensure the enemy is close enough
    !Range(NearestEnemyOf(NearestEnemyOf(Myself)),10)  // Ensure the enemy is close enough
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(NearestEnemyOf(Myself),WIZARD_PRISMATIC_SPRAY)  // SPWI105.SPL (Color Spray)
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
        Continue()
END

/* Color Spray for nearby enemies with more than 20 HP */
IF
    ActionListEmpty()
    See(NearestEnemyOf(Myself))
    NumCreatureGT([ENEMY],4)
    !HasBounceEffects(NearestEnemyOf(Myself))
    HaveSpell(WIZARD_COLOR_SPRAY)  // SPWI105.SPL (Color Spray)
    Range(NearestEnemyOf(Myself),10)  // Ensure the enemy is close enough
    !Range(NearestEnemyOf(NearestEnemyOf(Myself)),10)  // Ensure the enemy is close enough
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(NearestEnemyOf(Myself),WIZARD_COLOR_SPRAY)  // SPWI105.SPL (Color Spray)
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
        Continue()
END

/* Cone of Cold for a close group of enemies */
IF
    ActionListEmpty()
    HaveSpell(WIZARD_CONE_OF_COLD)  // SPWI608.SPL (Cone of Cold)
    CheckStatLT([ENEMY],100,RESISTCOLD)
    CheckStatLT([ENEMY],100,RESISTMAGIC)
    Range(NearestEnemyOf(Myself),10)  // Ensure the enemies are close enough
    !Range(NearestEnemyOf(NearestEnemyOf(Myself)),10)  // Ensure the enemy is close enough
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(NearestEnemyOf(Myself),WIZARD_CONE_OF_COLD)  // SPWI608.SPL (Cone of Cold)
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
        Continue()
END

// ======================================================
// SECTION: IN COMBAT SPELLCASTING - AOE OFFENSIVE (CLERIC)
// ======================================================

IF
    ActionListEmpty()
    Range([ENEMY],25)
    General([ENEMY],UNDEAD)
    HaveSpell(CLERIC_FALSE_DAWN) 
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,CLERIC_FALSE_DAWN) 
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
        Continue()
END

IF
    ActionListEmpty()
    Range([ENEMY],25)
    General([ENEMY],UNDEAD)
    HaveSpell(CLERIC_SUNRAY) 
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,CLERIC_SUNRAY) 
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
        Continue()
END

/*
Unholy Blight
(Necromancy)

Level: 3
Sphere: Healing 
Range: Visual range of the caster
Duration: Instant
Casting Time: 3 
Area of Effect: 15-ft. radius
Saving Throw: Special 

This spell calls upon energy from the Negative Energy Plane in order to open a channel 
between it and the targets. The result is that any good creatures within the spell's area
of effect take 1d4 points of damage per level of the caster, or half damage upon a successful Saving Throw vs. Spell. 
If the victims fail their Saving Throw, they also receive a -2 penalty to all their rolls for 4 rounds.
*/
IF
    ActionListEmpty()
    ActuallyInCombat()
    Allegiance([ENEMY],GOODCUTOFF)
    !Range([ENEMY],22)
    Range(NearestEnemyOf([ENEMY]),8)
    !HasBounceEffects(FarthestEnemyOf(Myself))
    HaveSpell(CLERIC_UNHOLY_BLIGHT) 
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell([ENEMY],CLERIC_UNHOLY_BLIGHT) 
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

/*
Holy Word
(Conjuration/Summoning)

Level: 7
Sphere: Combat
Range: 0
Duration: Special
Casting Time: 1
Area of Effect: 15-ft. radius
Saving Throw: None

Uttering a Holy Word spell creates magic of tremendous power. The priest acts as a bridge between <PRO_HISHER> god and the Prime Material Plane, causing a small explosion centered on the priest and reaching up to a 15-ft. radius. It affects only enemy evil creatures and undead of any alignment that are caught in the area of effect. The effects vary depending on the target's Hit Dice:

Hit Dice / Levels  —  Effects of Holy Word
Less than 4  —  Death
4 to 7  —  Stunned for 1 turn
8 to 11  —  Slowed for 1 turn with a 75% chance of spell failure
12 and up  —  Deafened for 1 turn with a 50% chance of spell failure

There is no Saving Throw. The effects are instantaneous and last for the duration of the spell or until dispelled. Note that this spell may not be cast by any priest of evil alignment.
*/
IF
    ActionListEmpty()
    ActuallyInCombat()
    Allegiance([ENEMY],EVILCUTOFF)
    Range([ENEMY],15)
    !HasBounceEffects(FarthestEnemyOf(Myself))
    HaveSpell(CLERIC_HOLY_WORD) 
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,CLERIC_HOLY_WORD) 
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    !Range(FarthestEnemyOf(Myself),22)
    Range(NearestEnemyOf(FarthestEnemyOf(Myself)),8)
    !HasBounceEffects(FarthestEnemyOf(Myself))
    HaveSpell(CLERIC_FIRE_STORM)  // SPPR009.SPL (Flame Strike)
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(FarthestEnemyOf(Myself),CLERIC_FIRE_STORM)  // Cast Flame Strike for vertical fire damage
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
        Continue()
END

IF
    ActionListEmpty()
    !Range(FarthestEnemyOf(Myself),22)
    Range(NearestEnemyOf(FarthestEnemyOf(Myself)),8)
    !HasBounceEffects(FarthestEnemyOf(Myself))
    HaveSpell(CLERIC_STORM_OF_VENGEANCE)  // SPPR009.SPL (Flame Strike)
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(FarthestEnemyOf(Myself),CLERIC_STORM_OF_VENGEANCE)  // Cast Flame Strike for vertical fire damage
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
        Continue()
END

IF
    ActionListEmpty()
    !Range(FarthestEnemyOf(Myself),22)
    Range(NearestEnemyOf(FarthestEnemyOf(Myself)),8)
    !HasBounceEffects(FarthestEnemyOf(Myself))
    HaveSpell(CLERIC_HOLY_SMITE)  // SPPR009.SPL (Flame Strike)
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(FarthestEnemyOf(Myself),CLERIC_HOLY_SMITE)  // Cast Flame Strike for vertical fire damage
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
        Continue()
END


IF
    ActuallyInCombat()
    ActionListEmpty()
    HaveSpell(CLERIC_SYMBOL_FEAR)  
    !Range(FarthestEnemyOf(Myself),24)
    // How close is the closest ally 
    Range(NearestEnemyOf(FarthestEnemyOf(Myself)),8)
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(FarthestEnemyOf(Myself),CLERIC_SYMBOL_FEAR)  // Cast Web on any visible enemies
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

IF
    ActuallyInCombat()
    ActionListEmpty()
    HaveSpell(CLERIC_GLYPH_OF_WARDING)  
    !Range(FarthestEnemyOf(Myself),24)
    // How close is the closest ally 
    Range(NearestEnemyOf(FarthestEnemyOf(Myself)),8)
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(FarthestEnemyOf(Myself),CLERIC_GLYPH_OF_WARDING)  // Cast Web on any visible enemies
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

IF
    ActuallyInCombat()
    ActionListEmpty()
    HaveSpell(CLERIC_ENTANGLE)  
    !Range(FarthestEnemyOf(Myself),24)
    // How close is the closest ally 
    Range(NearestEnemyOf(FarthestEnemyOf(Myself)),8)
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(FarthestEnemyOf(Myself),CLERIC_ENTANGLE)  // Cast Web on any visible enemies
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

// ======================================================
// IN COMBAT SPELLCASTING - OFFENSIVE Single Target (WIZARD)
// ======================================================


/* 
Chromatic Orb 
(Evocation)

Level: 1
Range: 90 ft.
Duration: Special
Casting Time: 1
Area of Effect: 1 creature
Saving Throw: Special

This spell causes a 2-ft. diameter sphere to appear in the caster's hand. When thrown, the sphere heads unerringly to its target. The effect the orb has upon the target varies with the level of the caster. 
Each orb will do damage to the target against which there is no save and an effect against which the target must save vs. Spell with a +6 bonus:
 1st Level: 1d4 damage and blinds the target for 1 round.
 2nd Level: 1d4 damage and inflicts pain (-1 penalty to Strength, Dexterity, AC, and THAC0) upon the victim.
 3rd Level: 1d6 damage and burns the victim for an additional 1d8 damage.
 4th Level: 1d6 damage and blinds the target for 1 turn.
 5th Level: 1d8 damage and stuns the target for 3 rounds.
 6th Level: 1d8 damage and causes weakness (-4 penalty to THAC0) in the victim.
 7th Level: 1d10 damage and paralyzes the victim for 2 turns.
 10th Level: 1d12 acid damage and turns the victim to stone.
 12th Level: 2d8 acid damage and instantly kills the victim.

NOTE: The victim saves vs. Spell with a +6 bonus against all the effects and gets no save against the damage.
*/
IF
    ActionListEmpty()
    HaveSpell(WIZARD_CHROMATIC_ORB)  // SPWI103.SPL (Chromatic Orb)
    CheckStatLT([ENEMY],100,RESISTACID)
    CheckStatLT([ENEMY],100,RESISTMAGIC)
    LevelGT([ENEMY],1)
    !ImmuneToSpellLevel([ENEMY],1)
    !CheckSpellState([ENEMY],SI_EVOCATION)
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell([ENEMY],WIZARD_CHROMATIC_ORB)  // SPWI103.SPL (Chromatic Orb)
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
        Continue()
END

IF
    ActionListEmpty()
    OR(8)
        See([ENEMY])
        See([ENEMY.0.0.RANGER]) // Default target
        See([ENEMY.0.0.THIEF]) // Default target
        See([ENEMY.0.0.BARD_ALL]) // Default target
        See([ENEMY.0.0.CLERIC_ALL])
        See([ENEMY.0.0.DRUID_ALL])
        See([ENEMY.0.0.MAGE_ALL])
        See([ENEMY.0.0.SORCERER]) // Highest priority
    HaveSpell(WIZARD_AGANNAZAR_SCORCHER) 
    !ImmuneToSpellLevel(LastSeenBy(Myself),2)
    !CheckSpellState(LastSeenBy(Myself),SI_EVOCATION)
    !HasBounceEffects(LastSeenBy(Myself))
    CheckStatLT(LastSeenBy(Myself),100,RESISTMAGIC)
    CheckStatLT(LastSeenBy(Myself),100,RESISTFIRE)
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(LastSeenBy(Myself),WIZARD_AGANNAZAR_SCORCHER) 
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    OR(8)
        See([ENEMY])
        See([ENEMY.0.0.RANGER]) // Default target
        See([ENEMY.0.0.THIEF]) // Default target
        See([ENEMY.0.0.BARD_ALL]) // Default target
        See([ENEMY.0.0.CLERIC_ALL])
        See([ENEMY.0.0.DRUID_ALL])
        See([ENEMY.0.0.MAGE_ALL])
        See([ENEMY.0.0.SORCERER]) // Highest priority
    HaveSpell(WIZARD_GHOUL_TOUCH) 
    HPGT(LastSeenBy(Myself),15)
    !HasBounceEffects(LastSeenBy(Myself))
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,WIZARD_GHOUL_TOUCH) 
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

/* Melf's Acid Arrow for enemies with 20-40 HP */
IF
    ActionListEmpty()
    OR(8)
        See([ENEMY])
        See([ENEMY.0.0.RANGER]) // Default target
        See([ENEMY.0.0.THIEF]) // Default target
        See([ENEMY.0.0.BARD_ALL]) // Default target
        See([ENEMY.0.0.CLERIC_ALL])
        See([ENEMY.0.0.DRUID_ALL])
        See([ENEMY.0.0.MAGE_ALL])
        See([ENEMY.0.0.SORCERER]) // Highest priority
    HaveSpell(WIZARD_MELF_ACID_ARROW)  // SPWI205.SPL (Melf's Acid Arrow)
    CheckStatLT([ENEMY],100,RESISTACID)
    CheckStatLT([ENEMY],100,RESISTMAGIC)
    OR(2)
        LevelGT(LastSeenBy(Myself),2)
        GlobalTimerNotExpired("TROLL_ENEMIES","LOCALS")
    !HasBounceEffects(LastSeenBy(Myself))
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(LastSeenBy(Myself),WIZARD_MELF_ACID_ARROW)  // SPWI205.SPL (Melf's Acid Arrow)
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

/* Flame Arrow for enemies with 40-60 HP */
IF
    ActionListEmpty()
    HaveSpell(WIZARD_FLAME_ARROW)  // SPWI304.SPL (Flame Arrow)
    CheckStatLT([ENEMY],100,RESISTFIRE)
    CheckStatLT([ENEMY],100,RESISTMAGIC)
    LevelGT([ENEMY],3)
    !HasBounceEffects([ENEMY])
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell([ENEMY],WIZARD_FLAME_ARROW)  // SPWI304.SPL (Flame Arrow)
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    HaveSpell(WIZARD_BIGBYS_CRUSHING_HAND)  // SPWI304.SPL (Flame Arrow)
    CheckStatLT([ENEMY],100,RESISTMAGIC)
    LevelGT([ENEMY],3)
    !HasBounceEffects([ENEMY])
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell([ENEMY],WIZARD_BIGBYS_CRUSHING_HAND)  // SPWI304.SPL (Flame Arrow)
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    HaveSpell(WIZARD_BIGBYS_CLENCHED_FIST)  // SPWI304.SPL (Flame Arrow)
    CheckStatLT([ENEMY],100,RESISTMAGIC)
    LevelGT([ENEMY],3)
    !HasBounceEffects([ENEMY])
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell([ENEMY],WIZARD_BIGBYS_CLENCHED_FIST)  // SPWI304.SPL (Flame Arrow)
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END


/* Magic Missile for enemies with more than 20 HP and no bounce effects */
IF
    ActionListEmpty()
    HaveSpell(WIZARD_MAGIC_MISSILE)  // SPWI112.SPL (Magic Missile)
    LevelGT([ENEMY],2)
    !ImmuneToSpellLevel(LastSeenBy(Myself),1)
    !HasBounceEffects([ENEMY])
    CheckStatLT([ENEMY],100,RESISTMAGIC)
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell([ENEMY],WIZARD_MAGIC_MISSILE)  // SPWI112.SPL (Magic Missile)
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    HaveSpell(WIZARD_LARLOCH_MINOR_DRAIN) 
    HPPercentLT(Myself,80)
    !HasBounceEffects(NearestEnemyOf(Myself))
    CheckStatLT([ENEMY],100,RESISTMAGIC)
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell([ENEMY],WIZARD_LARLOCH_MINOR_DRAIN) 
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

// ======================================================
// IN COMBAT SPELLCASTING - CURSE SINGLE TARGET (WIZARD)
// ======================================================

/*
Lower Resistance
(Abjuration)

Level: 5
Range: 40 ft.
Duration: 9 rounds + 1 round/level after 9th
Casting Time: 5
Area of Effect: 1 creature
Saving Throw: None

When cast upon a target creature, this spell will lower the Magic Resistance of this creature by 10% + 1% per level of the caster. 
There is no Saving Throw, and the target's Magic Resistance, if any, does not affect this spell. 
For example, if a creature has 60% Magic Resistance and this spell is cast on it by a 15th-level Mage, 
then the target's Magic Resistance would be lowered by 25% automatically. This effect is cumulative for 
 each casting of this spell: If Lower Resistance was cast upon the same creature again, the creature's 
 Magic Resistance would be 60% - 25% (initial casting) - 25% (current casting), which would leave the creature with 10% Magic Resistance. 
 This spell will last until its duration expires and cannot be dispelled.
*/
IF
    ActionListEmpty()
    ActuallyInCombat()
    CheckStatGT([ENEMY],50,RESISTMAGIC)
    HaveSpell(WIZARD_LOWER_RESISTANCE)  
    !ImmuneToSpellLevel([ENEMY],5)
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell([ENEMY],WIZARD_LOWER_RESISTANCE) 
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

/* 
Finger of Death
(Necromancy)

Level: 7
Range: Visual range of the caster 
Duration: Permanent
Casting Time: 5
Area of Effect: 1 creature
Saving Throw: Neg.

The Finger of Death spell snuffs out the victim's life force. The caster points <PRO_HISHER>
 finger at the victim after the incantation is complete, effectively ripping the life out of 
 its body unless a Save vs. Spell is made with a -2 penalty. A creature that successfully 
 saves still receives 2d8+1 points of damage.
*/
IF
    ActionListEmpty()
    HaveSpell(WIZARD_FINGER_OF_DEATH)  // SPWI704.SPL (Finger of Death)
    LevelGT([ENEMY],6)
    !HasBounceEffects([ENEMY])
    !ImmuneToSpellLevel(LastSeenBy(Myself),7)
    CheckStatGT(LastSeenBy(Myself),7,SAVEVSSPELL) //50% chance that they get got
    !CheckSpellState([ENEMY],SI_NECROMANCY)
    !HasBounceEffects(LastSeenBy(Myself))
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell([ENEMY],WIZARD_FINGER_OF_DEATH)  // SPWI704.SPL (Finger of Death)
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

/* 
Power Word, Kill
(Conjuration/Summoning) 

Level: 9
Range: Visual range of the caster 
Duration: Instant
Casting Time: 1 
Area of Effect: 1 creature 
Saving Throw: None

When a Power Word, Kill spell is uttered, one creature within the spell range is slain.
The creature must have 60 or fewer current Hit Points, otherwise the spell has no effect. There is no Saving Throw.
*/
IF
    ActuallyInCombat()
    ActionListEmpty()
    CheckStatLT([ENEMY],100,RESISTFIRE)
    CheckStatLT([ENEMY],100,RESISTMAGIC)
    !ImmuneToSpellLevel([ENEMY],9)
    !CheckSpellState([ENEMY],SI_CONJURATION)
    HPLT([ENEMY],60)
    !HasBounceEffects([ENEMY])
    HaveSpell(WIZARD_POWER_WORD_KILL)  // SPWI910.SPL (Power Word Kill)
THEN
    RESPONSE #100
        Spell([ENEMY], WIZARD_POWER_WORD_KILL)
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

IF
    ActuallyInCombat()
    ActionListEmpty()
    CheckStatLT([ENEMY],100,RESISTFIRE)
    CheckStatLT([ENEMY],100,RESISTMAGIC)
    !ImmuneToSpellLevel([ENEMY],9)
    !CheckSpellState([ENEMY],SI_CONJURATION)
    HPLT([ENEMY],60)
    !HasBounceEffects([ENEMY])
    HaveSpell(WIZARD_WAIL_OF_THE_BANSHEE)  // SPWI910.SPL (Power Word Kill)
THEN
    RESPONSE #100
        Spell([ENEMY], WIZARD_WAIL_OF_THE_BANSHEE)
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

/*
Maze
(Conjuration/Summoning)

Level: 8
Range: Touch 
Duration: Special
Casting Time: 3
Area of Effect: 1 creature 
Saving Throw: None

An extradimensional space is brought into being upon utterance of a maze spell. 
The subject vanishes into the shifting labyrinth of force planes for a period 
of time that is totally dependent upon its Intelligence.

Intelligence of Target    —    Time trapped in maze
         under 3                —            2d4 turns
         3 to 5                   —            1d4 turns
         6 to 8                   —            5d4 rounds
         9 to 11                 —            4d4 rounds
         12 to 14               —            3d4 rounds
         15 to 17               —            2d4 rounds
         18 and up            —           1d4 rounds

Note that if the 9th-level spell Freedom is cast in the area where a creature is mazed, 
it will effectively bring <PRO_HIMHER> back to this plane, ending the spell prematurely. 
Note that a mazed creature is not freed through Dispel Magic.
*/
IF
    ActionListEmpty()
    ActuallyInCombat()
    See([ENEMY])
    LevelGT([ENEMY],6)
    !ImmuneToSpellLevel(LastSeenBy(Myself),8)
    CheckStatGT(LastSeenBy(Myself),6,SAVEVSSPELL) //and I got a reasonable chance of failing a save throw (25%+)
    !HasBounceEffects(LastSeenBy(Myself))
    HaveSpell(WIZARD_MAZE)  
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(LastSeenBy(Myself),WIZARD_MAZE)
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END


IF
    ActionListEmpty()
    ActuallyInCombat()
    See([ENEMY])
    LevelGT([ENEMY],6)
    !ImmuneToSpellLevel(LastSeenBy(Myself),9)
    CheckStatGT(LastSeenBy(Myself),6,SAVEVSSPELL) //and I got a reasonable chance of failing a save throw (25%+)
    !HasBounceEffects(LastSeenBy(Myself))
    HaveSpell(WIZARD_IMPRISONMENT)  
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(LastSeenBy(Myself),WIZARD_IMPRISONMENT)
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

/*
Disintegrate
(Alteration)

Level: 6
Range: Visual range of the caster
Duration: Instant
Casting Time: 6
Area of Effect: 1 creature
Saving Throw: Neg.

When this spell is cast at another creature, a thin green ray is shot out. 
Upon contact with the ray, the creature must make a Saving Throw vs. Spell 
or be transformed into dust. This transformation is instantaneous and irreversible. 
There is also a good chance that this will destroy some if not all of the items that the creature is carrying.
*/
IF
    ActionListEmpty()
    HaveSpell(WIZARD_DISINTEGRATE)
    LevelGT([ENEMY],6)
    !HasBounceEffects([ENEMY])
    !ImmuneToSpellLevel([ENEMY],6)
    !CheckSpellState([ENEMY],SI_ABJURATION)
    CheckStatGT([ENEMY],10,SAVEVSSPELL) //50% chance that they get got
    !HasBounceEffects([ENEMY])
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell([ENEMY],WIZARD_DISINTEGRATE)
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    HaveSpell(WIZARD_DEATH_SPELL)
    OR(2)
        LevelLT([ENEMY],8)
        Gender([ENEMY],SUMMONED)
    !HasBounceEffects([ENEMY])
    !ImmuneToSpellLevel([ENEMY],6)
    !CheckSpellState([ENEMY],SI_ABJURATION)
    CheckStatGT([ENEMY],10,SAVEVSSPELL) //50% chance that they get got
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell([ENEMY],WIZARD_DEATH_SPELL)
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    HaveSpell(WIZARD_FLESH_TO_STONE)
    LevelGT([ENEMY],6)
    !HasBounceEffects([ENEMY])
    !ImmuneToSpellLevel([ENEMY],6)
    !CheckSpellState([ENEMY],SI_ABJURATION)
    CheckStatGT([ENEMY],10,SAVEVSSPELL) //50% chance that they get got
    !HasBounceEffects([ENEMY])
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell([ENEMY],WIZARD_FLESH_TO_STONE)
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

IF
    ActuallyInCombat()
    ActionListEmpty()
    See([ENEMY])
    HPPercentGT(LastSeenBy(Myself),90)
    !HasBounceEffects(LastSeenBy(Myself))
    General(LastSeenBy(Myself),HUMANOID)
    !StateCheck(LastSeenBy(Myself),STATE_HELPLESS)
    HaveSpell(WIZARD_DOMINATION) 
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(LastSeenBy(Myself),WIZARD_DOMINATION) 
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END


IF
    ActuallyInCombat()
    ActionListEmpty()
    See([ENEMY])
    HPPercentGT(LastSeenBy(Myself),90)
    !HasBounceEffects(LastSeenBy(Myself))
    General(LastSeenBy(Myself),HUMANOID)
    !StateCheck(LastSeenBy(Myself),STATE_HELPLESS)
    HaveSpell(WIZARD_CHARM_PERSON) 
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(LastSeenBy(Myself),WIZARD_CHARM_PERSON) 
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

IF
    ActuallyInCombat()
    ActionListEmpty()
    See([ENEMY])
    !HasBounceEffects(LastSeenBy(Myself))
    General(LastSeenBy(Myself),UNDEAD)
    !StateCheck(LastSeenBy(Myself),STATE_HELPLESS)
    HaveSpell(WIZARD_CONTROL_UNDEAD) 
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(LastSeenBy(Myself),WIZARD_CONTROL_UNDEAD) 
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

/*
Dire Charm
(Enchantment/Charm)

Level: 3
Range: 60 ft.
Duration: 5 rounds
Casting Time: 3
Area of Effect: 1 creature
Saving Throw: Neg. 

This spell works in the exact same manner as Charm Person, with one difference: There is no Saving Throw bonus. Dire Charm affects any single person it is cast upon. The term person includes any bipedal human, demihuman, or humanoid of man-size or smaller, such as brownies, dryads, dwarves, elves, gnolls, gnomes, goblins, half-elves, halflings, half-orcs, hobgoblins, humans, kobolds, lizard men, nixies, orcs, pixies, sprites, troglodytes, and others. Thus, a 10th-level fighter could be charmed, but an ogre could not. The person is allowed a Saving Throw vs. Spell to negate the effect.

If the spell's recipient fails <PRO_HISHER> Saving Throw, <PRO_HESHE> regards the caster as a trusted friend and ally to be heeded and protected. The caster may give <PRO_HIMHER> orders, and the charmed individual will carry them out as quickly as possible.

If the caster harms—or attempts to harm—the charmed person by some overt action, or if a Dispel Magic spell is cast upon the charmed person, the Dire Charm spell is broken. If two or more Charms simultaneously affect a creature, the most recent Charm takes precedence. Note that the subject has full memory of the events that took place while <PRO_HESHE> was charmed. Also note that you cannot have a charmed creature leave the area where <PRO_HESHE> is charmed.
*/
IF
    ActuallyInCombat()
    ActionListEmpty()
    See([ENEMY])
    HPPercentGT(LastSeenBy(Myself),90)
    !HasBounceEffects(LastSeenBy(Myself))
    General(LastSeenBy(Myself),HUMANOID)
    !StateCheck(LastSeenBy(Myself),STATE_HELPLESS)
    HaveSpell(WIZARD_DIRE_CHARM) 
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(LastSeenBy(Myself),WIZARD_DIRE_CHARM) 
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

//Safana's charm
IF
    ActionListEmpty()
    ActuallyInCombat()
    HaveSpellRES("SPIN119")  
    See([ENEMY])
    HPPercentGT(LastSeenBy(Myself),90)
    !HasBounceEffects(LastSeenBy(Myself))
    General(LastSeenBy(Myself),HUMANOID)
    !Race([ENEMY],ELF)
    !StateCheck(LastSeenBy(Myself),STATE_HELPLESS)
THEN
    RESPONSE #100
        SpellRES("SPIN119",LastSeenBy(Myself))  
END

/*
Blindness
(Illusion/Phantasm)

Level: 1
Range: 40 ft.
Duration: 2 hours
Casting Time: 2
Area of Effect: 1 creature
Saving Throw: Neg.

This 1st-level spell temporarily blinds its target. 
A Saving Throw is allowed and, if successful, there are no harmful effects. 
If a victim is blinded, <PRO_HESHE> receives a -4 penalty to <PRO_HISHER> attack rolls and Armor Class.
*/
IF
    ActionListEmpty()
    ActuallyInCombat()
    See([ENEMY])
    HPGT(LastSeenBy(Myself),20)
    NumCreatureLT([ENEMY],3)
    !ImmuneToSpellLevel(LastSeenBy(Myself),1)
    CheckStatGT(LastSeenBy(Myself),10,SAVEVSSPELL) //and I got a reasonable chance of failing a save throw (25%+)
    !HasBounceEffects(LastSeenBy(Myself))
    HaveSpell(WIZARD_BLINDNESS)  
    !StateCheck(LastSeenBy(Myself),STATE_BLIND)
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(LastSeenBy(Myself),WIZARD_BLINDNESS)
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

// ======================================================
// IN COMBAT SPELLCASTING - CURSE SINGLE TARGET (CLERIC)
// ======================================================

IF
    ActionListEmpty()
    HaveSpell(CLERIC_FINGER_OF_DEATH)  // SPWI704.SPL (Finger of Death)
    LevelGT([ENEMY],6)
    !HasBounceEffects([ENEMY])
    !ImmuneToSpellLevel(LastSeenBy(Myself),7)
    CheckStatGT(LastSeenBy(Myself),7,SAVEVSSPELL) //50% chance that they get got
    !CheckSpellState([ENEMY],SI_NECROMANCY)
    !HasBounceEffects(LastSeenBy(Myself))
    CheckStatLT(LastSeenBy(Myself),100,RESISTMAGIC)
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell([ENEMY],CLERIC_FINGER_OF_DEATH)  // SPWI704.SPL (Finger of Death)
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END


// Cast Hold Person
// Casts Hold Person to paralyze a humanoid target, rendering them immobile and unable to act.
// Lasts for 1 turn.
IF
    ActionListEmpty()
    See([ENEMY])
    HPGT(LastSeenBy(Myself),20)
    HPPercentGT(LastSeenBy(Myself),70)
    !HasBounceEffects(LastSeenBy(Myself))
    !StateCheck(LastSeenBy(Myself),STATE_HELPLESS)
    !CheckSpellState(LastSeenBy(Myself),BERSERKER_RAGE)
    !CheckSpellState(LastSeenBy(Myself),BARBARIAN_RAGE)
    General(LastSeenBy(Myself),HUMANOID)
    !Race(LastSeenBy(Myself),GOLEM)
    CheckStatLT(LastSeenBy(Myself),100,RESISTMAGIC)
    HaveSpell(CLERIC_HOLD_PERSON)  
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(LastSeenBy(Myself),CLERIC_HOLD_PERSON) 
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END


IF
    ActionListEmpty()
    HaveSpell(WIZARD_ENERGY_DRAIN)  // SPWI704.SPL (Finger of Death)
    LevelGT([ENEMY],6)
    !HasBounceEffects([ENEMY])
    !ImmuneToSpellLevel(LastSeenBy(Myself),7)
    CheckStatGT(LastSeenBy(Myself),9,SAVEVSSPELL) //50% chance that they get got
    !CheckSpellState([ENEMY],SI_NECROMANCY)
    CheckStatLT(LastSeenBy(Myself),100,RESISTMAGIC)
    !HasBounceEffects(LastSeenBy(Myself))
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("WIZARD_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell([ENEMY],WIZARD_ENERGY_DRAIN)  // SPWI704.SPL (Finger of Death)
        SetGlobalTimer("WIZARD_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    See([ENEMY])
    HPGT(LastSeenBy(Myself),20)
    HPPercentGT(LastSeenBy(Myself),70)
    !HasBounceEffects(LastSeenBy(Myself))
    !StateCheck(LastSeenBy(Myself),STATE_HELPLESS)
    General(LastSeenBy(Myself),UNDEAD)
    HaveSpell(CLERIC_REPULSE_UNDEAD)  
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(LastSeenBy(Myself),CLERIC_REPULSE_UNDEAD) 
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

/*
Rigid Thinking 
(Enchantment/Charm)

Level: 3
Sphere: Law
Range: Visual range of the caster
Duration: 1 turn
Casting Time: 5 
Area of Effect: 1 person or mammal 
Saving Throw: Neg. 

The target of this spell must make a Saving Throw vs. Spell or come under its effects. 
When under the effects of the Rigid Thinking spell, the victim will randomly wander, attack the nearest person, or stand confused.
*/
IF
    ActionListEmpty()
    ActuallyInCombat()
    See([ENEMY])
    HPGT(LastSeenBy(Myself),20)
    HPPercentGT(LastSeenBy(Myself),70)
    !HasBounceEffects(LastSeenBy(Myself))
    !StateCheck(LastSeenBy(Myself),STATE_HELPLESS)
    !CheckSpellState(LastSeenBy(Myself),BERSERKER_RAGE)
    !CheckSpellState(LastSeenBy(Myself),BARBARIAN_RAGE)
    !General(LastSeenBy(Myself),UNDEAD)
    HaveSpell(CLERIC_RIGID_THINKING) 
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(LastSeenBy(Myself),CLERIC_RIGID_THINKING) 
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    ActuallyInCombat()
    See([ENEMY])
    HPGT(LastSeenBy(Myself),20)
    HPPercentGT(LastSeenBy(Myself),70)
    !HasBounceEffects(LastSeenBy(Myself))
    !StateCheck(LastSeenBy(Myself),STATE_HELPLESS)
    !CheckSpellState(LastSeenBy(Myself),BERSERKER_RAGE)
    !CheckSpellState(LastSeenBy(Myself),BARBARIAN_RAGE)
    General(LastSeenBy(Myself),ANIMAL)
    HaveSpell(CLERIC_HOLD_ANIMAL) 
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(LastSeenBy(Myself),CLERIC_HOLD_ANIMAL)  
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    See(NearestEnemyOf(Myself))
    HPGT(NearestEnemyOf(Myself),30)
    HPPercentGT(NearestEnemyOf(Myself),90)
    !HasBounceEffects(NearestEnemyOf(Myself))
    !StateCheck(NearestEnemyOf(Myself),STATE_HELPLESS)
    General(NearestEnemyOf(Myself),HUMANOID)
    HaveSpell(RANGER_CHARM_ANIMAL)  
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(NearestEnemyOf(Myself),RANGER_CHARM_ANIMAL)  
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

/*
Mental Domination 
(Enchantment/Charm)

Level: 4
Sphere: Thought 
Range: Visual range of the caster
Duration: 8 rounds
Casting Time: 4
Area of Effect: 1 creature 
Saving Throw: Neg.

When cast upon a subject, the subject must make a Saving Throw vs. Spell with a -2 
in order to avoid the priest entering <PRO_HISHER> mind. The effects of this spell are
similar to those of the wizard spell Domination, with a few minor differences.
Most notably, this spell gives the priest no access to the subject's thoughts, memory, or sensory apparatus.
The priest simply is able to command the subject to perform certain tasks or functions during the spell's duration. 
To control the subject, the priest must be within range and must be able to see the subject. 
This control will last until dispelled or for the duration of the spell.
*/
IF
    ActionListEmpty()
    See([ENEMY])
    HPPercentGT(LastSeenBy(Myself),90)
    !HasBounceEffects(LastSeenBy(Myself))
    !StateCheck(LastSeenBy(Myself),STATE_HELPLESS)
    !General(LastSeenBy(Myself),UNDEAD)
    !Race(LastSeenBy(Myself),GOLEM)
    HaveSpell(CLERIC_MENTAL_DOMINATION)  
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(LastSeenBy(Myself),CLERIC_MENTAL_DOMINATION)
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    See([ENEMY])
    HPPercentGT(LastSeenBy(Myself),90)
    !HasBounceEffects(LastSeenBy(Myself))
    !StateCheck(LastSeenBy(Myself),STATE_HELPLESS)
    General(LastSeenBy(Myself),HUMANOID)
    HaveSpell(CLERIC_CHARM_PERSON)  
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(LastSeenBy(Myself),CLERIC_CHARM_PERSON)
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    See([ENEMY])
    HPGT(LastSeenBy(Myself),20)
    LevelLT([ENEMY],6)
    !HasBounceEffects(LastSeenBy(Myself))
    !StateCheck(LastSeenBy(Myself),STATE_HELPLESS)
    General(LastSeenBy(Myself),HUMANOID)
    HaveSpell(CLERIC_COMMAND)  // SPPR012.SPL (Hold Person)
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(LastSeenBy(Myself),CLERIC_COMMAND) 
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    See([ENEMY])
    HPGT(LastSeenBy(Myself),20)
    LevelLT([ENEMY],6)
    !HasBounceEffects(LastSeenBy(Myself))
    !StateCheck(LastSeenBy(Myself),STATE_HELPLESS)
    !General(LastSeenBy(Myself),UNDEAD)
    HaveSpell(CLERIC_GREATER_COMMAND)  // SPPR012.SPL (Hold Person)
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(LastSeenBy(Myself),CLERIC_GREATER_COMMAND) 
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    See([ENEMY])
    General(LastSeenBy(Myself),UNDEAD)
    !HasBounceEffects(NearestEnemyOf(Myself))
    !StateCheck(NearestEnemyOf(Myself),STATE_HELPLESS)
    HaveSpell(LATHANDER_HOLD_UNDEAD) 
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(LastSeenBy(Myself),LATHANDER_HOLD_UNDEAD)  
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

// ======================================================
// IN COMBAT SPELLCASTING - OFFENSIVE SINGLE TARGET (CLERIC)
// ======================================================


// Cast Flame Strike
// Casts Flame Strike to deal fire damage in a vertical column around the target.
// Lasts for 1 turn.
IF
    ActionListEmpty()
    HPGT([ENEMY],30)
    HaveSpell(CLERIC_FLAME_STRIKE)
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell([ENEMY],CLERIC_FLAME_STRIKE) 
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    HPGT([ENEMY],30)
    HaveSpell(CLERIC_BOLT_OF_GLORY)
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell([ENEMY],CLERIC_BOLT_OF_GLORY) 
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    HPGT([ENEMY],30)
    CheckStatLT([ENEMY],100,RESISTELECTRICITY)
    HaveSpell(CLERIC_CALL_LIGHTNING) 
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell([ENEMY],CLERIC_CALL_LIGHTNING) 
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END
IF
    ActionListEmpty()
    ActuallyInCombat()
    HaveSpell(BLACKGUARD_ABSORB_HEALTH)  
    OR(2)
        LevelGT([ENEMY],2)
        NumCreatureGT([ENEMY],3)
    Range([ENEMY],6)
    HPPercentLT(Myself,90)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell([ENEMY],BLACKGUARD_ABSORB_HEALTH)  
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

/*
Slay Living
(Necromancy)

Level: 5
Sphere: Combat
Range: Touch 
Duration: Special
Casting Time: 1 
Area of Effect: 1 creature
Saving Throw: Special

Upon casting this spell, the priest has to touch an opponent in order to visit the effect upon them. An item is created upon casting. The next attack the priest makes, which must happen in the next 3 rounds, will use this item. If the first attack misses, the item disappears and the spell is wasted; however, if the attack succeeds, the victim automatically takes 2d6+9 damage. Also, <PRO_HESHE> must make a Save vs. Spell or be instantly killed. Slay Living can be dispelled if cast between the casting of this spell and the necessary attack.
*/
IF
    ActionListEmpty()
    ActuallyInCombat()
    LevelGT([ENEMY],5)
    HaveSpell(CLERIC_SLAY_LIVING)  // SPPR010.SPL (Harm)
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell(Myself,CLERIC_SLAY_LIVING)  // Cast Harm to significantly reduce enemy's HP
        AttackOneRound([ENEMY])
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
        Wait(4)
END

IF
    ActionListEmpty()
    LevelGT([ENEMY],5)
    HaveSpell(CLERIC_CAUSE_SERIOUS_WOUNDS)  // SPPR010.SPL (Harm)
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell([ENEMY],CLERIC_CAUSE_SERIOUS_WOUNDS)  // Cast Harm to significantly reduce enemy's HP
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    LevelGT([ENEMY],15)
    HaveSpell(CLERIC_IMPLOSION) 
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell([ENEMY],CLERIC_IMPLOSION)  
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

// Cast Harm
// Casts Harm to deal a large amount of damage to the target, reducing their HP to 1.
// Lasts for 1 turn.
IF
    ActionListEmpty()
    LevelGT([ENEMY],5)
    HaveSpell(CLERIC_HARM) 
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell([ENEMY],CLERIC_HARM)  
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

/*
Dolorous Decay
(Alteration, Necromancy)

Sphere: Combat, Necromantic
Level: 6
Range: 30 ft.
Duration: Special
Casting Time: 1
Area of Effect: 1 creature
Saving Throw: Special

This spell affects a single living creature. Dolorous Decay is a rotting and withering of the body that spreads throughout the afflicted creature quickly. The target creature will automatically be slowed for 2 rounds. Furthermore, if the target fails a Saving Throw vs. Poison with a -2 penalty, <PRO_HESHE> will suffer 1 point of damage per second until a total of 50 points of damage are inflicted.
*/
IF
    ActionListEmpty()
    LevelGT([ENEMY],5)
    HaveSpell(CLERIC_DOLOROUS_DECAY)  // SPPR010.SPL (Harm)
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell([ENEMY],CLERIC_DOLOROUS_DECAY)  // Cast Harm to significantly reduce enemy's HP
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    CheckStatLT([ENEMY],100,RESISTPOISON)
    HaveSpell(CLERIC_POISON)  // SPPR010.SPL (Harm)
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
THEN
    RESPONSE #100
        Spell([ENEMY],CLERIC_POISON)  // Cast Harm to significantly reduce enemy's HP
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

// ======================================================
// SECTION: BUFFS (FIGHTER)
// ======================================================

IF
    ActionListEmpty()
    HaveSpell(WARRIOR_GREATER_WHIRLWIND)
    ActuallyInCombat()
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
    Delay(30)
THEN
    RESPONSE #100
        Spell(Myself, WARRIOR_GREATER_WHIRLWIND)  // Perform Greater Whirlwind Attack
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND) 
        Continue()
END


IF
    ActionListEmpty()
    HaveSpell(WARRIOR_WHIRLWIND)
    ActuallyInCombat()
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
    Delay(30)
THEN
    RESPONSE #100
        Spell(Myself, WARRIOR_WHIRLWIND)  // Perform Greater Whirlwind Attack
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND) 
        Continue()
END

/*
Resist Magic
This ability allows the warrior to temporarily tap a great inner strength and fight off the effects of malevolent magic. For 4 rounds, the warrior's Magic Resistance is set to 50%. This is not cumulative with other forms of Magic Resistance, so if the warrior already has 50% Magic Resistance or greater, the ability is useless.
*/
IF
    ActionListEmpty()
    HaveSpell(WARRIOR_RESIST_MAGIC)
    CheckStatLT(Myself,50,RESISTMAGIC)
    ActuallyInCombat()
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
    Delay(30)
THEN
    RESPONSE #100
        Spell(Myself, WARRIOR_RESIST_MAGIC)  // Perform Greater Whirlwind Attack
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND) 
        Continue()
END

/*
Hardiness
Calling upon hidden reserves of strength during times of danger, a warrior can use the Hardiness ability to gain 40% resistance to all forms of physical damage. The ability lasts for 1 round for every 2 levels of the warrior.

This ability does not stack with Defensive Stance.
*/
IF
    ActionListEmpty()
    HaveSpell(WARRIOR_HARDINESS)
    ActuallyInCombat()
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
    Delay(60)
THEN
    RESPONSE #100
        Spell(Myself, WARRIOR_HARDINESS)  // Perform Greater Whirlwind Attack
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND) 
        Continue()
END

IF
    ActionListEmpty()
    HaveSpell(ROGUE_EVASION)
    ActuallyInCombat()
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
    Delay(60)
THEN
    RESPONSE #100
        Spell(Myself, ROGUE_EVASION)  // Perform Greater Whirlwind Attack
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND) 
        Continue()
END

IF
    ActionListEmpty()
    HaveSpell(ROGUE_GREATER_EVASION)
    ActuallyInCombat()
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
    Delay(60)
THEN
    RESPONSE #100
        Spell(Myself, ROGUE_GREATER_EVASION)  // Perform Greater Whirlwind Attack
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND) 
        Continue()
END

IF
    ActionListEmpty()
    HaveSpell(ROGUE_AVOID_DEATH)
    ActuallyInCombat()
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
    Delay(60)
THEN
    RESPONSE #100
        Spell(Myself, ROGUE_AVOID_DEATH)  // Perform Greater Whirlwind Attack
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND) 
        Continue()
END

/*
Deathblow
The Deathblow ability allows the warrior to blow through the defenses of any lesser creature. For the next 2 rounds, any creature of 10th level or lower is instantly killed when struck by the warrior.
*/
IF
    ActionListEmpty()
    HaveSpell(WARRIOR_DEATHBLOW)
    LevelLT([ENEMY],11)
    ActuallyInCombat()
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
    Delay(30)
THEN
    RESPONSE #100
        Spell(Myself, WARRIOR_DEATHBLOW) 
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND) 
        Continue()
END


IF
    ActionListEmpty()
    HaveSpell(ROGUE_ASSASINATION)
    ActuallyInCombat()
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
    Delay(30)
THEN
    RESPONSE #100
        Spell(Myself, ROGUE_ASSASINATION) 
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND) 
        Continue()
END

/*
Greater Deathblow
Like Deathblow, this ability allows the warrior to vanquish lesser foes with a single blow.  For the next 2 rounds, any creature of 12th level or lower is instantly killed when struck by the warrior.

Requires: Deathblow
*/
IF
    ActionListEmpty()
    HaveSpell(WARRIOR_DEATHBLOW)
    LevelLT([ENEMY],13)
    ActuallyInCombat()
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
    Delay(30)
THEN
    RESPONSE #100
        Spell(Myself, WARRIOR_DEATHBLOW) 
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND) 
        Continue()
END


IF
    ActionListEmpty()
    HaveSpell(WARRIOR_SMITE)
    ActuallyInCombat()
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
    Delay(30)
THEN
    RESPONSE #100
        Spell(Myself, WARRIOR_SMITE) 
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND) 
        Continue()
END

/*

*/
IF
    HaveSpell(WARRIOR_POWER_ATTACK)
    !CheckStat(Myself,5,DEFENSIVE_MODIFIER)
    See([ENEMY])
    !General(LastSeenBy(Myself),UNDEAD)
    !StateCheck(LastSeenBy(Myself),STATE_HARMLESS)
    CheckStatGT(LastSeenBy(Myself),-4,SAVEVSDEATH)
    !CheckStatGT(LastSeenBy(Myself),0,CLERIC_CHAOTIC_COMMANDS)
    !CheckStatGT(LastSeenBy(Myself),0,CLERIC_FREE_ACTION)
    !CheckStat(LastSeenBy(Myself),1,OFFENSIVE_MODIFIER)
    !HasItem("MORSWORD",LastSeenBy(Myself))  // Mordenkainen's Sword
    !HasItemEquipedReal("NPSW01",LastSeenBy(Myself))  // Sword of Arvoreen +2
    !HasItemEquipedReal("SW1H27",LastSeenBy(Myself))  // Arbane's Sword of Agility +2
    !HasItemEquiped("RING09",LastSeenBy(Myself))  // Edventar's Gift
    !HasItemEquipedReal("SW2H06",LastSeenBy(Myself))  // Spider's Bane +2
    !StateCheck(Myself,STATE_SILENCED)
THEN
    RESPONSE #100
        Spell(Myself,WARRIOR_POWER_ATTACK) 
        AttackOneRound(LastSeenBy(Myself))
        Wait(5)
END

/*
Critical Strike
A high-level warrior's intimate knowledge of vital spots on opponents allows <PRO_HIMHER> to, once per day, concentrate all of the attacks in one round to strike a vital area every time. With this ability, every attack roll made in the next round is a natural 20, a critical hit.

Requires: Power Attack
*/
IF
    ActionListEmpty()
    ActuallyInCombat()
    HaveSpell(WARRIOR_CRITICAL_STRIKE) 
    Range(NearestEnemyOf(Myself),6)
THEN
    RESPONSE #100
        Spell(Myself,WARRIOR_CRITICAL_STRIKE)  
        AttackOneRound([ENEMY])
        Wait(5)
END

IF
    ActuallyInCombat()
    ActionListEmpty()
    See(NearestEnemyOf(Myself))
    HaveSpell(MINSC_BERSERK)  // 3117 (MINSC_BERSERK)
    Range(NearestEnemyOf(Myself),30)
    HPPercentLT(Myself,60)
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
    THEN
        RESPONSE #100
        Spell(Myself,MINSC_BERSERK)  // Cast MINSC_BERSERK
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

IF
    ActuallyInCombat()
    ActionListEmpty()
    See(NearestEnemyOf(Myself))
    HaveSpell(BERSERKER_RAGE)
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
    THEN
        RESPONSE #100
        Spell(Myself,BERSERKER_RAGE)  // Cast MINSC_BERSERK
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

IF
    ActuallyInCombat()
    ActionListEmpty()
    HaveSpell(BARBARIAN_RAGE)
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
    THEN
        RESPONSE #100
        Spell(Myself,BARBARIAN_RAGE)
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

IF
    ActuallyInCombat()
    ActionListEmpty()
    HaveSpell(KENSAI_KIA)
    Range(NearestEnemyOf(Myself),30)
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
    THEN
        RESPONSE #100
        Spell(Myself,KENSAI_KIA)
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

// ======================================================
// SECTION: SETTING TRAPS
// ======================================================

IF
    ActionListEmpty()
    Delay(18)
    HaveSpell(SET_SNARE_TRAP) 
    GlobalTimerNotExpired("SHORT_BUFF","LOCALS")
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
    THEN
        RESPONSE #100
        Spell(Myself,SET_SNARE_TRAP) 
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    Delay(18)
    HaveSpell(SET_SPECIAL_SNARE_TRAP) 
    GlobalTimerNotExpired("SHORT_BUFF","LOCALS")
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
    THEN
        RESPONSE #100
        Spell(Myself,SET_SPECIAL_SNARE_TRAP) 
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    Delay(18)
    HaveSpell(ROGUE_SET_SPIKE_TRAP) 
    GlobalTimerNotExpired("SHORT_BUFF","LOCALS")
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
    THEN
        RESPONSE #100
        Spell(Myself,ROGUE_SET_SPIKE_TRAP) 
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    Delay(18)
    HaveSpell(ROGUE_SET_EXPLODING_TRAP)  
    GlobalTimerNotExpired("SHORT_BUFF","LOCALS")
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
    THEN
        RESPONSE #100
        Spell(Myself,ROGUE_SET_EXPLODING_TRAP)
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

IF
    ActionListEmpty()
    Delay(18)
    HaveSpell(ROGUE_SET_EXPLODING_TRAP)  
    GlobalTimerNotExpired("SHORT_BUFF","LOCALS")
    !GlobalTimerNotExpired("CLERIC_CAST","LOCALS")
    THEN
        RESPONSE #100
        Spell(Myself,ROGUE_SET_TIME_TRAP)
        SetGlobalTimer("CLERIC_CAST","LOCALS",ONE_ROUND)
END

// ======================================================
// SECTION: STEALTH AND THIEVING
// ======================================================

IF
    ActionListEmpty()
    !ActuallyInCombat()
    !StateCheck(Myself,STATE_INVISIBLE)
    !StateCheck(Myself,STATE_IMPROVEDINVISIBILITY)
    OR(3)
        Class(Myself,THIEF_ALL)
        Class(Myself,RANGER_ALL)
        Class(Myself,MONK)
    !Range(NearestEnemyOf(Myself),15)
    Delay(24)
THEN
    RESPONSE #100
        Hide()  // Hide in Shadows if not in combat and no enemies nearby
        Continue()
END

IF
    ActionListEmpty()
    !ActuallyInCombat()
    OR(2)
        Class(Myself,THIEF_ALL)
        Class(Myself,MONK)
    Delay(24)
THEN
    RESPONSE #100
        FindTraps()  // Detect Traps if hidden and not in combat
        Wait(6)
        Continue()
END


IF
    Class(Myself,BARD_ALL)
    !ModalState(DETECTTRAPS)
    !StateCheck(Myself,STATE_SILENCED)
    !ModalState(BATTLESONG)
    Delay(24)
THEN
    RESPONSE #100
        BattleSong()
        Wait(18)
        Continue()
END

// ======================================================
//  TURN UNDEAD (CLERIC)
// ======================================================

IF
    General([ENEMY],UNDEAD)
    LevelGT(Myself,12)
    CanTurn([Enemy],4)
    OR(2)
        Class(Myself,PALADIN_ALL)
        Class(Myself,CLERIC_ALL)
  THEN
    RESPONSE #100
      Turn()
      Wait(12)
      Continue()
  END


// ======================================================
// SECTION: Wands
// ======================================================


IF
    HasItem("RODS06",Myself)  // Rod of Reversal
    See([ENEMY])
    OR(6)
        CheckStatGT(LastSeenBy(Myself),0,WIZARD_SPELL_DEFLECTION)
        CheckStatGT(LastSeenBy(Myself),0,WIZARD_SPELL_TURNING)
        CheckStatGT(LastSeenBy(Myself),0,CLERIC_SHIELD_OF_THE_ARCHONS)
        CheckStatGT(LastSeenBy(Myself),0,WIZARD_SPELL_IMMUNITY)
        CheckStatGT(LastSeenBy(Myself),0,WIZARD_SPELL_TRAP)
        CheckStatGT(LastSeenBy(Myself),0,MINORGLOBE)
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    !StateCheck(Myself,STATE_SILENCED)
    !CheckStatGT(Myself,0,CLERIC_INSECT_PLAGUE)
THEN
    RESPONSE #100
        DisplayStringHead(Myself,31971)  // *uses a wand*
        UseItem("RODS06",LastSeenBy(Myself))  // Rod of Reversal
END

// Wand of Frost
IF
    ActionListEmpty()
    ActuallyInCombat()
    CheckStatLT([ENEMY],100,RESISTMAGIC)
    CheckStatLT([ENEMY],100,RESISTCOLD)
    HPGT([ENEMY],30)
    HasItemEquiped("WAND06",Myself)  
    Delay(20)
THEN
    RESPONSE #100
      UseItem("WAND06",[ENEMY]) 
END


//Wand of Fear
IF
    ActionListEmpty()
    ActuallyInCombat()
    !StateCheck([ENEMY],STATE_PANIC)
    HPGT([ENEMY],30)
    !ImmuneToSpellLevel([ENEMY],4)
    NumCreatureGT([ENEMY],2)
    HasItemEquiped("WAND02",Myself)  
    Delay(10)
THEN
    RESPONSE #100
      UseItem("WAND02",[ENEMY]) 
END

// Wand of Fireball
IF
    ActionListEmpty()
    ActuallyInCombat()
    !Range(FarthestEnemyOf(Myself),16)
    Range(NearestEnemyOf(FarthestEnemyOf(Myself)),8)
    !HasBounceEffects(FarthestEnemyOf(Myself))
    CheckStatLT(FarthestEnemyOf(Myself),100,RESISTMAGIC)
    CheckStatLT(FarthestEnemyOf(Myself),100,RESISTFIRE)
    HPGT(FarthestEnemyOf(Myself),20)
    NumCreatureGT([ENEMY],2)
    HasItemEquiped("WAND05",Myself)  
    Delay(6)
THEN
    RESPONSE #100
        UseItem("WAND05",FarthestEnemyOf(Myself)) 
END



//Wand of Paralyzation
IF
    ActionListEmpty()
    ActuallyInCombat()
    !CheckSpellState([ENEMY],HELD)
    !CheckSpellState([ENEMY],FREE_ACTION)
    !ImmuneToSpellLevel([ENEMY],4)
    HPGT([ENEMY],40)
    HasItemEquiped("WAND04",Myself)  
    Delay(20)
THEN
    RESPONSE #100
      UseItem("WAND04",[ENEMY]) 
END

//Wand of the heavens 
IF
    ActionListEmpty()
    ActuallyInCombat()
    !ImmuneToSpellLevel([ENEMY],4)
    HPGT([ENEMY],50)
    HasItemEquiped("WAND11",Myself)  
    Delay(20)
THEN
    RESPONSE #100
      UseItem("WAND11",[ENEMY]) 
END

// Wand of Magic Missile
IF
    ActionListEmpty()
    ActuallyInCombat()
    CheckStatLT([ENEMY],100,RESISTMAGIC)
    !CheckSpellState([ENEMY],WIZARD_SHIELD)
    !HaveSpell(WIZARD_MAGIC_MISSILE)  
    !ImmuneToSpellLevel([ENEMY],4)
    LevelGT([ENEMY],2)
    HasItemEquiped("WAND03",Myself)  
THEN
    RESPONSE #100
      UseItem("WAND03",[ENEMY]) 
END


// Wand of Magic Missile
IF
    ActionListEmpty()
    ActuallyInCombat()
    CheckStatLT([ENEMY],100,RESISTMAGIC)
    !CheckSpellState([ENEMY],WIZARD_SHIELD)
    !HaveSpell(WIZARD_MAGIC_MISSILE)  
    !ImmuneToSpellLevel([ENEMY],4)
    HPGT([ENEMY],20)
    HasItemEquiped("WAND99",Myself)  
THEN
    RESPONSE #100
      UseItem("WAND99",[ENEMY]) 
END

// ======================================================
// SECTION: Combat Items (Ring of Ram, Staff of Ram Etc.)
// ======================================================

//Flesh Golem Manual
/*
This amazing tome contains theoretical musings on the construction and control of golems. It also explains how to use the manual to temporarily conjure a servant of assembled flesh which will obey the creator without question. One must have a minimum Intelligence of 16 to understand the contents.

STATISTICS:

Charge abilities:
– Summon Flesh Golem once per day
  Range: 30 ft.
  Duration: 1 turn

Requires:
 16 Intelligence

Weight: 5
*/
IF
    ActionListEmpty()
    ActuallyInCombat()
    HasItemEquiped("TOME01",Myself)  
    GlobalLT("USED_TOME01","LOCALS",1)
    Delay(20)
THEN
    RESPONSE #100
      UseItem("TOME01",Myself) 
      IncrementGlobal("USED_TOME01","LOCALS",1)
END

//Algernon's Cloak
IF
    ActuallyInCombat()
    ActionListEmpty()
    See([ENEMY])
    HPPercentGT(LastSeenBy(Myself),50)
    !HasBounceEffects(LastSeenBy(Myself))
    General(LastSeenBy(Myself),HUMANOID)
    !StateCheck(LastSeenBy(Myself),STATE_HELPLESS)
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)
    GlobalLT("USED_clck08","LOCALS",1)
    HasItemEquiped("clck08",Myself)  
THEN
    RESPONSE #100
        UseItem("clck08",LastSeenBy(Myself)) 
        IncrementGlobal("USED_clck08","LOCALS",1)
END

// Ilbratha +1
IF
    ActionListEmpty()
    ActuallyInCombat()
    !StateCheck(Myself,STATE_MIRRORIMAGE)
    GlobalLT("USED_SW1H26","LOCALS",1)
    HasItemEquiped("SW1H26",Myself)  
THEN
    RESPONSE #100
      SetInterrupt(FALSE)
      UseItem("SW1H26",Myself) 
      SetInterrupt(TRUE)
      IncrementGlobal("USED_SW1H26","LOCALS",1)
END

//Ring of Ram
IF
    ActionListEmpty()
    ActuallyInCombat()
    GlobalLT("USED_RING33","LOCALS",1)
    HasItemEquiped("RING33",Myself) 
THEN
    RESPONSE #100
      SetInterrupt(FALSE)
      UseItem("RING33",NearestEnemyOf(Myself)) 
      SetInterrupt(TRUE)
      IncrementGlobal("USED_RING33","LOCALS",1)
END

//The Victor
/*
Charge abilities:
– Damage: 2d6
  Range: 100 ft.
  Area of Effect: 2-ft. by 100-ft. jet
*/
IF
    ActionListEmpty()
    ActuallyInCombat()
    HPGT([ENEMY],24)
    CheckStatLT([ENEMY])
    GlobalLT("USED_RING33","LOCALS",1)
    HasItemEquiped("RING33",Myself) 
THEN
    RESPONSE #100
      SetInterrupt(FALSE)
      UseItem("RING33",[ENEMY]) 
      SetInterrupt(TRUE)
      IncrementGlobal("USED_RING33","LOCALS",1)
END


//Golden Calf Idol
IF
    ActionListEmpty()
    ActuallyInCombat()
    GlobalLT("USED_ohbrew06","LOCALS",1)
    HasItemEquiped("ohbrew06",Myself) 
THEN
    RESPONSE #100
      SetInterrupt(FALSE)
      UseItem("ohbrew06",Myself) 
      SetInterrupt(TRUE)
      IncrementGlobal("USED_ohbrew06","LOCALS",1)
END

IF
    ActionListEmpty()
    ActuallyInCombat()
    GlobalLT("USED_STAF21","LOCALS",1)
    HasItemEquiped("STAF21",Myself) 
THEN
    RESPONSE #100
      SetInterrupt(FALSE)
      UseItem("STAF21",NearestEnemyOf(Myself))  
      SetInterrupt(TRUE)
      IncrementGlobal("USED_STAF21","LOCALS",1)
END

IF
    ActionListEmpty()
    ActuallyInCombat()
    See([ENEMY])
    General(LastSeenBy(Myself),UNDEAD)
    GlobalLT("USED_SW1H31","LOCALS",1)
    HasItemEquiped("SW1H31",Myself) 
THEN
    RESPONSE #100
      SetInterrupt(FALSE)
      UseItem("SW1H31",Myself)  
      SetInterrupt(TRUE)
      IncrementGlobal("USED_SW1H31","LOCALS",1)
END

// Cast Stoneskin Gargoyle Boots
// Casts Stoneskin to grant the wizard protection from physical damage by turning their skin to stone.
// Lasts for 1 turn per caster level.
IF
    ActionListEmpty()
    GlobalLT("USED_BOOT12","LOCALS",3)
    HasItemEquiped("BOOT12",Myself) 
    CheckStatLT(Myself,1,STONESKINS)
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
THEN
    RESPONSE #100
      UseItem("BOOT12",Myself)  
      IncrementGlobal("USED_BOOT12","LOCALS",1)
END

//Ethereal Boots
IF
    ActionListEmpty()
    ActuallyInCombat()
    GlobalLT("USED_BOOT11","LOCALS",1)
    HasItemEquiped("BOOT11",Myself) 
    CheckStatLT(Myself,1,WIZARD_PROTECTION_FROM_NORMAL_WEAPONS)
    CheckStatLT(Myself,50,SPELLFAILUREMAGE)
    CheckStatLT(Myself,1,DEAD_MAGIC)    
THEN
    RESPONSE #100
      SetInterrupt(FALSE)
      UseItem("BOOT11",Myself)  
      SetInterrupt(TRUE)
      IncrementGlobal("USED_BOOT11","LOCALS",1)
END

// ======================================================
// SECTION: COMBAT ACTIONS - RANGED ATTACKS
// ======================================================

//AMMO TYPE SELECTION



// Use special bow ability
IF
    ActuallyInCombat()
    ActionListEmpty()
    HaveSpell(ARCHER_CALL_SHOT) // Check if special ability is available
    OR(6)
        See([ENEMY])
        See([ENEMY.0.0.BARD_ALL]) // Default target
        See([ENEMY.0.0.CLERIC_ALL])
        See([ENEMY.0.0.DRUID_ALL])
        See([ENEMY.0.0.MAGE_ALL])
        See([ENEMY.0.0.SORCERER]) // Highest priority
    !StateCheck(LastSeenBy(Myself),STATE_CHARMED)
    OR(2)
        WeaponCanDamage(LastSeenBy(Myself),BOTH)
        !IsWeaponRanged(Myself)
    !OutOfAmmo()
    CanEquipRanged()
    LevelLT(LastSeenBy(Myself),18)
    Class(Myself,RANGER)
    !Range(LastSeenBy(Myself),4)
    CheckStatLT(LastSeenBy(Myself),100,RESISTMISSILE)
THEN
    RESPONSE #100
        EquipRanged()  // Equip ranged weapon
        Spell(Myself,ARCHER_CALL_SHOT) // Use special bow ability
        Continue()
END


IF
    ActionListEmpty()
    ActuallyInCombat()
    OR(6)
        See([ENEMY])
        See([ENEMY.0.0.BARD_ALL]) // Default target
        See([ENEMY.0.0.CLERIC_ALL])
        See([ENEMY.0.0.DRUID_ALL])
        See([ENEMY.0.0.MAGE_ALL])
        See([ENEMY.0.0.SORCERER]) // Highest priority
    !StateCheck(LastSeenBy(Myself),STATE_CHARMED)
    LevelLT(LastSeenBy(Myself),21)
    OR(2)
        WeaponCanDamage(LastSeenBy(Myself),MAINHAND)
        !IsWeaponRanged(Myself)
    CanEquipRanged()
    !Range(LastSeenBy(Myself),6)  // If the enemy is within melee range (4 search squares)
    CheckStatLT(LastSeenBy(Myself),1,WIZARD_PROTECTION_FROM_NORMAL_MISSILES)  // Check if Protection from Normal Missiles is already active
    CheckStatLT(LastSeenBy(Myself),100,RESISTMISSILE)
    !StateCheck(Myself,STATE_INVISIBLE)
    !CheckSpellState([ENEMY],PROTECTION_FROM_MAGICAL_WEAPONS)
    OR(2)
        !TookDamage()
        !Class(Myself,MAGE_ALL)
    Delay(6)
THEN
    RESPONSE #100
        EquipRanged()
        AttackOneRound(LastSeenBy(Myself))
        Wait(4)
        Continue()
END

// ======================================================
// SECTION: COMBAT ACTIONS - MELEE ATTACKS
// ======================================================

IF
    ActionListEmpty()
    ActuallyInCombat()
    OR(8)
        Range([ENEMY],8)
        Class(Myself,PALADIN_ALL)
        Class(Myself,FIGHTER_ALL)
        Class(Myself,RANGER)
        Class(Myself,CLERIC_ALL)
        Class(Myself,THIEF_ALL)
        WeaponEffectiveVs([ENEMY],MAINHAND)
        WeaponCanDamage([ENEMY],MAINHAND)
     //Return true if I'm a caster but only if there's a 25% chance
    OR(8)
        See([ENEMY])
        See([ENEMY.0.0.RANGER]) // Default target
        See([ENEMY.0.0.THIEF]) // Default target
        See([ENEMY.0.0.BARD_ALL]) // Default target
        See([ENEMY.0.0.CLERIC_ALL])
        See([ENEMY.0.0.DRUID_ALL])
        See([ENEMY.0.0.MAGE_ALL])
        See([ENEMY.0.0.SORCERER]) // Highest priority
    !StateCheck(LastSeenBy(Myself),STATE_CHARMED)
    WeaponCanDamage(LastSeenBy(Myself),BOTH)
    OR(6)
        CheckStat([ENEMY],0,WEB)
        CheckStatGT(Myself,0,CLERIC_FREE_ACTION) // Check if party is being crowd-controlled
        CheckSpellState(Myself,FREE_ACTION)
        CheckStatGT(Myself,0,MINORGLOBE)
        CheckStatGT(Myself,0,SHIELDGLOBE)
        Range([ENEMY],4)
    !GlobalTimerNotExpired("USE_RANGE","LOCALS")
    HPPercentGT(Myself,35)
    OR(2)
        !TookDamage()
        !Class(Myself,MAGE_ALL)
    !CheckSpellState([ENEMY],PROTECTION_FROM_MAGICAL_WEAPONS)
    !CheckSpellState([ENEMY],RED_FIRESHIELD)
    !CheckSpellState([ENEMY],BLUE_FIRESHIELD)
    Delay(3)
THEN
    RESPONSE #100
        EquipMostDamagingMelee()  // Equip the most damaging melee weapon
        AttackOneRound(LastSeenBy(Myself))
        Wait(4)
        Continue()
END

//If I'm in combat, and not near an ally go to them. Note, we can't evaluate this to attack nearest because we need to see what is nearest the player...
IF
    ActionListEmpty()
    ActuallyInCombat()
    Range([ENEMY],30)
  THEN
    RESPONSE #100
        GlobalShout(124)
END


IF
    ActionListEmpty()
    ActuallyInCombat()
    Heard([PC],ASSIST)
    HPPercentGT(Myself,35)
    !Range([ENEMY],30)
    !Range(LastHeardBy(Myself),30)
  THEN
    RESPONSE #100
        MoveToObjectOffset(LastHeardBy(Myself),[0.5])
    RESPONSE #100
        MoveToObjectOffset(LastHeardBy(Myself),[-5.0])
    RESPONSE #100
        MoveToObjectOffset(LastHeardBy(Myself),[0.-5])
    RESPONSE #100
        MoveToObjectOffset(LastHeardBy(Myself),[5.0])
END

// RESET TIMERS IF WE'RE at the bottom
IF
    ActuallyInCombat()
    Delay(20)
    True()
THEN
    RESPONSE #100
        SetGlobalTimer("WIZARD_CAST","LOCALS",0)
        SetGlobalTimer("CLERIC_CAST","LOCALS",0)
END

